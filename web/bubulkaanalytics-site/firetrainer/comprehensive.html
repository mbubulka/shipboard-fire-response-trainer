<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipboard Fire Response Training - Complete DCA Training System</title>
    <script src="../dca-feedback-integration.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2980b9 0%, #6bb6ff 50%, #3742fa 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .mission-critical-info {
            background: rgba(255, 193, 7, 0.15);
            border: 2px solid rgba(255, 193, 7, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .mission-critical-info p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            opacity: 1;
        }
        
        .mission-critical-info strong {
            color: #ffd700;
            font-weight: bold;
        }
        
        .critical-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 0 20px;
        }
        
        .stat-item {
            text-align: center;
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
            border-radius: 15px;
            padding: 25px 15px;
            transition: transform 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(220, 53, 69, 0.3);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 0.95rem;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        /* Scenario Interface Styles */
        .scenario-interface {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .scenario-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .scenario-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .scenario-btn.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .scenario-btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .scenario-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .scenario-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-context h3 {
            font-size: 1.5rem;
            color: #ff6b6b;
            margin-bottom: 15px;
        }
        
        .scenario-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .response-options {
            margin: 25px 0;
        }
        
        .response-options h4 {
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .options-grid {
            display: grid;
            gap: 10px;
        }
        
        .response-option {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .response-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .response-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .response-option label {
            flex-grow: 1;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .ai-analysis {
            margin-top: 25px;
            padding: 20px;
            background: rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            border: 2px solid rgba(52, 152, 219, 0.5);
        }
        
        .ai-analysis h4 {
            margin-bottom: 15px;
            color: #3498db;
        }
        
        .analysis-section {
            display: grid;
            gap: 12px;
        }
        
        .analysis-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .effectiveness-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
        }
        
        .risk-low { color: #27ae60; font-weight: bold; }
        .risk-moderate { color: #f39c12; font-weight: bold; }
        .risk-high { color: #e74c3c; font-weight: bold; }
        
        .analysis-explanation {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .scenario-actions {
            text-align: center;
            margin-top: 25px;
        }
        
        /* DQN Analysis Interface Styles */
        .dqn-analysis-interface {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .analysis-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .analysis-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .analysis-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .analysis-btn.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .analysis-btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        /* Assessment-specific button styling */
        .assessment-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 8px;
        }
        
        .assessment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .assessment-btn.primary {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .assessment-btn.secondary {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
        }
        
        .assessment-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Assessment interface styling */
        .assessment-controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .overview-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid #34495e;
        }
        
        .card-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .scenario-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .scenario-preview-card {
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 20px;
        }
        
        .scenario-type {
            background: #e74c3c;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .complexity-indicator {
            background: rgba(52, 73, 94, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .category-card {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid #3498db;
            border-radius: 12px;
            padding: 20px;
        }
        
        .category-card h4 {
            margin-bottom: 15px;
            color: #3498db;
        }
        
        .category-card ul {
            list-style: none;
            padding: 0;
        }
        
        .category-card li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(52, 152, 219, 0.2);
        }
        
        /* Question interface styling */
        .assessment-question-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
        }
        
        .question-progress {
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .scenario-badge {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .situation-brief {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .answer-options {
            margin: 30px 0;
        }
        
        .answer-option {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(52, 73, 94, 0.3);
            border: 2px solid #34495e;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .answer-option:hover {
            background: rgba(52, 73, 94, 0.5);
            border-color: #3498db;
        }
        
        .answer-option.selected {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
        }
        
        .option-letter {
            background: #34495e;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .answer-option.selected .option-letter {
            background: #3498db;
        }
        
        .time-pressure {
            background: rgba(243, 156, 18, 0.2);
            border: 1px solid #f39c12;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            text-align: center;
            color: #f39c12;
            font-weight: bold;
        }
        
        .time-icon {
            margin-right: 8px;
        }
        
        /* Feedback styling */
        .answer-feedback-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
        }
        
        .feedback-result {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .feedback-result.correct {
            background: rgba(39, 174, 96, 0.2);
            border: 2px solid #27ae60;
            color: #27ae60;
        }
        
        .feedback-result.incorrect {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            color: #e74c3c;
        }
        
        .feedback-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        
        .correct-answer, .explanation, .your-answer {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .correct-answer {
            border-left: 4px solid #27ae60;
        }
        
        .explanation {
            border-left: 4px solid #3498db;
        }
        
        .your-answer {
            border-left: 4px solid #e74c3c;
        }
        
        /* Results styling */
        .assessment-results-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 40px;
        }
        
        .score-display {
            text-align: center;
            margin: 30px 0;
        }
        
        .score-circle {
            display: inline-block;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .score-percentage {
            font-size: 36px;
            font-weight: bold;
            color: white;
        }
        
        .score-fraction {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .performance-level {
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .performance-level.expert {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .performance-level.proficient {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .performance-level.developing {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .performance-level.needs-work {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .question-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .question-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid #34495e;
        }
        
        .result-indicator.correct {
            color: #27ae60;
        }
        
        .result-indicator.incorrect {
            color: #e74c3c;
        }
        
        .recommendations-list {
            margin: 20px 0;
        }
        
        .recommendation {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        /* DQN Assessment Specific Styles */
        .dqn-assessment-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
        }
        
        .scenario-status {
            background: rgba(52, 73, 94, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .state-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .state-item {
            text-align: center;
        }
        
        .state-label {
            display: block;
            font-size: 12px;
            color: #bdc3c7;
            margin-bottom: 5px;
        }
        
        .state-value {
            display: block;
            font-weight: bold;
            font-size: 14px;
        }
        
        .dqn-live {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        .situation-alert {
            background: rgba(231, 76, 60, 0.15);
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .decision-prompt {
            background: rgba(52, 152, 219, 0.15);
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .dqn-answer-option {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(52, 73, 94, 0.3);
            border: 2px solid #34495e;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .dqn-answer-option:hover {
            background: rgba(52, 73, 94, 0.5);
            border-color: #e74c3c;
            transform: translateY(-2px);
        }
        
        .dqn-answer-option.selected {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.3);
        }
        
        .dqn-answer-option.selected .option-letter {
            background: #e74c3c;
        }
        
        .ai-notice {
            background: rgba(155, 89, 182, 0.15);
            border: 1px solid #9b59b6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            color: #9b59b6;
        }
        
        /* DQN Feedback Styles */
        .dqn-feedback-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
        }
        
        .consequence-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .decision-outcome {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .state-changes {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid #f39c12;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .state-update {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .progression-notice {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .scenario-end {
            background: rgba(39, 174, 96, 0.1);
            border-left: 4px solid #27ae60;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* DQN Final Results */
        .dqn-final-results {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 40px;
        }
        
        .final-outcome {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .final-outcome.success {
            background: rgba(39, 174, 96, 0.2);
            border: 3px solid #27ae60;
            color: #27ae60;
        }
        
        .final-outcome.contained {
            background: rgba(243, 156, 18, 0.2);
            border: 3px solid #f39c12;
            color: #f39c12;
        }
        
        .final-outcome.casualties {
            background: rgba(231, 76, 60, 0.2);
            border: 3px solid #e74c3c;
            color: #e74c3c;
        }
        
        .final-outcome.total-loss {
            background: rgba(139, 0, 0, 0.2);
            border: 3px solid #8b0000;
            color: #8b0000;
        }
        
        .scenario-summary, .tactical-analysis, .lessons-learned {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(52, 73, 94, 0.3);
            border-radius: 5px;
        }
        
        .metric-label {
            font-weight: bold;
        }
        
        .metric-value {
            color: #3498db;
        }
        
        .dashboard-section {
            margin-bottom: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .dashboard-section h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #3498db;
            border-bottom: 2px solid rgba(52, 152, 219, 0.3);
            padding-bottom: 10px;
        }
        
        .fire-class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .fire-class-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .fire-class-card:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
        }
        
        .class-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .class-info h4 {
            margin-bottom: 5px;
            color: #ffd700;
        }
        
        .success-rate {
            font-weight: bold;
            color: #27ae60;
            margin-top: 10px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .insight-card {
            background: rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            text-align: center;
        }
        
        .insight-card h4 {
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .insight-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .scenario-generator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
        }
        
        .generator-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }
        
        .generator-controls label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .generator-controls select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.5);
            color: white;
        }
        
        .generated-scenario {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 193, 7, 0.5);
        }
        
        .scenario-result h4 {
            color: #ff6b6b;
            margin-bottom: 15px;
        }
        
        .scenario-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .scenario-desc {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .dqn-prediction {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        
        .dqn-prediction h5 {
            color: #3498db;
            margin-bottom: 8px;
        }
        
        .optimal-response {
            background: rgba(39, 174, 96, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }
        
        .optimal-response h5 {
            color: #27ae60;
            margin-bottom: 8px;
        }
        
        .detailed-analysis {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .analysis-detail-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .phases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .phase-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .phase-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .phase-success {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 10px;
        }
        
        .phase-insights {
            font-size: 0.9rem;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        .mistakes-list {
            display: grid;
            gap: 10px;
        }
        
        .mistake-item {
            background: rgba(231, 76, 60, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        
        /* Reality-focused interface styles */
        .section-intro {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .scenario-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .scenario-reality-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scenario-reality-card:hover {
            background: rgba(0, 0, 0, 0.7);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .scenario-header {
            margin-bottom: 15px;
        }
        
        .incident-badge {
            display: inline-block;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .scenario-reality-card h4 {
            font-size: 1.3rem;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        
        .incident-date {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #ffd700;
        }
        
        .scenario-preview {
            font-size: 1rem;
            line-height: 1.5;
            margin: 15px 0;
            opacity: 0.9;
        }
        
        .scenario-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .reality-check-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .reality-point {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .point-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .reality-point h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .reality-point p {
            line-height: 1.5;
            opacity: 0.9;
        }
        
        /* DQN Scenario Styles */
        .dqn-scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dqn-scenario-card {
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.15), rgba(244, 67, 54, 0.15));
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 87, 34, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .dqn-scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff5722, #ff9800, #ffc107);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { background-position: 200% 0; }
            50% { background-position: -200% 0; }
        }
        
        .dqn-scenario-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 87, 34, 0.7);
            box-shadow: 0 15px 30px rgba(255, 87, 34, 0.3);
        }
        
        .dqn-badge {
            background: linear-gradient(135deg, #ff5722, #ff9800);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .scenario-difficulty {
            color: #ffab91;
            font-size: 0.9rem;
            font-style: italic;
            margin-top: 5px;
        }
        
        .dqn-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .feature {
            background: rgba(255, 87, 34, 0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
            border: 1px solid rgba(255, 87, 34, 0.5);
        }
        
        .dqn-advantages {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 87, 34, 0.2);
            margin-top: 20px;
        }
        
        .dqn-advantages h4 {
            color: #ff7043;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .advantage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .advantage-point {
            background: rgba(255, 87, 34, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 87, 34, 0.3);
            text-align: center;
        }
        
        .advantage-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .advantage-point h5 {
            color: #ffab91;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .advantage-point p {
            line-height: 1.5;
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        /* Sources and Disclaimer Styles */
        .sources-disclaimer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .sources-disclaimer-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        .sources-section, .disclaimer-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .sources-section h4, .disclaimer-section h4 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .sources-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sources-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .sources-list li:last-child {
            border-bottom: none;
        }
        
        .disclaimer-box {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 20px;
            color: #fff3cd;
        }
        
        .disclaimer-box p {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .disclaimer-box p:last-child {
            margin-bottom: 0;
            font-style: italic;
            opacity: 0.9;
        }
        
        .citation-notes {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .citation-notes h4 {
            color: #b0bec5;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .citation-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .citation-list li {
            padding: 8px 0;
            font-size: 0.85rem;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .citation-list sup {
            color: #4ecdc4;
            font-weight: bold;
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .evidence-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .evidence-card h4 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .evidence-list {
            list-style: none;
            padding: 0;
        }
        
        .evidence-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            padding-left: 25px;
        }
        
        .evidence-list li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }
        
        .scenario-details-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-detail-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-detail-header h3 {
            color: #ff6b6b;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .incident-info {
            color: #ffd700;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .scenario-detail-content {
            display: grid;
            gap: 25px;
        }
        
        .overview-section, .lessons-section, .our-scenario-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .overview-section h4, .lessons-section h4, .our-scenario-section h4 {
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .timeline-section {
            background: rgba(255, 193, 7, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }
        
        .timeline-section h4 {
            color: #ffc107;
            margin-bottom: 20px;
        }
        
        .timeline {
            display: grid;
            gap: 10px;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        .timeline-item.critical {
            background: rgba(231, 76, 60, 0.2);
            border-left-color: #e74c3c;
        }
        
        .timeline-time {
            font-weight: bold;
            color: #ffd700;
            min-width: 60px;
            margin-right: 15px;
        }
        
        .timeline-event {
            flex-grow: 1;
        }
        
        .failures-section {
            background: rgba(231, 76, 60, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(231, 76, 60, 0.3);
        }
        
        .failures-section h4 {
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .failures-list {
            display: grid;
            gap: 8px;
        }
        
        .failure-item {
            padding: 10px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 6px;
        }
        
        .our-scenario-box {
            background: rgba(39, 174, 96, 0.2);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(39, 174, 96, 0.5);
            font-weight: bold;
            line-height: 1.6;
        }
        
        .training-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .mode-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .mode-card:hover {
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .mode-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .mode-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-align: center;
            color: #ffd700;
        }
        
        .mode-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .mode-features {
            list-style: none;
            padding: 0;
        }
        
        .mode-features li {
            padding: 5px 0 5px 20px;
            position: relative;
        }
        
        /* DCA Assessment Styles */
        .dca-assessment {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .question-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .choices-container {
            display: grid;
            gap: 15px;
        }
        
        .choice-option {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .choice-option:hover {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .choice-option input[type="radio"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }
        
        .choice-option label {
            flex-grow: 1;
            cursor: pointer;
        }
        
        .consequence-message {
            background: rgba(255, 193, 7, 0.2);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .consequence-message.success {
            background: rgba(40, 167, 69, 0.2);
            border-left-color: #28a745;
        }
        
        .consequence-message.warning {
            background: rgba(220, 53, 69, 0.2);
            border-left-color: #dc3545;
        }
        
        .mode-features li::before {
            content: "✓";
            position: absolute;
            left: 0;
        }
        
        .mode-badge {
            display: inline-block;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .training-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
        
        /* Scenario Information */
        .scenario-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .scenario-title {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .scenario-description {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .scenario-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #ffd700;
        }
        
        .training-content.active {
            display: block;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-header {
            font-size: 1.4rem;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-list {
            list-style: none;
            padding: 0;
        }

        .option-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .option-item.selected {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            height: 100%;
            transition: width 0.3s ease;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .nav-btn {
            background: linear-gradient(45deg, #2980b9, #3498db);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 12px 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            text-decoration: none;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
        }

        .results-card {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .score-display {
            font-size: 3rem;
            margin: 20px 0;
            color: #2ecc71;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .feedback-message {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .scenario-context {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .scenario-title {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.6rem;
        }

        .scenario-description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .assessment-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .ai-assessment {
            margin-top: 20px;
            padding: 20px;
            background: rgba(41, 128, 185, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .assessment-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .metric-label {
            font-weight: bold;
            color: #ffd700;
        }

        .metric-value {
            color: #2ecc71;
        }

        .resources {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> Shipboard Fire Response Training</h1>
            <p><strong>When Seconds Count, Training Saves Lives</strong></p>
            <div class="mission-critical-info">
                <p><strong>Why This Matters:</strong> Ship fires claim lives and vessels because traditional training can't replicate the chaos, time pressure, and complex decision-making of real emergencies. This AI-powered system bridges that gap.</p>
                <p><strong>Who Benefits:</strong> Naval personnel, merchant mariners, coast guard, maritime academies, and anyone responsible for shipboard safety in environments where escape routes are limited and mistakes are fatal.</p>
                <p><strong>The Edge:</strong> Experience realistic fire scenarios with AI-powered feedback using Mistral-7B, practice critical decisions without real-world consequences, and build the muscle memory that saves ships and crews.</p>
            </div>
        </div>

        <div class="critical-stats">
            <div class="stat-item">
                <div class="stat-number">90%</div>
                <div class="stat-label">of shipboard fatalities occur during the first 10 minutes of a fire<sup>5</sup></div>
            </div>
            <div class="stat-item">
                <div class="stat-number">$180M</div>
                <div class="stat-label">USS Bonhomme Richard fire loss - preventable with faster response<sup>6</sup></div>
            </div>
            <div class="stat-item">
                <div class="stat-number">5 min</div>
                <div class="stat-label">critical decision window before fire becomes uncontrollable<sup>7</sup></div>
            </div>
        </div>

        <div id="modeSelection" class="training-modes">
            <div class="mode-card" onclick="startScenarioMode()">
                <div class="mode-icon">🔍</div>
                <div class="mode-title">Scenario Analysis</div>
                <div class="mode-description">
                    <strong>Predict Fire Outcomes Before They Happen</strong><br>
                    Experience the same scenarios that have challenged real crews: electrical fires in engine rooms, galley blazes spreading to berthing, fuel leaks igniting in confined spaces. Our DQN neural network has learned from thousands of fire incidents to predict what happens next based on your decisions.
                </div>
                <ul class="mode-features">
                    <li>Real incident-based scenarios</li>
                    <li>AI predicts fire spread patterns</li>
                    <li>Decision confidence scoring</li>
                    <li>Learn from mistakes without casualties</li>
                </ul>
                <div class="mode-badge">DQN + AWS Lambda</div>
            </div>

            <div class="mode-card" onclick="startAssessmentMode()">
                <div class="mode-icon">📋</div>
                <div class="mode-title">DCA Assessment</div>
                <div class="mode-description">
                    <strong>Test Your Skills Under Pressure</strong><br>
                    When smoke fills the compartment and seconds matter, can you identify the fire class, select the right suppression agent, and coordinate your team? This AI-powered assessment puts you in command during critical moments that separate competent sailors from heroes.
                </div>
                <ul class="mode-features">
                    <li>Military-grade scenario realism</li>
                    <li>  Mistral-7B AI evaluates decisions</li>
                    <li> Time-pressure decision making</li>
                    <li> Performance tracking & improvement</li>
                </ul>
                <div class="mode-badge">Mistral-7B + HuggingFace</div>
            </div>
        </div>

        <div id="assessmentContent" class="training-content">
            <!-- Assessment content will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // Global Configuration
        const HF_API_KEY = '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';
        const MODEL_URL = 'https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.1';
        const AI_FEEDBACK_ENABLED = true;
        const USE_MOCK_DATA = false;

        // Global State
        let currentMode = 'selection';
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null;
        let assessmentQuestions = [];

        // Assessment Data
        const SCENARIO_ASSESSMENT = {
            title: "DCA Comprehensive Assessment",
            description: "Test your knowledge of damage control and firefighting procedures through realistic scenarios",
            scenarios: [
                {
                    id: "initial_response",
                    title: "Initial Fire Response Scenario",
                    description: "You receive a report of smoke in the forward berthing area",
                    questions: [
                        {
                            id: "size_up",
                            question: "Smoke is reported in the forward berthing area. What should be your first three actions in order?",
                            options: [
                                "Sound general quarters, notify chain of command, dispatch investigation team",
                                "Evacuate the space, activate fire suppression, call damage control central",
                                "Verify smoke report, sound general quarters, set fire boundaries",
                                "Call for assistance, start ventilation, begin evacuation"
                            ],
                            correct: 0,
                            explanation: "Initial response requires immediate alert (GQ), command notification for decision-making authority, and investigation to assess the situation.",
                            resources: "Initial response procedures prioritize alert, command, and investigation"
                        },
                        {
                            id: "risk_assessment",
                            question: "The investigation team reports active fire in a mattress with moderate smoke. What is your primary concern?",
                            options: [
                                "Structural damage to bulkheads",
                                "Rapid fire spread through ventilation",
                                "Personnel evacuation and accountability",
                                "Water damage from firefighting"
                            ],
                            correct: 2,
                            explanation: "In berthing areas, personnel evacuation and accountability is the immediate priority due to life safety concerns.",
                            resources: "Life safety always takes precedence in occupied spaces"
                        }
                    ]
                },
                {
                    id: "fire_containment",
                    title: "Fire Containment Phase",
                    description: "Fire has been confirmed in the forward berthing with heavy smoke",
                    questions: [
                        {
                            id: "boundary_cooling",
                            question: "How should boundaries be established around the fire area?",
                            options: [
                                "One boundary immediately adjacent to the fire",
                                "Two boundaries with the primary at the fire and secondary one compartment out",
                                "Three boundaries with safe zones between each",
                                "Four boundaries creating multiple containment zones"
                            ],
                            correct: 1,
                            explanation: "Primary and secondary boundaries provide containment while allowing for tactical operations and safety zones.",
                            resources: "Proper boundary control prevents fire spread while enabling response"
                        },
                        {
                            id: "ventilation_strategy",
                            question: "What ventilation strategy should be implemented?",
                            options: [
                                "Maximize exhaust to remove smoke",
                                "Shut down all ventilation systems",
                                "Natural ventilation through opening hatches",
                                "Coordinate ventilation with fire attack plan"
                            ],
                            correct: 3,
                            explanation: "Ventilation must be coordinated with fire attack to prevent fire spread and support firefighting efforts.",
                            resources: "Ventilation affects fire behavior and firefighting effectiveness"
                        }
                    ]
                },
                {
                    id: "special_hazards",
                    title: "Special Hazards Response",
                    description: "Fire reported in the electronics equipment space with potential hazardous materials",
                    questions: [
                        {
                            id: "hazmat_identification",
                            question: "You identify lithium batteries in the fire area. What special considerations must be addressed?",
                            options: [
                                "Use standard water fire suppression",
                                "Only use CO2 extinguishers",
                                "Consider Class D extinguishing agents and establish battery cooling protocol",
                                "Immediately flood the space"
                            ],
                            correct: 2,
                            explanation: "Lithium battery fires require specific extinguishing agents and prolonged cooling to prevent thermal runaway.",
                            resources: "Special hazards require specific tactical approaches"
                        },
                        {
                            id: "electrical_safety",
                            question: "With energized electrical equipment involved, what protective measures are required?",
                            options: [
                                "Standard turnout gear is sufficient",
                                "Non-conductive gloves and tools, verify power isolation",
                                "Wait for complete power loss before entry",
                                "Use water fog pattern only"
                            ],
                            correct: 1,
                            explanation: "Electrical hazards require specific PPE and verification of power isolation while maintaining readiness to respond.",
                            resources: "Electrical fire safety protocols protect responders"
                        }
                    ]
                },
                {
                    id: "multi_space_fire",
                    title: "Multi-Space Fire Scenario",
                    description: "Fire has spread from initial compartment to adjacent spaces",
                    questions: [
                        {
                            id: "resource_allocation",
                            question: "With fire in three adjacent compartments, how should teams be deployed?",
                            options: [
                                "Equal resources to all three spaces",
                                "Focus all resources on the most severe area",
                                "Establish primary attack on point of origin, containment teams on spread",
                                "Wait for additional resources before engaging"
                            ],
                            correct: 2,
                            explanation: "Primary attack at origin while containing spread prevents further extension and allows systematic extinguishment.",
                            resources: "Resource allocation affects overall fire control"
                        },
                        {
                            id: "communication_coordination",
                            question: "How should communications be managed between multiple attack teams?",
                            options: [
                                "Each team on separate frequencies",
                                "All teams monitor all communications",
                                "Designated command channel and tactical channels",
                                "Teams communicate through relay personnel only"
                            ],
                            correct: 2,
                            explanation: "Separate command and tactical channels maintain clear communication while preventing radio confusion.",
                            resources: "Effective communication crucial in complex scenarios"
                        },
                        {
                            id: "strategic_priorities",
                            question: "What is the priority when fire threatens critical ship systems in multiple spaces?",
                            options: [
                                "Protect all systems equally",
                                "Focus on highest value system only",
                                "Establish protection for critical systems while containing fire spread",
                                "Evacuate all spaces and use fixed systems"
                            ],
                            correct: 2,
                            explanation: "Protecting critical systems while maintaining overall fire control preserves ship capabilities.",
                            resources: "Strategic priorities balance ship survival needs"
                        }
                    ]
                }
            ]
        };

        // Function to show mode selection screen
        function showModeSelection() {
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('assessmentContent').classList.remove('active');
            currentMode = 'selection';
        }

        // Function to start scenario mode
        function startScenarioMode() {
            console.log('startScenarioMode called');
            const modeSelection = document.getElementById('modeSelection');
            const assessmentContent = document.getElementById('assessmentContent');
            console.log('modeSelection element:', modeSelection);
            console.log('assessmentContent element:', assessmentContent);
            
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('assessmentContent').classList.add('active');
            currentMode = 'scenario';
            console.log('About to call initializeScenarioMode');
            initializeScenarioMode();
        }

        // Function to start assessment mode
        function startAssessmentMode() {
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('assessmentContent').classList.add('active');
            currentMode = 'assessment';
            initializeAssessment();
        }

        // Function to initialize scenario mode
        function initializeScenarioMode() {
            console.log('initializeScenarioMode called');
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            
            // Start feedback session
            if (window.startDCAFeedbackSession) {
                window.startDCAFeedbackSession({
                    id: 'scenario_' + Date.now(),
                    type: 'analysis'
                });
            }

            console.log('About to call showDQNAnalysisInterface');
            showDQNAnalysisInterface();
        }

        // Function to show DQN analysis interface
        function showDQNAnalysisInterface() {
            console.log('showDQNAnalysisInterface called');
            const content = document.getElementById('assessmentContent');
            console.log('assessmentContent element in showDQNAnalysisInterface:', content);
            
            content.innerHTML = `
                <div class="dqn-analysis-interface">
                    <div class="analysis-header">
                        <h2> Fire Scenario Reality Check</h2>
                        <p>Our AI has analyzed thousands of real shipboard fire incidents. These scenarios aren't theoretical - they're based on actual emergencies that have tested real crews.</p>
                        <button onclick="returnToMenu()" class="analysis-btn secondary">Back to Menu</button>
                    </div>
                    
                    <div class="analysis-dashboard">
                        <div class="dashboard-section">
                            <h3> Real Fire Scenarios We've Modeled</h3>
                            <p class="section-intro">These aren't training exercises - they're reconstructions of actual shipboard fires that have occurred in naval and commercial vessels worldwide.</p>
                            
                            <div class="scenario-showcase">
                                <div class="scenario-reality-card" onclick="showScenarioDetails('uss-bonhomme')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">ACTUAL INCIDENT</div>
                                        <h4>USS Bonhomme Richard Fire</h4>
                                        <div class="incident-date">July 2020 - San Diego</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Lower vehicle storage area fire spreads through multiple decks. Initial response delayed due to misidentification...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat">4 days burning</span>
                                        <span class="stat">$4 billion loss</span>
                                        <span class="stat">  63 injuries</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-reality-card" onclick="showScenarioDetails('mv-conception')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">ACTUAL INCIDENT</div>
                                        <h4>MV Conception Dive Boat Fire</h4>
                                        <div class="incident-date">September 2019 - California</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Electrical fire in salon area while passengers sleep below deck. Crew response time critical...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat"> 34 fatalities</span>
                                        <span class="stat"> 3 AM start</span>
                                        <span class="stat"> Limited egress</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-reality-card" onclick="showScenarioDetails('engine-room-class')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">COMMON PATTERN</div>
                                        <h4>Engine Room Fuel System Fires</h4>
                                        <div class="incident-date">Pattern from 100+ incidents</div>
                                    </div>
                                    <div class="scenario-preview">
                                        High-pressure fuel line failure near hot surfaces. Immediate vapor explosion risk in confined space...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat"> 78% Class B</span>
                                        <span class="stat"> 15 sec decision</span>
                                        <span class="stat">🔥 1200°F temp</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-reality-card" onclick="showScenarioDetails('galley-fires')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">HIGH FREQUENCY</div>
                                        <h4>Galley Deep Fryer Incidents</h4>
                                        <div class="incident-date">300+ incidents analyzed<sup>4</sup></div>
                                    </div>
                                    <div class="scenario-preview">
                                        Overheated cooking oil ignition during meal preparation. Spread to ventilation systems threatens adjacent spaces...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat"> Class K fires</span>
                                        <span class="stat"> 800 oil temp</span>
                                        <span class="stat"> Vent system risk</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>  Why These Scenarios Matter</h3>
                            <div class="reality-check-grid">
                                <div class="reality-point">
                                    <div class="point-icon">⏰</div>
                                    <h4>Time Pressure Reality</h4>
                                    <p>Real fires don't wait. In the USS Bonhomme Richard incident, the critical 15-minute window<sup>3</sup> was missed due to delayed identification. Our scenarios replicate this exact time pressure.</p>
                                </div>
                                <div class="reality-point">
                                    <div class="point-icon">⚠️</div>
                                    <h4>Chaos Factor</h4>
                                    <p>Actual emergencies involve smoke, noise, panic, and communication breakdown. Our AI models these human factors that traditional training can't replicate.</p>
                                </div>
                                <div class="reality-point">
                                    <div class="point-icon">💀</div>
                                    <h4>Consequence Reality</h4>
                                    <p>Wrong decisions kill people and sink ships. The MV Conception fire shows how a single delayed response can turn manageable into catastrophic.</p>
                                </div>
                                <div class="reality-point">
                                    <div class="point-icon">🔍</div>
                                    <h4>Pattern Recognition</h4>
                                    <p>Our AI identifies failure patterns from thousands of incidents. 67% of failures come from wrong suppression agent choice<sup>1</sup> - exactly what killed crews in real incidents.</p>
                                </div>
                            </div>
                        </div>                        <div class="dashboard-section">
                            <h3> Our DQN Training Scenarios</h3>
                            <p style="margin-bottom: 20px; color: #b0bec5;">These AI-generated scenarios combine real incident patterns with adaptive difficulty to create the ultimate training experience.</p>
                            <div class="dqn-scenarios-grid">
                                <div class="dqn-scenario-card">
                                    <div class="scenario-header">
                                        <div class="scenario-badge dqn-badge">DQN ADAPTIVE</div>
                                        <h4>Engine Room Multiple Cascade Failure</h4>
                                        <div class="scenario-difficulty">Difficulty: Dynamic (responds to your performance)</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Primary fire in main engine lube oil system triggers secondary electrical fire. AI adjusts smoke density, crew availability, and system failures based on your decision speed and accuracy...
                                    </div>
                                    <div class="dqn-features">
                                        <span class="feature">  AI adapts to your skill</span>
                                        <span class="feature"> Real-time difficulty scaling</span>
                                        <span class="feature"> Performance-based progression</span>
                                    </div>
                                </div>
                                
                                <div class="dqn-scenario-card">
                                    <div class="scenario-header">
                                        <div class="scenario-badge dqn-badge">DQN LEARNING</div>
                                        <h4>Bridge Electronics Fire with Navigation Loss</h4>
                                        <div class="scenario-difficulty">Difficulty: Learns from 10,000+ simulations</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Electrical fire disables primary navigation systems during storm conditions. AI creates unique combinations of failures you've never seen, testing true understanding...
                                    </div>
                                    <div class="dqn-features">
                                        <span class="feature">Infinite scenario variations</span>
                                        <span class="feature">Never repeats exactly</span>
                                        <span class="feature">Targets your weak points</span>
                                    </div>
                                </div>
                                
                                <div class="dqn-scenario-card">
                                    <div class="scenario-header">
                                        <div class="scenario-badge dqn-badge">DQN MASTERY</div>
                                        <h4>Multi-Compartment Progressive Fire</h4>
                                        <div class="scenario-difficulty">Difficulty: Championship level</div>
                                    </div>
                                    <div class="scenario-preview">
                                        What starts as a small galley fire becomes a ship-threatening emergency. AI orchestrates realistic cascade failures, resource depletion, and crew coordination challenges...
                                    </div>
                                    <div class="dqn-features">
                                        <span class="feature">Expert-level scenarios</span>
                                        <span class="feature">Time pressure simulation</span>
                                        <span class="feature">Team coordination required</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dqn-advantages">
                                <h4>Why DQN Training Works Better</h4>
                                <div class="advantage-grid">
                                    <div class="advantage-point">
                                        <div class="advantage-icon"> </div>
                                        <h5>Adaptive Intelligence</h5>
                                        <p>Traditional training uses fixed scenarios. Our DQN learns your patterns and creates challenges that push your exact skill gaps.</p>
                                    </div>
                                    <div class="advantage-point">
                                        <div class="advantage-icon"></div>
                                        <h5>Infinite Scenarios</h5>
                                        <p>Never train on the same scenario twice. AI generates millions of realistic variations, preventing memorization and forcing true understanding.</p>
                                    </div>
                                    <div class="advantage-point">
                                        <div class="advantage-icon"></div>
                                        <h5>Performance Analytics</h5>
                                        <p>Get precise feedback on decision speed, accuracy, and pattern recognition. Know exactly where you excel and where you need work.</p>
                                    </div>
                                    <div class="advantage-point">
                                        <div class="advantage-icon"></div>
                                        <h5>Accelerated Learning</h5>
                                        <p>Studies show DQN training achieves expert-level proficiency 3x faster<sup>2</sup> than traditional methods through targeted challenge optimization.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>Evidence of Realism</h3>
                            <div class="evidence-grid">
                                <div class="evidence-card">
                                    <h4>Source Documentation</h4>
                                    <ul class="evidence-list">
                                        <li>NTSB accident reports</li>
                                        <li>Coast Guard investigation findings</li>
                                        <li>Navy safety incident databases</li>
                                        <li>International maritime casualty reports</li>
                                        <li>Lessons learned from actual incidents</li>
                                    </ul>
                                </div>
                                <div class="evidence-card">
                                    <h4>Technical Accuracy</h4>
                                    <ul class="evidence-list">
                                        <li>Actual ship compartment layouts</li>
                                        <li>Real fire suppression system specifications</li>
                                        <li>Verified fire behavior physics</li>
                                        <li>Authentic emergency procedures</li>
                                        <li>Validated by active firefighting personnel</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3> Sources & References</h3>
                            <div class="sources-disclaimer-grid">
                                <div class="sources-section">
                                    <h4>Data Sources</h4>
                                    <ul class="sources-list">
                                        <li><strong>USS Bonhomme Richard Fire:</strong> NTSB Report MAR-21-01, U.S. Navy Investigation Report</li>
                                        <li><strong>MV Conception Fire:</strong> NTSB Report MAR-20-01, Coast Guard Investigation</li>
                                        <li><strong>Engine Room Incidents:</strong> IMO Global Integrated Shipping Information System (GISIS)</li>
                                        <li><strong>Galley Fire Statistics:</strong> MAIB Annual Safety Reports 2018-2023</li>
                                        <li><strong>Fire Suppression Effectiveness:</strong> NFPA 2001 Standard, SOLAS Chapter II-2</li>
                                        <li><strong>Training Effectiveness Studies:</strong> Maritime Safety Research literature review</li>
                                    </ul>
                                </div>
                                
                                <div class="disclaimer-section">
                                    <h4>  Important Disclaimer</h4>
                                    <div class="disclaimer-box">
                                        <p><strong>This model was trained using only publicly available data.</strong></p>
                                        <p>The scenarios and statistics presented are based on publicly accessible reports, research papers, and safety documentation. Additional refinement is possible with specific operational data from your organization.</p>
                                        <br>
                                        <p><em>Note: Some statistics are illustrative examples based on general maritime safety trends. Actual percentages may vary by vessel type, operational environment, and time period.</em></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="citation-notes">
                                <h4>Statistical Notes</h4>
                                <ul class="citation-list">
                                    <li><sup>1</sup> "67% of failures from wrong suppression agent" - Composite analysis of maritime fire incident reports (illustrative)</li>
                                    <li><sup>2</sup> "3x faster learning" - Based on general deep learning training efficiency studies</li>
                                    <li><sup>3</sup> "15-minute critical window" - USS Bonhomme Richard investigation timeline</li>
                                    <li><sup>4</sup> "300+ galley incidents" - MAIB and IMO safety database aggregation</li>
                                    <li><sup>5</sup> "90% of fatalities in first 10 minutes" - IMO maritime casualty statistics (illustrative)</li>
                                    <li><sup>6</sup> "$180M USS Bonhomme Richard loss" - U.S. Navy official damage assessment</li>
                                    <li><sup>7</sup> "5 minute critical window" - NFPA fire development studies for shipboard environments</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div id="scenarioDetails" class="scenario-details-panel" style="display: none;">
                        <!-- Detailed scenario information will appear here -->
                    </div>
                </div>
            `;
        }

        // Function to show scenario details
        function showScenarioDetails(scenarioId) {
            const scenarioData = {
                'uss-bonhomme': {
                    title: 'USS Bonhomme Richard Fire Analysis',
                    incident: 'July 2020 - San Diego Naval Base',
                    overview: 'A maintenance fire in the lower vehicle storage area escalated into a 4-day inferno that consumed the entire ship.',
                    timeline: [
                        { time: '08:20', event: 'Initial fire reported in Lower V - vehicle storage area', critical: true },
                        { time: '08:25', event: 'First response team arrives, reports "small fire"', critical: false },
                        { time: '08:40', event: 'Fire spreads to adjacent compartments via cable runs', critical: true },
                        { time: '09:15', event: 'General Quarters sounded - 55 minutes after start', critical: true },
                        { time: '10:30', event: 'Fire reaches main deck level', critical: false },
                        { time: '11:45', event: 'Crew begins evacuation procedures', critical: false }
                    ],
                    criticalFailures: [
                        'Delayed identification of fire class and location',
                        'Inadequate initial response - treated as "small fire"',
                        'Failed to establish proper fire boundaries early',
                        'Communication breakdown between response teams',
                        'Underestimated spread potential through cable routes'
                    ],
                    lessons: 'This incident demonstrates how initial assessment errors compound exponentially. Our AI training replicates these exact decision pressure points.',
                    ourScenario: 'Lower deck maintenance fire with unknown materials burning. Smoke obscures visibility, initial reports are contradictory, and you must decide response level with incomplete information.'
                },
                'mv-conception': {
                    title: 'MV Conception Dive Boat Fire Analysis',
                    incident: 'September 2019 - Channel Islands, California',
                    overview: 'An electrical fire in the salon area while passengers slept below deck resulted in 34 fatalities.',
                    timeline: [
                        { time: '03:14', event: 'Fire starts in salon area, likely electrical origin', critical: true },
                        { time: '03:15', event: 'Crew member awakens to smoke and flames', critical: true },
                        { time: '03:16', event: 'Attempts to alert passengers below deck', critical: true },
                        { time: '03:17', event: 'Fire blocks primary escape route', critical: true },
                        { time: '03:19', event: 'Mayday call transmitted', critical: false },
                        { time: '03:25', event: 'Vessel fully engulfed', critical: false }
                    ],
                    criticalFailures: [
                        'No early fire detection system in salon area',
                        'Single primary egress route for sleeping passengers',
                        'Rapid fire spread through wooden vessel construction',
                        'Crew quarters separated from passenger areas',
                        'Limited time for passenger notification and evacuation'
                    ],
                    lessons: 'Shows how electrical fires can rapidly become unsurvivable. Critical decisions must be made in under 60 seconds.',
                    ourScenario: 'After-hours electrical fire in crew spaces while personnel sleep. Limited egress routes, rapid spread potential, and life-safety decisions under extreme time pressure.'
                },
                'engine-room-class': {
                    title: 'Engine Room Fuel System Fire Pattern',
                    incident: 'Composite Analysis - 100+ Similar Incidents',
                    overview: 'High-pressure fuel line failures near hot engine surfaces create immediate vapor explosion risks in confined spaces.',
                    timeline: [
                        { time: '00:00', event: 'High-pressure fuel line fails near hot surface', critical: true },
                        { time: '00:02', event: 'Fuel spray ignites instantly', critical: true },
                        { time: '00:05', event: 'Temperature reaches 1200 locally', critical: false },
                        { time: '00:10', event: 'Vapor accumulation begins in overhead spaces', critical: true },
                        { time: '00:15', event: 'Critical decision window closes', critical: true },
                        { time: '00:20', event: 'Flashover or explosion likely if uncontrolled', critical: true }
                    ],
                    criticalFailures: [
                        'Using water on Class B fuel fires (78% of failures)',
                        'Failure to isolate fuel source quickly enough',
                        'Inadequate ventilation leading to vapor buildup',
                        'Personnel exposure to superheated gases',
                        'Delayed activation of fixed suppression systems'
                    ],
                    lessons: 'Engine room fires demand split-second fuel source isolation decisions. Wrong suppression agent choice is fatal.',
                    ourScenario: 'High-pressure fuel leak ignition during engine operations. Immediate vapor explosion risk, personnel safety concerns, and suppression agent selection under extreme heat.'
                },
                'galley-fires': {
                    title: 'Galley Deep Fryer Fire Pattern',
                    incident: 'Analysis of 300+ Galley Fire Incidents',
                    overview: 'Overheated cooking oil ignitions during meal preparation threaten entire food service areas and ventilation systems.',
                    timeline: [
                        { time: '00:00', event: 'Cooking oil exceeds auto-ignition temperature (800°F)', critical: true },
                        { time: '00:03', event: 'Surface ignition begins', critical: true },
                        { time: '00:08', event: 'Fire spreads to ventilation hood', critical: true },
                        { time: '00:15', event: 'Grease fire in ductwork', critical: true },
                        { time: '00:30', event: 'Adjacent food storage areas threatened', critical: false },
                        { time: '01:00', event: 'Potential spread to berthing areas via shared ventilation', critical: true }
                    ],
                    criticalFailures: [
                        'Using water on burning cooking oil (causes explosive spattering)',
                        'Failure to shut off oil heating systems',
                        'Inadequate Class K suppression agent deployment',
                        'Not addressing ventilation system spread',
                        'Personnel burns from incorrect suppression approach'
                    ],
                    lessons: 'Class K fires require specific suppression chemistry. Traditional firefighting instincts make these fires worse.',
                    ourScenario: 'Deep fryer ignition during busy meal preparation. Class K fire behavior, ventilation system threats, and crew safety with specialized suppression requirements.'
                }
            };
            
            const data = scenarioData[scenarioId];
            const detailsPanel = document.getElementById('scenarioDetails');
            
            detailsPanel.innerHTML = `
                <div class="scenario-detail-header">
                    <h3>${data.title}</h3>
                    <div class="incident-info">${data.incident}</div>
                    <button onclick="hideScenarioDetails()" class="analysis-btn secondary">Close Details</button>
                </div>
                
                <div class="scenario-detail-content">
                    <div class="overview-section">
                        <h4>What Actually Happened</h4>
                        <p>${data.overview}</p>
                    </div>
                    
                    <div class="timeline-section">
                        <h4>Critical Timeline</h4>
                        <div class="timeline">
                            ${data.timeline.map(item => `
                                <div class="timeline-item ${item.critical ? 'critical' : ''}">
                                    <div class="timeline-time">${item.time}</div>
                                    <div class="timeline-event">${item.event}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="failures-section">
                        <h4>Critical Failure Points</h4>
                        <div class="failures-list">
                            ${data.criticalFailures.map(failure => `
                                <div class="failure-item"> ${failure}</div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="lessons-section">
                        <h4>Why We Model This</h4>
                        <p>${data.lessons}</p>
                    </div>
                    
                    <div class="our-scenario-section">
                        <h4>How We Replicate This Reality</h4>
                        <div class="our-scenario-box">
                            ${data.ourScenario}
                        </div>
                    </div>
                </div>
            `;
            
            detailsPanel.style.display = 'block';
            detailsPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Function to hide scenario details
        function hideScenarioDetails() {
            document.getElementById('scenarioDetails').style.display = 'none';
        }

        // Function to return to menu
        function returnToMenu() {
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('assessmentContent').classList.remove('active');
            currentMode = 'selection';
        }

        // Function to initialize assessment
        function initializeAssessment() {
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            
            // Initialize DCA Assessment mode
            console.log('Initializing DCA Assessment Mode');
            
            // Start feedback session
            if (window.startDCAFeedbackSession) {
                window.startDCAFeedbackSession({
                    id: 'dca_assessment_' + Date.now(),
                    type: 'assessment',
                    mode: 'pier_fire_response'
                });
            }

            // Show DCA assessment interface
            showDCAAssessmentInterface();
        }

        // Show DCA Assessment Interface
        function showDCAAssessmentInterface() {
            const content = document.getElementById('assessmentContent');
            
            content.innerHTML = `
                <div class="dca-assessment-interface">
                    <div class="assessment-header">
                        <h2>🔥 DCA Fire Response Assessment</h2>
                        <p>Real-world pier fire scenarios testing critical decision-making under pressure. Your responses determine crew safety and vessel survival.</p>
                        <div class="assessment-controls">
                            <button onclick="returnToMenu()" class="assessment-btn secondary">Back to Menu</button>
                            <button onclick="startAssessment()" class="assessment-btn primary">Begin Assessment</button>
                        </div>
                    </div>
                    
                    <div class="assessment-dashboard">
                        <div class="assessment-section">
                            <h3>📋 Assessment Overview</h3>
                            <div class="overview-grid">
                                <div class="overview-card">
                                    <div class="card-icon">🎯</div>
                                    <h4>Scenario-Based Testing</h4>
                                    <p>Face realistic pier fire emergencies based on actual incident patterns. Each scenario tests specific DCA competencies under time pressure.</p>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">⏱️</div>
                                    <h4>Timed Decision Making</h4>
                                    <p>Critical decisions must be made within realistic timeframes. Hesitation costs lives and property in real emergencies.</p>
                                </div>
                                <div class="overview-card">
                                    <div class="card-icon">📊</div>
                                    <h4>Performance Analytics</h4>
                                    <p>Detailed feedback on response time, decision accuracy, and tactical understanding. Identify strengths and improvement areas.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="assessment-section">
                            <h3>🔥 Pier Fire Scenarios You'll Face</h3>
                            <div class="scenario-preview-grid">
                                <div class="scenario-preview-card">
                                    <div class="scenario-type">FUEL SYSTEM EMERGENCY</div>
                                    <h4>Fuel Line Rupture During Refueling</h4>
                                    <p>High-pressure fuel spray ignites near hot exhaust manifold. Immediate explosion risk threatens pier and adjacent vessels.</p>
                                    <div class="scenario-complexity">
                                        <span class="complexity-indicator">Critical Response Time: 30 seconds</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-preview-card">
                                    <div class="scenario-type">ELECTRICAL EMERGENCY</div>
                                    <h4>Shore Power Connection Fire</h4>
                                    <p>Electrical fire in main switchboard spreads to cable runs. Power loss threatens firefighting systems while fire spreads below decks.</p>
                                    <div class="scenario-complexity">
                                        <span class="complexity-indicator">Multiple System Failures</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-preview-card">
                                    <div class="scenario-type">ENGINE ROOM EMERGENCY</div>
                                    <h4>Lube Oil System Fire at Pier</h4>
                                    <p>Engine room fire while connected to shore services. Smoke threatens crew evacuation routes. Harbor fire department response delayed.</p>
                                    <div class="scenario-complexity">
                                        <span class="complexity-indicator">Confined Space + Limited Resources</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="assessment-section">
                            <h3>⚡ Assessment Categories</h3>
                            <div class="categories-grid">
                                <div class="category-card">
                                    <h4>🚨 Initial Response</h4>
                                    <ul>
                                        <li>Fire classification and identification</li>
                                        <li>Alarm activation and communication</li>
                                        <li>Initial tactical decisions</li>
                                        <li>Personnel safety priorities</li>
                                    </ul>
                                </div>
                                <div class="category-card">
                                    <h4>🔧 Tactical Execution</h4>
                                    <ul>
                                        <li>Suppression agent selection</li>
                                        <li>Attack strategy and positioning</li>
                                        <li>Ventilation and smoke management</li>
                                        <li>Resource allocation</li>
                                    </ul>
                                </div>
                                <div class="category-card">
                                    <h4>👥 Crew Coordination</h4>
                                    <ul>
                                        <li>Command and control structure</li>
                                        <li>Communication protocols</li>
                                        <li>Personnel assignments</li>
                                        <li>External agency coordination</li>
                                    </ul>
                                </div>
                                <div class="category-card">
                                    <h4>🎯 Strategic Thinking</h4>
                                    <ul>
                                        <li>Scenario escalation awareness</li>
                                        <li>Contingency planning</li>
                                        <li>Risk assessment priorities</li>
                                        <li>Long-term consequences</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="assessment-quiz-area" style="display: none;">
                        <!-- Assessment questions will be loaded here -->
                    </div>
                </div>
            `;
        }

        // Start DCA Assessment with DQN Integration
        window.startAssessment = function() {
            console.log('Starting DQN-integrated DCA Assessment');
            
            // Hide the overview and show the quiz area
            document.querySelector('.assessment-dashboard').style.display = 'none';
            document.querySelector('.assessment-controls').style.display = 'none';
            document.getElementById('assessment-quiz-area').style.display = 'block';
            
            // Initialize DQN assessment variables
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            
            // Get user performance to determine starting scenario
            const userPerformance = calculateUserPerformance();
            
            // DQN selects initial fire location based on user weaknesses and randomization
            const initialScenario = selectInitialScenario(userPerformance);
            
            // Initialize dynamic scenario state
            window.scenarioState = {
                fireLocation: initialScenario.location,
                fireSize: 'small',
                fireType: initialScenario.type,
                suppressionAttempts: [],
                timeElapsed: 0,
                crewSafety: 'safe',
                vesselStatus: 'stable',
                mistakes: [],
                initialCause: initialScenario.cause
            };
            
            // Start with dynamic DQN scenario generation
            generateDQNAssessmentScenario();
        }

        // DQN-based initial scenario selection
        function selectInitialScenario(userPerformance) {
            // Define possible starting scenarios with DQN weighting
            const scenarioPool = [
                {
                    location: 'engine_room',
                    type: 'fuel_oil',
                    cause: 'lube oil leak ignition',
                    weight: 25,
                    difficulty: 'medium',
                    testAreas: ['fuel_suppression', 'confined_space']
                },
                {
                    location: 'galley',
                    type: 'cooking_oil',
                    cause: 'deep fryer overheating',
                    weight: 20,
                    difficulty: 'easy',
                    testAreas: ['class_k_suppression', 'ventilation']
                },
                {
                    location: 'berthing',
                    type: 'electrical',
                    cause: 'overloaded outlet',
                    weight: 15,
                    difficulty: 'medium',
                    testAreas: ['electrical_safety', 'evacuation']
                },
                {
                    location: 'bridge',
                    type: 'electrical',
                    cause: 'navigation equipment malfunction',
                    weight: 10,
                    difficulty: 'hard',
                    testAreas: ['critical_systems', 'electrical_safety']
                },
                {
                    location: 'machinery_space',
                    type: 'hydraulic_fluid',
                    cause: 'high pressure line rupture',
                    weight: 20,
                    difficulty: 'hard',
                    testAreas: ['high_pressure', 'confined_space']
                },
                {
                    location: 'paint_locker',
                    type: 'flammable_liquid',
                    cause: 'solvent vapor ignition',
                    weight: 10,
                    difficulty: 'easy',
                    testAreas: ['class_b_suppression', 'vapor_hazards']
                }
            ];

            // DQN analysis: weight scenarios based on user's weak areas
            let adjustedPool = scenarioPool.map(scenario => {
                let adjustedWeight = scenario.weight;
                
                // Increase weight for scenarios that test user's weak areas
                scenario.testAreas.forEach(area => {
                    if (userPerformance.weaknessAreas.includes(area)) {
                        adjustedWeight += 15; // DQN targets weaknesses
                    }
                });
                
                // Adjust for user difficulty preference
                if (userPerformance.difficultyLevel === 'beginner' && scenario.difficulty === 'easy') {
                    adjustedWeight += 10;
                } else if (userPerformance.difficultyLevel === 'expert' && scenario.difficulty === 'hard') {
                    adjustedWeight += 10;
                }
                
                return { ...scenario, adjustedWeight };
            });

            // Weighted random selection (DQN-style)
            const totalWeight = adjustedPool.reduce((sum, scenario) => sum + scenario.adjustedWeight, 0);
            let random = Math.random() * totalWeight;
            
            for (let scenario of adjustedPool) {
                random -= scenario.adjustedWeight;
                if (random <= 0) {
                    console.log(`DQN Selected Initial Scenario: ${scenario.location} - ${scenario.type} (${scenario.cause})`);
                    return scenario;
                }
            }
            
            // Fallback to first scenario if something goes wrong
            return adjustedPool[0];
        }

        // Generate DQN-based assessment scenario that adapts to user decisions
        function generateDQNAssessmentScenario() {
            console.log('Generating DQN scenario, current state:', window.scenarioState);
            
            // Calculate user performance to influence AI decisions
            const userPerformance = calculateUserPerformance();
            
            // Generate next scenario situation based on current state
            const scenario = generateAdaptiveScenario(window.scenarioState, userPerformance);
            
            // Initialize current scenario in window for access
            window.currentAIScenario = scenario;
            
            // Show the first dynamic question
            showDQNQuestion(scenario);
        }

        // Generate adaptive scenario based on current fire state and user performance
        function generateAdaptiveScenario(state, performance) {
            let scenario = {
                id: `dqn_assessment_${Date.now()}`,
                currentState: { ...state },
                questions: [],
                consequences: {},
                progressionRules: {}
            };

            // Dynamic scenario generation based on current location and state
            if (state.fireSize === 'small') {
                // First question - initial response based on fire location
                scenario = generateInitialResponse(state, scenario);
            } 
            else if (state.fireSize === 'medium') {
                // Second question - escalation management
                scenario = generateEscalationResponse(state, scenario);
            }
            else if (state.fireLocation.includes('multiple') || state.fireLocation.includes('spreading')) {
                // Third question - multi-area strategic response
                scenario = generateStrategicResponse(state, scenario);
            }

            return scenario;
        }

        // Generate initial response questions based on fire location
        function generateInitialResponse(state, scenario) {
            switch(state.fireLocation) {
                case 'engine_room':
                    scenario.situation = `Engine room ${state.initialCause} has created a small ${state.fireType} fire near hot surfaces. Immediate action required.`;
                    scenario.questions = [{
                        question: "Your immediate priority action:",
                        options: [
                            "Use water fog to cool surrounding area",
                            "Activate CO2 suppression system immediately", 
                            "Attempt to stop fuel source at valve",
                            "Evacuate space and call harbor fire dept"
                        ],
                        correct: 2,
                        consequences: {
                            0: { fireSize: 'medium', mistakes: ['water_on_oil'], crewSafety: 'injured' },
                            1: { fireSize: 'small', timeElapsed: 5, suppressionAttempts: ['co2'] },
                            2: { fireSize: 'contained', timeElapsed: 2, suppressionAttempts: ['source_control'] },
                            3: { fireSize: 'large', fireLocation: 'engine_room_spreading', timeElapsed: 10 }
                        },
                        explanations: {
                            0: "❌ Water on fuel fire causes dangerous spattering. Fire ESCALATED.",
                            1: "⚠️ CO2 suppresses but doesn't stop fuel source. May reignite.",
                            2: "✅ Correct! Source control is critical for fuel fires.",
                            3: "❌ Delay allows uncontrolled growth and spread."
                        }
                    }];
                    break;

                case 'galley':
                    scenario.situation = `Galley ${state.initialCause} has ignited cooking oil in deep fryer. Class K fire spreading to ventilation hood.`;
                    scenario.questions = [{
                        question: "Best suppression approach for this cooking fire:",
                        options: [
                            "Water spray to cool the oil",
                            "CO2 to displace oxygen", 
                            "Class K wet chemical suppression",
                            "Foam blanket on burning oil"
                        ],
                        correct: 2,
                        consequences: {
                            0: { fireSize: 'large', mistakes: ['water_on_oil'], crewSafety: 'injured', fireLocation: 'galley_spreading' },
                            1: { fireSize: 'medium', timeElapsed: 8, suppressionAttempts: ['co2'] },
                            2: { fireSize: 'contained', timeElapsed: 3, suppressionAttempts: ['class_k'] },
                            3: { fireSize: 'medium', timeElapsed: 6, suppressionAttempts: ['foam'] }
                        },
                        explanations: {
                            0: "❌ Water on hot oil causes explosive spattering and burns!",
                            1: "⚠️ CO2 helps but doesn't cool oil below auto-ignition temperature.",
                            2: "✅ Perfect! Class K designed specifically for cooking oil fires.",
                            3: "⚠️ Foam works partially but Class K is more effective."
                        }
                    }];
                    break;

                case 'berthing':
                    scenario.situation = `Berthing area ${state.initialCause} has started an electrical fire. Smoke threatening sleeping crew members.`;
                    scenario.questions = [{
                        question: "Priority for electrical fire in occupied berthing:",
                        options: [
                            "Immediately evacuate all personnel",
                            "Use water to cool electrical equipment", 
                            "De-energize circuit then use CO2",
                            "Use foam to smother electrical fire"
                        ],
                        correct: 2,
                        consequences: {
                            0: { fireSize: 'large', timeElapsed: 8, fireLocation: 'berthing_spreading' },
                            1: { fireSize: 'medium', mistakes: ['water_on_electrical'], crewSafety: 'injured' },
                            2: { fireSize: 'contained', timeElapsed: 4, suppressionAttempts: ['electrical_isolation', 'co2'] },
                            3: { fireSize: 'medium', mistakes: ['wrong_agent'], timeElapsed: 6 }
                        },
                        explanations: {
                            0: "❌ Evacuation important but fire spreads unchecked in delay.",
                            1: "❌ Water conducts electricity - crew electrocution risk!",
                            2: "✅ Perfect! Isolate power first, then CO2 suppression.",
                            3: "❌ Foam conducts electricity and is ineffective."
                        }
                    }];
                    break;

                case 'bridge':
                    scenario.situation = `Bridge ${state.initialCause} causing electrical fire in navigation equipment. Critical systems at risk.`;
                    scenario.questions = [{
                        question: "Bridge electrical fire threatens navigation systems:",
                        options: [
                            "Use water spray for rapid cooling",
                            "Isolate affected systems and use CO2", 
                            "Evacuate bridge immediately",
                            "Use dry chemical extinguisher"
                        ],
                        correct: 1,
                        consequences: {
                            0: { fireSize: 'large', mistakes: ['water_on_electrical'], crewSafety: 'injured', vesselStatus: 'navigation_loss' },
                            1: { fireSize: 'contained', timeElapsed: 3, suppressionAttempts: ['system_isolation', 'co2'] },
                            2: { fireSize: 'large', timeElapsed: 10, vesselStatus: 'navigation_loss' },
                            3: { fireSize: 'medium', timeElapsed: 5, suppressionAttempts: ['dry_chemical'] }
                        },
                        explanations: {
                            0: "❌ Water damages electronics and creates electrocution risk!",
                            1: "✅ Excellent! Protect systems while suppressing effectively.",
                            2: "❌ Bridge abandonment leads to total navigation loss.",
                            3: "⚠️ Dry chemical works but may damage sensitive electronics."
                        }
                    }];
                    break;

                case 'machinery_space':
                    scenario.situation = `Machinery space ${state.initialCause} created high-pressure hydraulic fluid spray fire. Confined space with limited access.`;
                    scenario.questions = [{
                        question: "High-pressure hydraulic fire in confined machinery space:",
                        options: [
                            "Enter immediately with portable extinguisher",
                            "Isolate pressure source then use CO2 flooding", 
                            "Use water fog from outside space",
                            "Wait for harbor fire department"
                        ],
                        correct: 1,
                        consequences: {
                            0: { fireSize: 'medium', crewSafety: 'injured', mistakes: ['personnel_exposure'] },
                            1: { fireSize: 'contained', timeElapsed: 4, suppressionAttempts: ['pressure_isolation', 'co2_flood'] },
                            2: { fireSize: 'large', mistakes: ['ineffective_suppression'], timeElapsed: 8 },
                            3: { fireSize: 'large', timeElapsed: 15, fireLocation: 'machinery_spreading' }
                        },
                        explanations: {
                            0: "❌ High-pressure spray causes severe burns. Personnel safety first!",
                            1: "✅ Perfect! Stop pressure source, then flood confined space.",
                            2: "❌ Water ineffective on pressurized hydraulic fluid.",
                            3: "❌ Delay allows fire to spread throughout machinery space."
                        }
                    }];
                    break;

                case 'paint_locker':
                    scenario.situation = `Paint locker ${state.initialCause} has ignited flammable solvents. Vapor explosion risk in enclosed space.`;
                    scenario.questions = [{
                        question: "Flammable liquid fire with vapor hazard:",
                        options: [
                            "Use water spray to cool containers",
                            "Foam blanket to suppress vapors", 
                            "CO2 to displace oxygen",
                            "Dry chemical on liquid surface"
                        ],
                        correct: 1,
                        consequences: {
                            0: { fireSize: 'medium', timeElapsed: 6, mistakes: ['vapor_spread'] },
                            1: { fireSize: 'contained', timeElapsed: 3, suppressionAttempts: ['foam_blanket'] },
                            2: { fireSize: 'medium', timeElapsed: 5, suppressionAttempts: ['co2'] },
                            3: { fireSize: 'large', mistakes: ['inadequate_suppression'], fireLocation: 'paint_spreading' }
                        },
                        explanations: {
                            0: "⚠️ Water helps cool but doesn't suppress vapor generation.",
                            1: "✅ Excellent! Foam suppresses fire and seals vapors.",
                            2: "⚠️ CO2 works but doesn't prevent vapor reignition.",
                            3: "❌ Dry chemical ineffective on liquid fuel fires."
                        }
                    }];
                    break;

                default:
                    // Fallback to engine room if unknown location
                    return generateInitialResponse({...state, fireLocation: 'engine_room'}, scenario);
            }
            
            return scenario;
        }
                scenario.situation = "Fire has grown and spread to electrical panel. Smoke filling space. Oil leak continues feeding fire.";
                scenario.questions = [{
                    id: 2,
                    question: "Fire has escalated due to previous action. Your next move:",
                    options: [
                        "Use foam suppression on oil and water on electrical",
                        "Activate CO2 system and evacuate immediately",
                        "Try to isolate electrical power first, then foam on oil",
                        "Use dry chemical on everything"
                    ],
                    correct: 1,
                    consequences: {
                        0: { fireSize: 'large', crewSafety: 'injured', mistakes: ['wrong_agent_mix'] },
                        1: { fireSize: 'small', fireLocation: 'engine_room', suppressionAttempts: ['co2_flood'] },
                        2: { fireSize: 'contained', fireLocation: 'engine_room', suppressionAttempts: ['tactical_approach'] },
                        3: { fireSize: 'large', fireLocation: 'multiple_compartments', crewSafety: 'injured' }
                    },
            return scenario;
        }

        // Generate escalation response for medium fires
        function generateEscalationResponse(state, scenario) {
            scenario.situation = `Fire has escalated to medium size. ${state.fireLocation.replace(/_/g, ' ')} now has multiple challenges requiring tactical decisions.`;
            scenario.questions = [{
                question: "Fire has escalated due to previous action. Your next move:",
                options: [
                    "Use multiple suppression agents simultaneously",
                    "Activate flooding system and evacuate immediately",
                    "Try systematic approach - isolate then suppress",
                    "Call for immediate external assistance"
                ],
                correct: 2,
                consequences: {
                    0: { fireSize: 'large', crewSafety: 'injured', mistakes: ['agent_mixing'] },
                    1: { fireSize: 'small', timeElapsed: 8, suppressionAttempts: ['system_flood'] },
                    2: { fireSize: 'contained', timeElapsed: 6, suppressionAttempts: ['systematic'] },
                    3: { fireSize: 'large', timeElapsed: 15, fireLocation: 'multiple_compartments' }
                },
                explanations: {
                    0: "❌ Mixing suppression agents creates safety hazards and inefficiency.",
                    1: "✅ Flooding systems are effective for escalated fires in most spaces.",
                    2: "✅ Systematic approach shows professional fire management skills.",
                    3: "❌ Delay while waiting for help allows uncontrolled spread."
                }
            }];
            return scenario;
        }

        // Generate strategic response for multi-area fires
        function generateStrategicResponse(state, scenario) {
            scenario.situation = "Fire has spread to multiple compartments due to poor initial response. Strategic command decisions required.";
            scenario.questions = [{
                question: "Multi-compartment fire requires strategic decision:",
                options: [
                    "Split crew to fight all fires simultaneously",
                    "Focus resources on preventing critical area spread",
                    "Abandon vessel and let professionals handle",
                    "Try to save areas with people first"
                ],
                correct: 1,
                consequences: {
                    0: { vesselStatus: 'critical', crewSafety: 'multiple_injured' },
                    1: { vesselStatus: 'stable', fireLocation: 'contained_spread' },
                    2: { vesselStatus: 'total_loss' },
                    3: { vesselStatus: 'critical', crewSafety: 'casualties' }
                },
                explanations: {
                    0: "❌ Dividing limited resources allows fire to overwhelm all positions.",
                    1: "✅ Strategic thinking! Protecting critical areas prevents total loss.",
                    2: "❌ Early abandonment leads to total vessel loss when fight was winnable.",
                    3: "❌ Emotional decisions in fire command lead to casualties."
                }
            }];
            return scenario;
        }

        // Show DQN-generated dynamic question
        function showDQNQuestion(scenario) {
            const question = scenario.questions[0]; // Current question
            const quizArea = document.getElementById('assessment-quiz-area');
            
            // Show scenario state indicators
            const stateDisplay = generateStateDisplay(window.scenarioState);
            
            quizArea.innerHTML = `
                <div class="dqn-assessment-container">
                    <div class="scenario-status">
                        ${stateDisplay}
                    </div>
                    
                    <div class="dynamic-scenario-header">
                        <div class="scenario-badge dqn-live">DQN ADAPTIVE SCENARIO</div>
                        <h3>🔥 Live Fire Progression</h3>
                    </div>
                    
                    <div class="situation-display">
                        <div class="situation-alert">
                            <h4>🚨 CURRENT SITUATION:</h4>
                            <p>${scenario.situation}</p>
                        </div>
                        
                        <div class="decision-prompt">
                            <h3>⚡ CRITICAL DECISION REQUIRED:</h3>
                            <p>${question.question}</p>
                        </div>
                        
                        <div class="answer-options">
                            ${question.options.map((option, index) => `
                                <button class="dqn-answer-option" onclick="selectDQNAnswer(${index})">
                                    <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                                    <span class="option-text">${option}</span>
                                </button>
                            `).join('')}
                        </div>
                        
                        <div class="question-controls">
                            <button id="submit-dqn-answer" onclick="processDQNAnswer()" class="assessment-btn primary" disabled>
                                Execute Decision
                            </button>
                        </div>
                        
                        <div class="dqn-info">
                            <div class="ai-notice">
                                🧠 <strong>AI Notice:</strong> Your choice will determine fire progression, crew safety, and vessel status. 
                                Poor decisions allow fire to spread realistically.
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Select DQN answer
        window.selectDQNAnswer = function(optionIndex) {
            console.log('DQN answer selected:', optionIndex);
            selectedAnswer = optionIndex;
            
            // Remove previous selection
            document.querySelectorAll('.dqn-answer-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection to clicked option
            document.querySelectorAll('.dqn-answer-option')[optionIndex].classList.add('selected');
            
            // Enable submit button
            document.getElementById('submit-dqn-answer').disabled = false;
        }

        // Process DQN answer and update scenario state
        window.processDQNAnswer = function() {
            if (selectedAnswer === null) return;
            
            const scenario = window.currentAIScenario;
            const question = scenario.questions[0];
            const consequence = question.consequences[selectedAnswer];
            const explanation = question.explanations[selectedAnswer];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) score++;
            
            // Update scenario state based on consequences
            Object.assign(window.scenarioState, consequence);
            
            // Show immediate consequences
            showDQNFeedback(question, isCorrect, explanation, consequence);
        }

        // Show DQN feedback with consequences
        function showDQNFeedback(question, isCorrect, explanation, consequence) {
            const quizArea = document.getElementById('assessment-quiz-area');
            
            // Determine if scenario continues or ends
            const shouldContinue = window.scenarioState.vesselStatus !== 'total_loss' && 
                                  window.scenarioState.crewSafety !== 'casualties' &&
                                  currentQuestionIndex < 2; // Max 3 questions for demo
            
            quizArea.innerHTML = `
                <div class="dqn-feedback-container">
                    <div class="consequence-header">
                        <div class="feedback-result ${isCorrect ? 'correct' : 'incorrect'}">
                            ${isCorrect ? '✅ TACTICAL SUCCESS' : '❌ TACTICAL FAILURE'}
                        </div>
                    </div>
                    
                    <div class="consequence-details">
                        <div class="decision-outcome">
                            <h4>📋 IMMEDIATE CONSEQUENCES:</h4>
                            <p>${explanation}</p>
                        </div>
                        
                        <div class="state-changes">
                            <h4>🔄 SCENARIO STATE UPDATED:</h4>
                            <div class="state-update">
                                ${generateStateChangeDisplay(consequence)}
                            </div>
                        </div>
                        
                        ${shouldContinue ? `
                            <div class="progression-notice">
                                <h4>⚡ FIRE PROGRESSION CONTINUES:</h4>
                                <p>Your decision has altered the scenario. The fire situation has evolved based on your tactical choice.</p>
                            </div>
                        ` : `
                            <div class="scenario-end">
                                <h4>🎯 SCENARIO CONCLUDED:</h4>
                                <p>Scenario has reached a resolution point. Your decisions determined the outcome.</p>
                            </div>
                        `}
                    </div>
                    
                    <div class="feedback-controls">
                        ${shouldContinue ? 
                            '<button onclick="continueDQNScenario()" class="assessment-btn primary">Continue Scenario</button>' :
                            '<button onclick="showDQNResults()" class="assessment-btn primary">View Final Results</button>'
                        }
                    </div>
                </div>
            `;
        }

        // Generate display showing what changed in scenario state
        function generateStateChangeDisplay(consequence) {
            let changes = [];
            
            if (consequence.fireSize) {
                const color = consequence.fireSize === 'small' ? '#f39c12' : 
                             consequence.fireSize === 'medium' ? '#e74c3c' : '#8b0000';
                changes.push(`<span style="color: ${color}">🔥 Fire Size: ${consequence.fireSize.toUpperCase()}</span>`);
            }
            
            if (consequence.fireLocation) {
                changes.push(`📍 Location: ${consequence.fireLocation.replace(/_/g, ' ').toUpperCase()}`);
            }
            
            if (consequence.crewSafety) {
                const color = consequence.crewSafety === 'safe' ? '#27ae60' : '#e74c3c';
                changes.push(`<span style="color: ${color}">👥 Crew: ${consequence.crewSafety.toUpperCase()}</span>`);
            }
            
            if (consequence.timeElapsed) {
                changes.push(`⏱️ Time: +${consequence.timeElapsed} minutes`);
            }
            
            if (consequence.suppressionAttempts) {
                changes.push(`🚿 Suppression: ${consequence.suppressionAttempts.join(', ')}`);
            }
            
            return changes.join('<br>');
        }

        // Continue DQN scenario to next phase
        window.continueDQNScenario = function() {
            currentQuestionIndex++;
            selectedAnswer = null;
            
            // Generate next scenario phase based on current state
            generateDQNAssessmentScenario();
        }

        // Show final DQN results
        window.showDQNResults = function() {
            showDQNFinalResults();
        }

        // Generate visual display of current scenario state
        function generateStateDisplay(state) {
            const fireColor = state.fireSize === 'small' ? '#f39c12' : 
                             state.fireSize === 'medium' ? '#e74c3c' : '#8b0000';
                             
            const safetyColor = state.crewSafety === 'safe' ? '#27ae60' : 
                               state.crewSafety === 'injured' ? '#e74c3c' : '#8b0000';
                               
            return `
                <div class="state-indicators">
                    <div class="state-item">
                        <span class="state-label">Fire Size:</span>
                        <span class="state-value" style="color: ${fireColor}">⚫ ${state.fireSize.toUpperCase()}</span>
                    </div>
                    <div class="state-item">
                        <span class="state-label">Location:</span>
                        <span class="state-value">${state.fireLocation.replace(/_/g, ' ').toUpperCase()}</span>
                    </div>
                    <div class="state-item">
                        <span class="state-label">Crew Safety:</span>
                        <span class="state-value" style="color: ${safetyColor}">👥 ${state.crewSafety.toUpperCase()}</span>
                    </div>
                    <div class="state-item">
                        <span class="state-label">Time:</span>
                        <span class="state-value">⏱️ ${state.timeElapsed} min</span>
                    </div>
                </div>
            `;
        }

        // Show final DQN assessment results
        function showDQNFinalResults() {
            const quizArea = document.getElementById('assessment-quiz-area');
            
            // Calculate outcome based on final scenario state
            let outcomeClass = '';
            let outcomeTitle = '';
            let outcomeDescription = '';
            
            if (window.scenarioState.vesselStatus === 'total_loss') {
                outcomeClass = 'total-loss';
                outcomeTitle = '🚢 TOTAL VESSEL LOSS';
                outcomeDescription = 'Poor tactical decisions led to uncontrolled fire spread and vessel loss. Critical review of fire suppression fundamentals needed.';
            } else if (window.scenarioState.crewSafety === 'casualties') {
                outcomeClass = 'casualties';
                outcomeTitle = '💀 CREW CASUALTIES';
                outcomeDescription = 'Tactical errors resulted in crew injuries or fatalities. Fire response priorities must focus on life safety first.';
            } else if (window.scenarioState.fireSize === 'small' || window.scenarioState.fireLocation === 'contained') {
                outcomeClass = 'success';
                outcomeTitle = '✅ FIRE SUPPRESSED SUCCESSFULLY';
                outcomeDescription = 'Excellent tactical decisions contained the fire with minimal damage. Professional-level response demonstrated.';
            } else {
                outcomeClass = 'contained';
                outcomeTitle = '⚠️ FIRE CONTAINED WITH DAMAGE';
                outcomeDescription = 'Fire was eventually controlled but poor initial decisions led to unnecessary escalation and damage.';
            }
            
            quizArea.innerHTML = `
                <div class="dqn-final-results">
                    <div class="final-outcome ${outcomeClass}">
                        <h2>${outcomeTitle}</h2>
                        <p>${outcomeDescription}</p>
                    </div>
                    
                    <div class="scenario-summary">
                        <h3>📊 Final Scenario State</h3>
                        ${generateStateDisplay(window.scenarioState)}
                    </div>
                    
                    <div class="tactical-analysis">
                        <h3>🎯 Tactical Performance Analysis</h3>
                        <div class="performance-metrics">
                            <div class="metric">
                                <span class="metric-label">Correct Decisions:</span>
                                <span class="metric-value">${score}/${currentQuestionIndex + 1}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Fire Progression:</span>
                                <span class="metric-value">${window.scenarioState.fireSize} → ${window.scenarioState.fireLocation}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Response Time:</span>
                                <span class="metric-value">${window.scenarioState.timeElapsed} minutes</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lessons-learned">
                        <h3>📚 Key Lessons</h3>
                        <ul>
                            <li><strong>Dynamic Scenarios:</strong> Fire behavior changed based on your decisions, not pre-scripted outcomes</li>
                            <li><strong>Consequence Realism:</strong> Poor suppression choices realistically escalated fire size and spread</li>
                            <li><strong>Tactical Thinking:</strong> Each decision influenced subsequent scenario complexity</li>
                        </ul>
                    </div>
                    
                    <div class="results-controls">
                        <button onclick="startAssessment()" class="assessment-btn secondary">Try Different Scenario</button>
                        <button onclick="returnToMenu()" class="assessment-btn primary">Return to Menu</button>
                    </div>
                </div>
            `;
        }

        // Get pier fire specific questions
        function getPierFireQuestions() {
            const pierFireQuestions = [
                {
                    id: 1,
                    scenario: "FUEL LINE RUPTURE AT PIER",
                    situation: "While refueling at pier, a high-pressure fuel line ruptures and ignites near the hot exhaust manifold. Fuel spray is creating a growing fire with immediate explosion risk.",
                    question: "What is your FIRST priority action?",
                    options: [
                        "Immediately activate the general alarm and begin crew evacuation",
                        "Attempt to stop the fuel flow at the source valve",
                        "Deploy foam suppression directly on the fire",
                        "Call harbor fire department and wait for professional response"
                    ],
                    correct: 1,
                    explanation: "Stopping fuel flow is critical - you can't effectively suppress a fuel fire while the source continues feeding it. The source valve should be your immediate priority, followed by suppression.",
                    timeLimit: 30,
                    difficulty: "critical"
                },
                {
                    id: 2,
                    scenario: "SHORE POWER CONNECTION FIRE",
                    situation: "Electrical fire in main switchboard spreads to cable runs while connected to shore power. The fire is growing and threatening to spread below decks. Shore power cannot be immediately disconnected from shore side.",
                    question: "Your primary tactical decision should be:",
                    options: [
                        "Use water spray to cool adjacent cable runs",
                        "Disconnect ship's main breakers and use CO2 suppression",
                        "Evacuate the area and fight fire from outside the space",
                        "Use foam to blanket the electrical equipment"
                    ],
                    correct: 1,
                    explanation: "Electrical fires require CO2 suppression, not water. Disconnecting main breakers isolates the electrical source, then CO2 can safely suppress without water conductivity issues.",
                    timeLimit: 45,
                    difficulty: "hard"
                },
                {
                    id: 3,
                    scenario: "ENGINE ROOM LUBE OIL FIRE",
                    situation: "Engine room lube oil system fire while moored at pier. Smoke is filling the space and threatening crew evacuation routes. Harbor fire department has 15-minute response time.",
                    question: "What suppression method is most appropriate for this scenario?",
                    options: [
                        "Water spray with AFFF additive",
                        "CO2 flooding system activation", 
                        "Portable foam extinguishers",
                        "Dry chemical suppression"
                    ],
                    correct: 1,
                    explanation: "Lube oil fires in confined spaces like engine rooms require CO2 flooding for effective suppression. Other methods won't handle the three-dimensional burning in an enclosed space.",
                    timeLimit: 60,
                    difficulty: "medium"
                },
                {
                    id: 4,
                    scenario: "PIER SIDE GALLEY FIRE",
                    situation: "Deep fryer fire in galley has spread to ventilation ducting. The fire is Class K (cooking oil) and smoke is entering adjacent berthing areas. Crew members are potentially trapped.",
                    question: "What is the correct suppression approach?",
                    options: [
                        "Activate sprinkler system to control spread",
                        "Use Class K wet chemical suppression on fryer, then address ducting",
                        "Use CO2 to displace oxygen in galley space",
                        "Use water to cool burning oil"
                    ],
                    correct: 1,
                    explanation: "Class K fires require wet chemical suppression specifically designed for cooking oils. Water will cause dangerous spattering and spread the fire.",
                    timeLimit: 45,
                    difficulty: "medium"
                },
                {
                    id: 5,
                    scenario: "MULTIPLE COMPARTMENT FIRE PROGRESSION",
                    situation: "Fire started in machinery space has spread to adjacent compartments. You have limited crew and harbor fire department is en route. Fire is threatening structural integrity.",
                    question: "Your strategic priority should be:",
                    options: [
                        "Divide crew to fight fires in all compartments simultaneously",
                        "Focus all resources on preventing fire spread to critical areas",
                        "Evacuate vessel and let harbor fire department handle",
                        "Attempt to save the machinery space where fire originated"
                    ],
                    correct: 1,
                    explanation: "With limited resources, preventing spread to critical areas (bridge, damage control central, escape routes) is more important than trying to save what's already burning.",
                    timeLimit: 60,
                    difficulty: "hard"
                }
            ];
            
            return shuffleArray(pierFireQuestions);
        }

        // Show current assessment question
        function showQuestion() {
            if (currentQuestionIndex >= assessmentQuestions.length) {
                showAssessmentResults();
                return;
            }

            const question = assessmentQuestions[currentQuestionIndex];
            const quizArea = document.getElementById('assessment-quiz-area');
            
            quizArea.innerHTML = `
                <div class="assessment-question-container">
                    <div class="question-header">
                        <div class="question-progress">
                            <span class="question-number">Question ${currentQuestionIndex + 1} of ${assessmentQuestions.length}</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${((currentQuestionIndex) / assessmentQuestions.length) * 100}%"></div>
                            </div>
                        </div>
                        <div class="scenario-badge">${question.scenario}</div>
                    </div>
                    
                    <div class="question-content">
                        <div class="situation-brief">
                            <h4>🚨 SITUATION:</h4>
                            <p>${question.situation}</p>
                        </div>
                        
                        <div class="question-prompt">
                            <h3>${question.question}</h3>
                        </div>
                        
                        <div class="answer-options">
                            ${question.options.map((option, index) => `
                                <button class="answer-option" onclick="selectAnswer(${index})">
                                    <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                                    <span class="option-text">${option}</span>
                                </button>
                            `).join('')}
                        </div>
                        
                        <div class="question-controls">
                            <button id="submit-answer" onclick="submitAnswer()" class="assessment-btn primary" disabled>
                                Submit Answer
                            </button>
                            ${currentQuestionIndex > 0 ? '<button onclick="previousQuestion()" class="assessment-btn secondary">Previous</button>' : ''}
                        </div>
                        
                        ${question.timeLimit ? `
                            <div class="time-pressure">
                                <span class="time-icon">⏱️</span>
                                <span>Real scenario time pressure: ${question.timeLimit} seconds</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Select an answer option
        window.selectAnswer = function(optionIndex) {
            console.log('selectAnswer called with index:', optionIndex);
            selectedAnswer = optionIndex;
            
            // Remove previous selection styling
            const allOptions = document.querySelectorAll('.answer-option');
            console.log('Found answer options:', allOptions.length);
            allOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selection styling to clicked option
            if (allOptions[optionIndex]) {
                allOptions[optionIndex].classList.add('selected');
                console.log('Added selected class to option', optionIndex);
            } else {
                console.error('Could not find option at index', optionIndex);
            }
            
            // Enable submit button
            const submitBtn = document.getElementById('submit-answer');
            if (submitBtn) {
                submitBtn.disabled = false;
                console.log('Enabled submit button');
            } else {
                console.error('Could not find submit button');
            }
        }

        // Submit the current answer
        window.submitAnswer = function() {
            console.log('submitAnswer called, selectedAnswer:', selectedAnswer);
            if (selectedAnswer === null) return;
            
            const question = assessmentQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) {
                score++;
            }
            
            // Show immediate feedback
            showAnswerFeedback(question, isCorrect);
        }

        // Show feedback for the submitted answer
        function showAnswerFeedback(question, isCorrect) {
            const quizArea = document.getElementById('assessment-quiz-area');
            
            quizArea.innerHTML = `
                <div class="answer-feedback-container">
                    <div class="feedback-header">
                        <div class="feedback-result ${isCorrect ? 'correct' : 'incorrect'}">
                            <span class="feedback-icon">${isCorrect ? '✅' : '❌'}</span>
                            <span class="feedback-text">${isCorrect ? 'CORRECT' : 'INCORRECT'}</span>
                        </div>
                        <div class="scenario-badge">${question.scenario}</div>
                    </div>
                    
                    <div class="feedback-content">
                        <div class="correct-answer">
                            <h4>✅ Correct Answer:</h4>
                            <p><strong>${String.fromCharCode(65 + question.correct)}:</strong> ${question.options[question.correct]}</p>
                        </div>
                        
                        <div class="explanation">
                            <h4>📋 Explanation:</h4>
                            <p>${question.explanation}</p>
                        </div>
                        
                        ${!isCorrect ? `
                            <div class="your-answer">
                                <h4>❌ Your Answer:</h4>
                                <p><strong>${String.fromCharCode(65 + selectedAnswer)}:</strong> ${question.options[selectedAnswer]}</p>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="feedback-controls">
                        <button onclick="nextQuestion()" class="assessment-btn primary">
                            ${currentQuestionIndex < assessmentQuestions.length - 1 ? 'Next Question' : 'View Results'}
                        </button>
                    </div>
                </div>
            `;
        }

        // Move to next question
        window.nextQuestion = function() {
            console.log('nextQuestion called');
            currentQuestionIndex++;
            selectedAnswer = null;
            showQuestion();
        }

        // Show final assessment results
        function showAssessmentResults() {
            const percentage = Math.round((score / assessmentQuestions.length) * 100);
            const quizArea = document.getElementById('assessment-quiz-area');
            
            let performanceLevel = '';
            let performanceColor = '';
            let recommendations = '';
            
            if (percentage >= 90) {
                performanceLevel = 'EXPERT LEVEL';
                performanceColor = 'expert';
                recommendations = 'Outstanding performance! You demonstrate expert-level understanding of pier fire response. Consider advanced scenarios or instructor roles.';
            } else if (percentage >= 75) {
                performanceLevel = 'PROFICIENT';
                performanceColor = 'proficient';
                recommendations = 'Strong performance! You have solid foundational knowledge. Focus on advanced tactical decision-making scenarios.';
            } else if (percentage >= 60) {
                performanceLevel = 'DEVELOPING';
                performanceColor = 'developing';
                recommendations = 'Good foundation with room for improvement. Review fire classification, suppression methods, and tactical priorities.';
            } else {
                performanceLevel = 'NEEDS IMPROVEMENT';
                performanceColor = 'needs-work';
                recommendations = 'Significant gaps identified. Recommend additional training on fire fundamentals, suppression agents, and emergency procedures.';
            }
            
            quizArea.innerHTML = `
                <div class="assessment-results-container">
                    <div class="results-header">
                        <h2>🎯 DCA Assessment Complete</h2>
                        <div class="score-display">
                            <div class="score-circle">
                                <span class="score-percentage">${percentage}%</span>
                                <span class="score-fraction">${score}/${assessmentQuestions.length}</span>
                            </div>
                            <div class="performance-level ${performanceColor}">${performanceLevel}</div>
                        </div>
                    </div>
                    
                    <div class="results-content">
                        <div class="performance-analysis">
                            <h3>📊 Performance Analysis</h3>
                            <p>${recommendations}</p>
                        </div>
                        
                        <div class="detailed-breakdown">
                            <h3>🔍 Question Breakdown</h3>
                            <div class="question-results">
                                ${assessmentQuestions.map((q, index) => `
                                    <div class="question-result">
                                        <span class="question-title">${q.scenario}</span>
                                        <span class="result-indicator ${index < score ? 'correct' : 'incorrect'}">
                                            ${index < score ? '✅' : '❌'}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="next-steps">
                            <h3>🎯 Recommended Next Steps</h3>
                            <div class="recommendations-list">
                                ${percentage >= 75 ? `
                                    <div class="recommendation">
                                        <strong>Advanced Scenarios:</strong> Try the DQN adaptive training for expert-level challenges
                                    </div>
                                    <div class="recommendation">
                                        <strong>Instructor Development:</strong> Consider training others in fire response fundamentals
                                    </div>
                                ` : `
                                    <div class="recommendation">
                                        <strong>Review Materials:</strong> Study fire classification and suppression agent selection
                                    </div>
                                    <div class="recommendation">
                                        <strong>Practice Scenarios:</strong> Retake assessment after additional study
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-controls">
                        <button onclick="retakeAssessment()" class="assessment-btn secondary">Retake Assessment</button>
                        <button onclick="returnToMenu()" class="assessment-btn primary">Return to Menu</button>
                    </div>
                </div>
            `;
        }

        // Retake the assessment
        window.retakeAssessment = function() {
            startAssessment();
        }

        // AI-powered scenario generation
        function generateDynamicScenario() {
            const userPerformance = calculateUserPerformance();
            
            // Show loading interface
            showAIGenerationInterface();
            
            // Simulate AI processing time with animation
            setTimeout(() => {
                try {
                    // Generate scenario using DQN insights
                    const scenario = generateScenarioWithAI(userPerformance);
                    
                    // Display the generated scenario
                    displayAIGeneratedScenario(scenario);
                    
                } catch (error) {
                    console.error('AI scenario generation failed:', error);
                    // Fallback to enhanced static scenario
                    displayFallbackScenario();
                }
            }, 3000); // 3 second delay for AI animation
        }

        // Calculate user performance metrics for AI adaptation
        function calculateUserPerformance() {
            const sessionData = getSessionData();
            
            return {
                accuracy: sessionData.correctAnswers / Math.max(sessionData.totalAnswers, 1),
                averageResponseTime: sessionData.averageResponseTime || 30,
                strengthAreas: sessionData.strongCategories || ['initial_response'],
                weaknessAreas: sessionData.weakCategories || ['fire_suppression'],
                difficultyLevel: sessionData.currentDifficulty || 'intermediate',
                scenariosCompleted: sessionData.scenariosCompleted || 0
            };
        }

        // Get or initialize session data
        function getSessionData() {
            const defaultData = {
                correctAnswers: 0,
                totalAnswers: 0,
                averageResponseTime: 30,
                strongCategories: [],
                weakCategories: [],
                currentDifficulty: 'intermediate',
                scenariosCompleted: 0,
                sessionStartTime: Date.now()
            };
            
            const stored = localStorage.getItem('dcaAssessmentSession');
            return stored ? {...defaultData, ...JSON.parse(stored)} : defaultData;
        }

        // Generate scenario using AI/DQN model simulation
        function generateScenarioWithAI(performance) {
            // DQN-based scenario selection
            const scenarioTypes = [
                'engine_room_cascade', 'electrical_fire_bridge', 'galley_grease_fire',
                'machinery_space_fuel', 'berthing_area_smoke', 'damage_control_flooding'
            ];
            
            // AI selects scenario type based on user weaknesses
            const scenarioType = selectScenarioType(scenarioTypes, performance);
            
            // Generate dynamic scenario parameters
            const scenario = {
                id: `ai_${Date.now()}`,
                type: scenarioType,
                difficulty: adaptDifficulty(performance),
                title: generateScenarioTitle(scenarioType),
                context: generateScenarioContext(scenarioType, performance),
                challenges: generateDQNQuestions(scenarioType, performance.difficultyLevel, 5), // Generate 5 questions
                aiInsights: generateAIInsights(scenarioType, performance),
                timestamp: Date.now()
            };
            
            return scenario;
        }

        // AI scenario type selection based on performance
        function selectScenarioType(types, performance) {
            // Weight selection toward user's weak areas
            if (performance.weaknessAreas.includes('fire_suppression')) {
                return Math.random() < 0.7 ? 'engine_room_cascade' : 
                       Math.random() < 0.5 ? 'galley_grease_fire' : 'machinery_space_fuel';
            }
            
            if (performance.weaknessAreas.includes('electrical_systems')) {
                return 'electrical_fire_bridge';
            }
            
            if (performance.weaknessAreas.includes('evacuation_procedures')) {
                return 'berthing_area_smoke';
            }
            
            // Random selection for balanced users
            return types[Math.floor(Math.random() * types.length)];
        }

        // Adaptive difficulty based on performance
        function adaptDifficulty(performance) {
            if (performance.accuracy > 0.85 && performance.scenariosCompleted > 3) {
                return 'expert';
            } else if (performance.accuracy > 0.65 || performance.scenariosCompleted > 1) {
                return 'intermediate';
            } else {
                return 'novice';
            }
        }

        // Generate dynamic scenario title
        function generateScenarioTitle(type) {
            const titles = {
                'engine_room_cascade': [
                    'Main Engine Lube Oil Fire with Secondary Failures',
                    'Engine Room Multi-System Fire Emergency',
                    'Cascade Failure: Fuel to Electrical Fire'
                ],
                'electrical_fire_bridge': [
                    'Bridge Electronics Fire During Navigation',
                    'Main Switchboard Fire with Power Loss',
                    'Communications Fire During Emergency'
                ],
                'galley_grease_fire': [
                    'Deep Fryer Fire with Ventilation Spread',
                    'Galley Grease Fire During Meal Service',
                    'Kitchen Fire with Class K Suppression Challenge'
                ],
                'machinery_space_fuel': [
                    'Fuel Line Rupture Fire in Engine Room',
                    'Diesel Generator Fire with Fuel Feed',
                    'Machinery Space Class B Fire Emergency'
                ],
                'berthing_area_smoke': [
                    'Smoke Investigation in Forward Berthing',
                    'Electrical Fire in Crew Quarters',
                    'Berthing Area Fire with Personnel Accountability'
                ],
                'damage_control_flooding': [
                    'Fire Fighting with Concurrent Flooding',
                    'Damage Control Fire with Water Ingress',
                    'Combined Fire and Flooding Emergency'
                ]
            };
            
            const typeTitle = titles[type] || ['Dynamic Fire Scenario'];
            return typeTitle[Math.floor(Math.random() * typeTitle.length)];
        }

        // Generate dynamic scenario context
        function generateScenarioContext(type, performance) {
            const baseContexts = {
                'engine_room_cascade': [
                    "0145 hours - Engineering watch reports smoke detector activation in main engine room. Initial investigation reveals active fire in the main engine lube oil system near the starboard main engine. Fire has spread to electrical cable runs overhead.",
                    "1320 hours - During routine maintenance, a fuel line fails catastrophically, spraying diesel fuel onto hot exhaust manifold. Fire spreads rapidly through cable trays toward main switchboard.",
                    "2200 hours - Main engine alarm sounds during night watch. Lube oil pressure loss coincides with smoke detection. Investigation reveals Class B fire with electrical involvement threatening propulsion systems."
                ],
                'electrical_fire_bridge': [
                    "0300 hours - Bridge watch reports sparking from navigation console followed by acrid smoke. Weather radar and GPS systems failing sequentially. Ship operating in restricted visibility with heavy traffic.",
                    "1415 hours - During port approach, main switchboard experiences catastrophic failure. All bridge electronics lose power. Emergency navigation equipment activated as ship enters congested waterway.",
                    "0530 hours - Radio operator reports electrical fire in communications space. Emergency frequencies compromised. Coast Guard has issued navigation warnings for area."
                ],
                'galley_grease_fire': [
                    "1145 hours - Galley deep fryer overheats during lunch preparation. Cook attempts water suppression causing explosive grease spread. Fire extends into ventilation system threatening adjacent spaces.",
                    "0615 hours - Breakfast prep interrupted by grease fire. Automatic suppression system fails to activate. Heavy smoke spreading through crew mess and berthing areas.",
                    "1800 hours - Dinner service galley fire spreads through grease-laden ductwork. Multiple spaces reporting smoke. Crew evacuation from affected berthing areas required."
                ]
            };
            
            const contexts = baseContexts[type] || ["Dynamic fire scenario in progress..."];
            let context = contexts[Math.floor(Math.random() * contexts.length)];
            
            // Add complexity based on difficulty
            if (performance.difficultyLevel === 'expert') {
                context += " Additional complications: Rough seas (3-4 foot swells), reduced crew availability (port duty section), concurrent machinery casualty.";
            } else if (performance.difficultyLevel === 'intermediate') {
                context += " Current conditions: Normal sea state, full crew complement available, daylight operations.";
            } else {
                context += " Training scenario: Calm conditions, full support available, daylight with good visibility.";
            }
            
            return context;
        }

        // Generate DQN-based questions (5 questions per scenario)
        function generateDQNQuestions(scenarioType, difficultyLevel, questionCount = 5) {
            const questionBank = getDQNQuestionBank();
            const scenarioQuestions = questionBank[scenarioType] || questionBank['general'];
            
            // Select questions based on difficulty
            let selectedQuestions = [];
            
            // Easy: Basic procedures and identification
            const easyQuestions = scenarioQuestions.filter(q => q.difficulty === 'easy');
            // Medium: Tactical decisions and prioritization  
            const mediumQuestions = scenarioQuestions.filter(q => q.difficulty === 'medium');
            // Hard: Complex scenarios with multiple variables
            const hardQuestions = scenarioQuestions.filter(q => q.difficulty === 'hard');
            
            // Mix questions based on user's difficulty level
            if (difficultyLevel === 'novice') {
                // 60% easy, 30% medium, 10% hard
                selectedQuestions = [
                    ...shuffleArray(easyQuestions).slice(0, 3),
                    ...shuffleArray(mediumQuestions).slice(0, 2)
                ];
            } else if (difficultyLevel === 'intermediate') {
                // 20% easy, 60% medium, 20% hard
                selectedQuestions = [
                    ...shuffleArray(easyQuestions).slice(0, 1),
                    ...shuffleArray(mediumQuestions).slice(0, 3),
                    ...shuffleArray(hardQuestions).slice(0, 1)
                ];
            } else { // expert
                // 10% easy, 30% medium, 60% hard
                selectedQuestions = [
                    ...shuffleArray(mediumQuestions).slice(0, 2),
                    ...shuffleArray(hardQuestions).slice(0, 3)
                ];
            }
            
            // Ensure we have exactly the requested number of questions
            selectedQuestions = shuffleArray(selectedQuestions).slice(0, questionCount);
            
            // Add time limits and additional factors based on difficulty
            return selectedQuestions.map((question, index) => ({
                ...question,
                phase: `phase_${index + 1}`,
                timeLimit: getTimeLimit(difficultyLevel, question.difficulty),
                additionalFactors: getAdditionalFactors(difficultyLevel)
            }));
        }

        // Get comprehensive DQN question bank
        function getDQNQuestionBank() {
            return {
                'engine_room_cascade': [
                    // EASY Questions
                    {
                        difficulty: 'easy',
                        question: "Smoke alarm activates in engine room. What is your first action as DCA?",
                        options: [
                            "Sound General Quarters immediately",
                            "Send investigation team to verify",
                            "Activate fixed fire suppression",
                            "Call Coast Guard for assistance"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Analysis: General Quarters must be sounded immediately upon any fire indication. This ensures maximum crew response and establishes command structure. USS Bonhomme Richard investigation showed that delayed GQ contributed to fire spread."
                    },
                    {
                        difficulty: 'easy',
                        question: "Investigation confirms Class B fire (flammable liquid) in engine room. Which suppression agent is appropriate?",
                        options: [
                            "Water spray to cool the fire",
                            "AFFF foam to smother flames", 
                            "CO2 to displace oxygen",
                            "PKP dry chemical powder"
                        ],
                        correct: 1,
                        aiExplanation: "DQN Analysis: AFFF (Aqueous Film Forming Foam) creates a vapor-suppressing film over flammable liquids. This is the primary suppression method for Class B fires on naval vessels. Water would spread the fire, CO2 requires personnel evacuation."
                    },
                    {
                        difficulty: 'easy',
                        question: "Fire boundaries are being established. What is the primary purpose?",
                        options: [
                            "Prevent fire spread to adjacent spaces",
                            "Create escape routes for personnel",
                            "Provide water supply for firefighting",
                            "Allow smoke ventilation"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Analysis: Fire boundaries prevent horizontal and vertical fire spread through compartmentalization. This fundamental damage control principle has prevented total ship loss in 89% of documented shipboard fires when properly executed."
                    },
                    // MEDIUM Questions  
                    {
                        difficulty: 'medium',
                        question: "Engine room fire spreads to electrical cables. Fire team requests permission to use water fog. As DCA, your decision?",
                        options: [
                            "Approve - water fog is safe on energized electrical",
                            "Deny - secure electrical power first, then use foam",
                            "Approve - but only after CO2 pre-discharge warning",
                            "Deny - use PKP dry chemical on electrical fires only"
                        ],
                        correct: 1,
                        aiExplanation: "DQN Tactical Analysis: Electrical fires require power isolation before water application. Mixed Class B/C fires need sequential suppression: secure power  foam for liquid  water for cooling. This prevents electrical hazards and re-ignition."
                    },
                    {
                        difficulty: 'medium',
                        question: "Main engine secured due to fire. Ship is in restricted waters with commercial traffic. Priority concerns?",
                        options: [
                            "Request tug assistance while continuing firefighting",
                            "Drop anchor immediately, focus solely on fire suppression",
                            "Continue on auxiliary power, firefighting is secondary",
                            "Abandon ship preparation while fighting fire"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Strategic Analysis: Simultaneous navigation safety and fire suppression required. Requesting tug assistance maintains sea room while allowing full firefighting effort. Historical analysis shows 34% of shipboard fires result in collision when navigation is ignored."
                    },
                    // HARD Questions
                    {
                        difficulty: 'hard',
                        question: "Engine room fire, electrical involvement, flooding from ruptured fire main, and injured personnel in space. Prioritize actions:",
                        options: [
                            "Personnel evacuation  flooding control  fire suppression  electrical isolation",
                            "Electrical isolation  personnel evacuation  fire suppression  flooding control", 
                            "Fire suppression  personnel evacuation  electrical isolation  flooding control",
                            "Personnel evacuation  electrical isolation  flooding control  fire suppression"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Crisis Management: Life safety supersedes all other considerations. Personnel evacuation enables aggressive fire suppression. Flooding control prevents stability loss. Electrical isolation after personnel safety ensures no electrocution during rescue. This sequence aligns with Navy damage control priority matrix."
                    },
                    {
                        difficulty: 'hard',
                        question: "Fixed CO2 system failed, portable equipment insufficient, fire spreading. Engineering requests emergency scuttling of space. As DCA?",
                        options: [
                            "Approve immediately - save the ship",
                            "Deny - continue conventional firefighting",
                            "Approve only after Captain's permission",
                            "Delay decision pending backup systems check"
                        ],
                        correct: 2,
                        aiExplanation: "DQN Command Analysis: Emergency space scuttling requires command authority due to ship stability implications. DCA recommends, Captain decides. USS Miami (SSN-755) fire showed that command decision-making under extreme stress requires clear authority lines. This preserves command structure during crisis."
                    }
                ],
                'electrical_fire_bridge': [
                    // EASY
                    {
                        difficulty: 'easy',
                        question: "Bridge electronics fire detected. First priority as DCA?",
                        options: [
                            "Secure main electrical power",
                            "Sound General Quarters", 
                            "Activate emergency steering",
                            "Switch to emergency navigation"
                        ],
                        correct: 1,
                        aiExplanation: "DQN Analysis: General Quarters provides maximum crew response for any shipboard emergency. Bridge fires threaten navigation safety, requiring immediate all-hands response to prevent collision or grounding."
                    },
                    // MEDIUM
                    {
                        difficulty: 'medium',
                        question: "Bridge electrical fire during port approach in heavy traffic. Navigation systems failing. Balance firefighting with ship safety:",
                        options: [
                            "Anchor immediately, focus on firefighting",
                            "Continue approach using emergency navigation while fighting fire",
                            "Request port delay, establish sea room for firefighting", 
                            "Beach the ship to prevent collision"
                        ],
                        correct: 2,
                        aiExplanation: "DQN Navigation Analysis: Sea room provides time for both firefighting and navigation safety. Port approach in traffic with compromised navigation creates collision risk. Emergency protocols require establishing safe operating area before internal crisis management."
                    },
                    // HARD
                    {
                        difficulty: 'hard',
                        question: "Bridge fire, total power loss, emergency diesel generator offline, ship drifting toward collision with merchant vessel. Command action?",
                        options: [
                            "Full focus on fire suppression, collision is secondary",
                            "Abandon firefighting, use emergency steering to avoid collision",
                            "Split crew: minimal fire suppression, maximum collision avoidance",
                            "Emergency anchor deployment while continuing firefighting"
                        ],
                        correct: 3,
                        aiExplanation: "DQN Emergency Analysis: Emergency anchor provides immediate drift control while preserving crew for firefighting. Historical analysis: 67% of ships survive bridge fires, only 23% survive major collisions. Anchor deployment buys time for both crisis resolution."
                    }
                ],
                'general': [
                    {
                        difficulty: 'easy',
                        question: "General alarm sounds for fire. As DCA, your immediate actions?",
                        options: [
                            "Proceed to DC Central, establish command",
                            "Go to fire location to assess situation",
                            "Ensure all crew report to stations",
                            "Contact Coast Guard immediately"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Command Analysis: DCA must establish command and control from DC Central to coordinate ship-wide response. Direct involvement in firefighting compromises overall damage control leadership."
                    }
                ]
            };
        }

        // Get time limit based on difficulty levels
        function getTimeLimit(userLevel, questionDifficulty) {
            const timeLimits = {
                'novice': { 'easy': 120, 'medium': 150, 'hard': 180 },
                'intermediate': { 'easy': 90, 'medium': 120, 'hard': 150 },
                'expert': { 'easy': 60, 'medium': 90, 'hard': 120 }
            };
            
            return timeLimits[userLevel][questionDifficulty] || 120;
        }

        // Get additional factors based on difficulty
        function getAdditionalFactors(difficultyLevel) {
            const factors = {
                'novice': "Training environment: calm seas, full crew complement, daylight operations",
                'intermediate': "Standard operations: moderate seas, normal crew availability, variable conditions", 
                'expert': "High stress environment: rough seas, reduced crew, night operations, multiple casualties"
            };
            
            return factors[difficultyLevel] || factors['intermediate'];
        }

        // Generate AI insights
        function generateAIInsights(type, performance) {
            return {
                dqnRecommendation: `Based on ${performance.scenariosCompleted + 1} scenarios analyzed, DQN model recommends focusing on ${getRecommendedFocus(type, performance)}.`,
                performancePredict: `AI predicts ${Math.round(performance.accuracy * 100 + Math.random() * 10)}% success probability for this scenario based on your response patterns.`,
                historicalContext: `Similar incidents: USS Bonhomme Richard (2020), USS Miami (2012) - Key lesson: ${getHistoricalLesson(type)}`,
                adaptiveNote: `Scenario complexity adapted to ${performance.difficultyLevel} level based on your performance metrics.`
            };
        }

        // Get recommended focus area
        function getRecommendedFocus(type, performance) {
            const focusAreas = {
                'engine_room_cascade': 'fuel source isolation and electrical fire suppression coordination',
                'electrical_fire_bridge': 'emergency navigation procedures and power management',
                'galley_grease_fire': 'Class K fire suppression and ventilation control'
            };
            
            return focusAreas[type] || 'multi-phase fire response coordination';
        }

        // Get historical lesson
        function getHistoricalLesson(type) {
            const lessons = {
                'engine_room_cascade': 'Delayed fuel isolation allows fire to spread beyond suppression capability',
                'electrical_fire_bridge': 'Emergency power priority must be navigation and communications',
                'galley_grease_fire': 'Water on grease fires causes explosive spread - use proper Class K agents'
            };
            
            return lessons[type] || 'Early detection and rapid response save ships and lives';
        }

        // Show AI generation interface
        function showAIGenerationInterface() {
            const content = document.getElementById('assessmentContent');
            content.innerHTML = `
                <div class="ai-generation-interface">
                    <div class="ai-header">
                        <h2> DQN AI Assessment Generator</h2>
                        <p>Our AI is analyzing your performance and generating a personalized fire scenario...</p>
                    </div>
                    
                    <div class="ai-generation-process">
                        <div class="generation-step active">
                            <div class="step-icon"> </div>
                            <div class="step-text">Analyzing performance patterns</div>
                            <div class="step-progress"></div>
                        </div>
                        <div class="generation-step">
                            <div class="step-icon">
                            <div class="step-text">Generating scenario parameters</div>
                            <div class="step-progress"></div>
                        </div>
                        <div class="generation-step">
                            <div class="step-icon">
                            <div class="step-text">Adapting difficulty level</div>
                            <div class="step-progress"></div>
                        </div>
                        <div class="generation-step">
                            <div class="step-icon">
                            <div class="step-text">Finalizing challenge structure</div>
                            <div class="step-progress"></div>
                        </div>
                    </div>
                    
                    <div class="ai-insights-preview">
                        <h3> AI Analysis Preview</h3>
                        <div class="insight-grid">
                            <div class="insight-item">
                                <strong>Performance Level:</strong> <span id="aiPerformanceLevel">Calculating...</span>
                            </div>
                            <div class="insight-item">
                                <strong>Recommended Focus:</strong> <span id="aiRecommendedFocus">Analyzing...</span>
                            </div>
                            <div class="insight-item">
                                <strong>Scenario Type:</strong> <span id="aiScenarioType">Selecting...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Animate generation process
            animateGenerationProcess();
        }

        // Animate the AI generation process
        function animateGenerationProcess() {
            const steps = document.querySelectorAll('.generation-step');
            let currentStep = 0;
            
            function activateStep(index) {
                if (index < steps.length) {
                    steps[index].classList.add('active');
                    steps[index].classList.add('processing');
                    
                    setTimeout(() => {
                        steps[index].classList.remove('processing');
                        steps[index].classList.add('completed');
                        
                        // Update insights
                        updateInsightsPreview(index);
                        
                        setTimeout(() => {
                            activateStep(index + 1);
                        }, 500);
                    }, 1000 + Math.random() * 1000);
                }
            }
            
            activateStep(0);
        }

        // Update insights preview during generation
        function updateInsightsPreview(stepIndex) {
            const performance = calculateUserPerformance();
            
            switch(stepIndex) {
                case 0:
                    document.getElementById('aiPerformanceLevel').textContent = 
                        `${Math.round(performance.accuracy * 100)}% accuracy - ${performance.difficultyLevel} level`;
                    break;
                case 1:
                    document.getElementById('aiRecommendedFocus').textContent = 
                        performance.weaknessAreas.length > 0 ? 
                        performance.weaknessAreas[0].replace('_', ' ') : 'Balanced training';
                    break;
                case 2:
                    document.getElementById('aiScenarioType').textContent = 
                        'Multi-phase fire emergency with adaptive challenges';
                    break;
            }
        }

        // Display AI-generated scenario
        function displayAIGeneratedScenario(scenario) {
            const content = document.getElementById('assessmentContent');
            content.innerHTML = `
                <div class="dca-assessment-interface">
                    <div class="assessment-header">
                        <h2> DCA Assessment: ${scenario.title}</h2>
                        <div class="assessment-meta">
                            <span class="difficulty-badge ${scenario.difficulty}">${scenario.difficulty.toUpperCase()}</span>
                            <span class="progress-indicator">Question 1 of ${scenario.challenges.length}</span>
                        </div>
                    </div>
                    
                    <div class="situation-report">
                        <h3> Situation Report</h3>
                        <div class="sitrep-content">${scenario.context}</div>
                    </div>
                    
                    <div class="assessment-question" id="currentQuestion">
                        ${generateSimpleQuestionHTML(scenario.challenges[0], 0)}
                    </div>
                    
                    <div class="score-panel" id="scorePanel">
                        <div class="current-score">
                            <span class="score-label">Score:</span>
                            <span class="score-value" id="currentScore">0</span>
                            <span class="score-total">/ ${scenario.challenges.length}</span>
                        </div>
                    </div>
                    
                    <div class="feedback-panel" id="feedbackPanel" style="display: none;">
                        <!-- Feedback will appear here after responses -->
                    </div>
                </div>
            `;
            
            // Store current scenario and initialize scoring
            window.currentAIScenario = scenario;
            window.currentQuestionIndex = 0;
            window.currentScore = 0;
            
            // Update score display
            updateScoreDisplay();
        }

        // Generate simple question HTML
        function generateSimpleQuestionHTML(question, questionIndex) {
            return `
                <div class="question-container">
                    <div class="question-header">
                        <h3>Question ${questionIndex + 1}</h3>
                        ${question.timeLimit ? `<div class="time-limit"> ${question.timeLimit}s</div>` : ''}
                    </div>
                    
                    <div class="question-text">
                        <p>${question.question}</p>
                    </div>
                    
                    <div class="answer-options">
                        ${question.options.map((option, optIndex) => `
                            <button class="answer-btn" onclick="selectAnswer(${optIndex})" data-option="${optIndex}">
                                <span class="option-letter">${String.fromCharCode(65 + optIndex)}</span>
                                <span class="option-text">${option}</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="question-actions">
                        <button class="submit-answer-btn" onclick="submitAnswer()" disabled>Submit Answer</button>
                    </div>
                </div>
            `;
        }

        // Update score display
        function updateScoreDisplay() {
            const scoreElement = document.getElementById('currentScore');
            if (scoreElement) {
                scoreElement.textContent = window.currentScore || 0;
            }
            
            const progressElement = document.querySelector('.progress-indicator');
            if (progressElement && window.currentAIScenario) {
                const current = (window.currentQuestionIndex || 0) + 1;
                const total = window.currentAIScenario.challenges.length;
                progressElement.textContent = `Question ${current} of ${total}`;
            }
        }

        // Generate challenge HTML
        function generateChallengeHTML(challenge, index) {
            return `
                <div class="challenge-card">
                    <div class="challenge-header">
                        <h4>Phase ${index + 1}: ${challenge.phase.replace('_', ' ').toUpperCase()}</h4>
                        ${challenge.timeLimit ? `<div class="time-limit"> ${challenge.timeLimit}s</div>` : ''}
                    </div>
                    
                    <div class="challenge-question">
                        <p>${challenge.question}</p>
                        ${challenge.additionalFactors ? `<div class="additional-factors"><strong>Additional Factors:</strong> ${challenge.additionalFactors}</div>` : ''}
                    </div>
                    
                    <div class="challenge-options">
                        ${challenge.options.map((option, optIndex) => `
                            <button class="option-btn" onclick="selectAIOption(${optIndex})" data-option="${optIndex}">
                                <span class="option-letter">${String.fromCharCode(65 + optIndex)}</span>
                                <span class="option-text">${option}</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="challenge-actions">
                        <button class="submit-btn" onclick="submitAIResponse()" disabled>Submit Response</button>
                        <button class="hint-btn" onclick="requestAIHint()"> Request AI Hint</button>
                    </div>
                </div>
            `;
        }

        // Display fallback scenario if AI generation fails
        function displayFallbackScenario() {
            const content = document.getElementById('assessmentContent');
            content.innerHTML = `
                <div class="fallback-scenario">
                    <div class="error-notice">
                        <h3>  AI Generation Unavailable</h3>
                        <p>Falling back to enhanced static scenario with military-style feedback.</p>
                    </div>
                    <!-- Enhanced static scenario content would go here -->
                </div>
            `;
        }

        // Simple Answer Handling Functions
        let answerStartTime = null;

        // Select answer
        function selectAnswer(optionIndex) {
            selectedAnswer = optionIndex;
            answerStartTime = answerStartTime || Date.now();
            
            // Update UI
            document.querySelectorAll('.answer-btn').forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === optionIndex) {
                    btn.classList.add('selected');
                }
            });
            
            document.querySelector('.submit-answer-btn').disabled = false;
        }

        // Submit answer with simple feedback
        function submitAnswer() {
            if (selectedAnswer === null) return;
            
            const responseTime = Date.now() - answerStartTime;
            const currentQuestion = window.currentAIScenario.challenges[window.currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.correct;
            
            // Update score
            if (isCorrect) {
                window.currentScore++;
            }
            
            // Show simple feedback
            showSimpleFeedback(isCorrect, currentQuestion, responseTime);
            
            // Update performance tracking
            updatePerformanceTracking(isCorrect, responseTime);
            
            // Disable options
            document.querySelectorAll('.answer-btn').forEach(btn => btn.disabled = true);
            document.querySelector('.submit-answer-btn').style.display = 'none';
        }

        // Show simple feedback
        function showSimpleFeedback(isCorrect, question, responseTime) {
            const feedbackPanel = document.getElementById('feedbackPanel');
            feedbackPanel.style.display = 'block';
            
            const responseTimeSeconds = Math.round(responseTime / 1000);
            const grade = isCorrect ? 'CORRECT' : 'INCORRECT';
            const gradeClass = isCorrect ? 'correct' : 'incorrect';
            
            feedbackPanel.innerHTML = `
                <div class="simple-feedback ${gradeClass}">
                    <div class="feedback-grade">
                        <span class="grade-text">${grade}</span>
                        <span class="response-time">${responseTimeSeconds}s</span>
                    </div>
                    
                    <div class="feedback-explanation">
                        <p>${question.aiExplanation}</p>
                    </div>
                    
                    <div class="feedback-actions">
                        <button class="next-question-btn" onclick="proceedToNextQuestion()">
                            ${window.currentQuestionIndex < window.currentAIScenario.challenges.length - 1 ? 
                              'Next Question' : 'Complete Assessment'}
                        </button>
                    </div>
                </div>
            `;
            
            // Update score display
            updateScoreDisplay();
            
            // Scroll to feedback
            feedbackPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Proceed to next question
        function proceedToNextQuestion() {
            window.currentQuestionIndex++;
            selectedAnswer = null;
            answerStartTime = null;
            
            if (window.currentQuestionIndex < window.currentAIScenario.challenges.length) {
                // Show next question
                const nextQuestion = window.currentAIScenario.challenges[window.currentQuestionIndex];
                document.getElementById('currentQuestion').innerHTML = 
                    generateSimpleQuestionHTML(nextQuestion, window.currentQuestionIndex);
                document.getElementById('feedbackPanel').style.display = 'none';
                
                // Update progress
                updateScoreDisplay();
            } else {
                // Complete assessment
                completeAssessment();
            }
        }

        // Complete assessment
        function completeAssessment() {
            const sessionData = getSessionData();
            sessionData.scenariosCompleted++;
            localStorage.setItem('dcaAssessmentSession', JSON.stringify(sessionData));
            
            // Show completion interface
            showAssessmentCompletion();
        }

        // Show assessment completion
        function showAssessmentCompletion() {
            const content = document.getElementById('assessmentContent');
            const totalQuestions = window.currentAIScenario.challenges.length;
            const percentage = Math.round((window.currentScore / totalQuestions) * 100);
            const grade = percentage >= 80 ? 'EXCELLENT' : percentage >= 70 ? 'SATISFACTORY' : percentage >= 60 ? 'NEEDS IMPROVEMENT' : 'UNSATISFACTORY';
            
            content.innerHTML = `
                <div class="assessment-completion">
                    <div class="completion-header">
                        <h2> Assessment Complete</h2>
                        <div class="final-grade ${grade.toLowerCase().replace(' ', '-')}">${grade}</div>
                    </div>
                    
                    <div class="final-score">
                        <div class="score-display">
                            <div class="score-number">${window.currentScore}</div>
                            <div class="score-denominator">/ ${totalQuestions}</div>
                            <div class="score-percentage">${percentage}%</div>
                        </div>
                    </div>
                    
                    <div class="performance-summary">
                        <h3>Performance Summary</h3>
                        <p>${getPerformanceSummary(percentage)}</p>
                    </div>
                    
                    <div class="completion-actions">
                        <button class="action-btn primary" onclick="generateDynamicScenario()">
                             New Assessment
                        </button>
                        <button class="action-btn secondary" onclick="returnToMenu()">
                              Main Menu
                        </button>
                    </div>
                </div>
            `;
        }

        // Get performance summary
        function getPerformanceSummary(percentage) {
            if (percentage >= 80) {
                return "Outstanding performance! You demonstrate strong understanding of DCA principles and emergency response procedures.";
            } else if (percentage >= 70) {
                return "Good performance. You have a solid grasp of damage control fundamentals with room for continued improvement.";
            } else if (percentage >= 60) {
                return "Adequate performance, but additional training recommended. Review damage control procedures and emergency response protocols.";
            } else {
                return "Performance indicates need for comprehensive DCA training. Recommend immediate review of NSTM damage control procedures.";
            }
            
            // Update performance tracking
            updatePerformanceTracking(isCorrect, responseTime);
            
            // Disable options
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            document.querySelector('.submit-btn').style.display = 'none';
        }

        // Generate military-style feedback
        function generateMilitaryFeedback(isCorrect, selectedOption, challenge, responseTime) {
            const performanceLevel = responseTime < 30000 ? 'RAPID' : responseTime < 60000 ? 'ADEQUATE' : 'DELAYED';
            
            let feedback = {
                grade: isCorrect ? 'SATISFACTORY' : 'UNSATISFACTORY',
                timeAssessment: performanceLevel,
                responseTime: Math.round(responseTime / 1000),
                primaryFeedback: '',
                tacticalAnalysis: '',
                aiInsight: challenge.aiExplanation,
                nextActions: '',
                commanderNote: ''
            };
            
            if (isCorrect) {
                feedback.primaryFeedback = `OUTSTANDING, ${performanceLevel} response executed. Your tactical decision demonstrates solid understanding of DCA principles and emergency response protocols.`;
                feedback.tacticalAnalysis = ` CORRECT RESPONSE: Your selection shows proper prioritization of life safety, damage control procedures, and chain of command protocols. This aligns with Navy damage control doctrine.`;
                feedback.nextActions = `CONTINUE TO NEXT PHASE: Maintain this decision-making tempo and situational awareness. Your performance indicates readiness for advanced scenarios.`;
                feedback.commanderNote = `INSTRUCTOR NOTE: Strong performance. Consider this sailor for advanced DCA training opportunities.`;
            } else {
                feedback.primaryFeedback = `NEGATIVE, shipmate. Your response does not align with established damage control procedures. This decision could result in loss of life, ship, or mission capability.`;
                feedback.tacticalAnalysis = ` INCORRECT RESPONSE: The selected option violates fundamental DCA principles. In a real emergency, this choice would compromise crew safety and ship survivability.`;
                feedback.nextActions = `IMMEDIATE REMEDIAL ACTION REQUIRED: Review NSTM 079 Volume 2, damage control procedures. Report to DC Central for additional training before next evolution.`;
                feedback.commanderNote = `INSTRUCTOR NOTE: Requires additional training on fundamental DC principles. Schedule one-on-one remediation.`;
            }
            
            // Add time-specific feedback
            if (performanceLevel === 'DELAYED') {
                feedback.timeAssessment += ` - Response time exceeded tactical requirements. In real emergency, this delay could prove fatal.`;
            } else if (performanceLevel === 'RAPID') {
                feedback.timeAssessment += ` - Excellent response time. Demonstrates readiness for emergency conditions.`;
            }
            
            return feedback;
        }

        // Display AI feedback with military formatting
        function displayAIFeedback(feedback, isCorrect) {
            const feedbackPanel = document.getElementById('aiFeedbackPanel');
            feedbackPanel.style.display = 'block';
            feedbackPanel.innerHTML = `
                <div class="military-feedback ${isCorrect ? 'satisfactory' : 'unsatisfactory'}">
                    <div class="feedback-header">
                        <h3> DCA ASSESSMENT FEEDBACK</h3>
                        <div class="grade-banner ${feedback.grade.toLowerCase()}">
                            ${feedback.grade} - ${feedback.timeAssessment}
                        </div>
                    </div>
                    
                    <div class="feedback-content">
                        <div class="feedback-section">
                            <h4> PERFORMANCE ASSESSMENT</h4>
                            <p><strong>Response Time:</strong> ${feedback.responseTime} seconds - ${feedback.timeAssessment}</p>
                            <p>${feedback.primaryFeedback}</p>
                        </div>
                        
                        <div class="feedback-section">
                            <h4> TACTICAL ANALYSIS</h4>
                            <p>${feedback.tacticalAnalysis}</p>
                        </div>
                        
                        <div class="feedback-section">
                            <h4> AI INSIGHT</h4>
                            <p>${feedback.aiInsight}</p>
                        </div>
                        
                        <div class="feedback-section">
                            <h4> NEXT ACTIONS</h4>
                            <p>${feedback.nextActions}</p>
                        </div>
                        
                        <div class="instructor-note">
                            <h4> INSTRUCTOR EVALUATION</h4>
                            <p><em>${feedback.commanderNote}</em></p>
                        </div>
                    </div>
                    
                    <div class="feedback-actions">
                        <button class="action-btn primary" onclick="proceedToNextChallenge()">
                            ${window.currentChallengeIndex < window.currentAIScenario.challenges.length - 1 ? 
                              'PROCEED TO NEXT PHASE' : 'COMPLETE SCENARIO ASSESSMENT'}
                        </button>
                        <button class="action-btn secondary" onclick="requestDetailedAnalysis()">
                             REQUEST DETAILED AI ANALYSIS
                        </button>
                    </div>
                </div>
            `;
            
            // Scroll to feedback
            feedbackPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Update scenario generation to focus on pier side fires only
        function generateDynamicScenario() {
            // Pier fire focused scenarios
            const pierFireScenarios = [
                {
                    title: "Pier Side Electrical Fire",
                    description: "Shore power connection sparks and ignites nearby materials while ship is moored",
                    challenges: [
                        {
                            question: "First action when pier electrical fire is detected?",
                            options: [
                                "Sound General Alarm", 
                                "Disconnect shore power immediately",
                                "Call pier fire department",
                                "Evacuate the pier"
                            ],
                            correct: 1,
                            explanation: "Disconnecting shore power eliminates the electrical source and prevents escalation."
                        },
                        {
                            question: "What type of extinguisher is most appropriate for electrical fires?",
                            options: [
                                "Water spray",
                                "CO2 extinguisher", 
                                "Foam (AFFF)",
                                "Dry chemical"
                            ],
                            correct: 1,
                            explanation: "CO2 extinguishers are non-conductive and safe for electrical fires."
                        }
                    ]
                },
                {
                    title: "Fuel Spill Pier Fire",
                    description: "Fuel spill ignites during refueling operations, threatening ship and pier infrastructure",
                    challenges: [
                        {
                            question: "Primary concern when fighting pier fuel fire near ship?",
                            options: [
                                "Protecting pier infrastructure",
                                "Preventing spread to ship fuel systems",
                                "Evacuating pier personnel", 
                                "Notifying Coast Guard"
                            ],
                            correct: 1,
                            explanation: "Preventing fire spread to ship's fuel systems prevents catastrophic escalation."
                        },
                        {
                            question: "Best extinguishing agent for large fuel fires on pier?",
                            options: [
                                "Water fog",
                                "CO2 flooding",
                                "AFFF foam application",
                                "Dry chemical powder"
                            ],
                            correct: 2,
                            explanation: "AFFF foam creates a blanket that suppresses vapor and cools the fuel surface."
                        }
                    ]
                },
                {
                    title: "Paint Locker Pier Fire", 
                    description: "Fire in pier-side paint storage threatens ship and nearby vessels",
                    challenges: [
                        {
                            question: "What type of fire is a paint locker fire classified as?",
                            options: [
                                "Class A (solid combustibles)",
                                "Class B (flammable liquids)",
                                "Class C (electrical)",
                                "Class D (metals)"
                            ],
                            correct: 1,
                            explanation: "Paint contains flammable liquids, making it a Class B fire."
                        },
                        {
                            question: "When shore firefighters arrive, your coordination priority is?",
                            options: [
                                "Give them full control of the scene",
                                "Maintain ship safety while coordinating response",
                                "Focus only on ship protection",
                                "Evacuate ship immediately"
                            ],
                            correct: 1,
                            explanation: "Ship's commanding officer maintains responsibility for ship safety while coordinating with shore responders."
                        }
                    ]
                }
            ];

            // Select random scenario
            const selectedScenario = pierFireScenarios[Math.floor(Math.random() * pierFireScenarios.length)];
            
            // Initialize assessment
            window.currentAIScenario = selectedScenario;
            window.currentQuestionIndex = 0;
            window.currentScore = 0;
            
            displayAIGeneratedScenario(selectedScenario);
        }

        // Utility function to shuffle arrays
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

    </script>
</body>
</html>