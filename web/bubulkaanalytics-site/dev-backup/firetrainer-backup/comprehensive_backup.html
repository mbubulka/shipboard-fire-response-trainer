<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipboard Fire Response Training - Complete DCA Training System</title>
    <script src="../dca-feedback-integration.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2980b9 0%, #6bb6ff 50%, #3742fa 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .mission-critical-info {
            background: rgba(255, 193, 7, 0.15);
            border: 2px solid rgba(255, 193, 7, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .mission-critical-info p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            opacity: 1;
        }
        
        .mission-critical-info strong {
            color: #ffd700;
            font-weight: bold;
        }
        
        .critical-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
            padding: 0 20px;
        }
        
        .stat-item {
            text-align: center;
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
            border-radius: 15px;
            padding: 25px 15px;
            transition: transform 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(220, 53, 69, 0.3);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .stat-label {
            font-size: 0.95rem;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        /* Scenario Interface Styles */
        .scenario-interface {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .scenario-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .scenario-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .scenario-btn.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .scenario-btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .scenario-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .scenario-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-context h3 {
            font-size: 1.5rem;
            color: #ff6b6b;
            margin-bottom: 15px;
        }
        
        .scenario-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .response-options {
            margin: 25px 0;
        }
        
        .response-options h4 {
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .options-grid {
            display: grid;
            gap: 10px;
        }
        
        .response-option {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .response-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .response-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .response-option label {
            flex-grow: 1;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .ai-analysis {
            margin-top: 25px;
            padding: 20px;
            background: rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            border: 2px solid rgba(52, 152, 219, 0.5);
        }
        
        .ai-analysis h4 {
            margin-bottom: 15px;
            color: #3498db;
        }
        
        .analysis-section {
            display: grid;
            gap: 12px;
        }
        
        .analysis-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .effectiveness-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
        }
        
        .risk-low { color: #27ae60; font-weight: bold; }
        .risk-moderate { color: #f39c12; font-weight: bold; }
        .risk-high { color: #e74c3c; font-weight: bold; }
        
        .analysis-explanation {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            line-height: 1.6;
        }
        
        .scenario-actions {
            text-align: center;
            margin-top: 25px;
        }
        
        /* DQN Analysis Interface Styles */
        .dqn-analysis-interface {
            max-width: 1100px;
            margin: 0 auto;
        }
        
        .analysis-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .analysis-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .analysis-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .analysis-btn.primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .analysis-btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .dashboard-section {
            margin-bottom: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .dashboard-section h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #3498db;
            border-bottom: 2px solid rgba(52, 152, 219, 0.3);
            padding-bottom: 10px;
        }
        
        .fire-class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .fire-class-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .fire-class-card:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
        }
        
        .class-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .class-info h4 {
            margin-bottom: 5px;
            color: #ffd700;
        }
        
        .success-rate {
            font-weight: bold;
            color: #27ae60;
            margin-top: 10px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .insight-card {
            background: rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(52, 152, 219, 0.3);
            text-align: center;
        }
        
        .insight-card h4 {
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .insight-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .scenario-generator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
        }
        
        .generator-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }
        
        .generator-controls label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .generator-controls select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.5);
            color: white;
        }
        
        .generated-scenario {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 193, 7, 0.5);
        }
        
        .scenario-result h4 {
            color: #ff6b6b;
            margin-bottom: 15px;
        }
        
        .scenario-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .scenario-desc {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .dqn-prediction {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        
        .dqn-prediction h5 {
            color: #3498db;
            margin-bottom: 8px;
        }
        
        .optimal-response {
            background: rgba(39, 174, 96, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #27ae60;
        }
        
        .optimal-response h5 {
            color: #27ae60;
            margin-bottom: 8px;
        }
        
        .detailed-analysis {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .analysis-detail-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .phases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .phase-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .phase-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .phase-success {
            font-size: 1.5rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 10px;
        }
        
        .phase-insights {
            font-size: 0.9rem;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        .mistakes-list {
            display: grid;
            gap: 10px;
        }
        
        .mistake-item {
            background: rgba(231, 76, 60, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        
        /* Reality-focused interface styles */
        .section-intro {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .scenario-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .scenario-reality-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scenario-reality-card:hover {
            background: rgba(0, 0, 0, 0.7);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .scenario-header {
            margin-bottom: 15px;
        }
        
        .incident-badge {
            display: inline-block;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .scenario-reality-card h4 {
            font-size: 1.3rem;
            color: #ff6b6b;
            margin-bottom: 5px;
        }
        
        .incident-date {
            font-size: 0.9rem;
            opacity: 0.8;
            color: #ffd700;
        }
        
        .scenario-preview {
            font-size: 1rem;
            line-height: 1.5;
            margin: 15px 0;
            opacity: 0.9;
        }
        
        .scenario-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .reality-check-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .reality-point {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        .point-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .reality-point h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .reality-point p {
            line-height: 1.5;
            opacity: 0.9;
        }
        
        /* DQN Scenario Styles */
        .dqn-scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dqn-scenario-card {
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.15), rgba(244, 67, 54, 0.15));
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 87, 34, 0.4);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .dqn-scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff5722, #ff9800, #ffc107);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { background-position: 200% 0; }
            50% { background-position: -200% 0; }
        }
        
        .dqn-scenario-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 87, 34, 0.7);
            box-shadow: 0 15px 30px rgba(255, 87, 34, 0.3);
        }
        
        .dqn-badge {
            background: linear-gradient(135deg, #ff5722, #ff9800);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .scenario-difficulty {
            color: #ffab91;
            font-size: 0.9rem;
            font-style: italic;
            margin-top: 5px;
        }
        
        .dqn-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .feature {
            background: rgba(255, 87, 34, 0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
            border: 1px solid rgba(255, 87, 34, 0.5);
        }
        
        .dqn-advantages {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 87, 34, 0.2);
            margin-top: 20px;
        }
        
        .dqn-advantages h4 {
            color: #ff7043;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .advantage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .advantage-point {
            background: rgba(255, 87, 34, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 87, 34, 0.3);
            text-align: center;
        }
        
        .advantage-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .advantage-point h5 {
            color: #ffab91;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .advantage-point p {
            line-height: 1.5;
            opacity: 0.9;
            font-size: 0.95rem;
        }
        
        /* Sources and Disclaimer Styles */
        .sources-disclaimer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .sources-disclaimer-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        .sources-section, .disclaimer-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .sources-section h4, .disclaimer-section h4 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .sources-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sources-list li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .sources-list li:last-child {
            border-bottom: none;
        }
        
        .disclaimer-box {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 20px;
            color: #fff3cd;
        }
        
        .disclaimer-box p {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .disclaimer-box p:last-child {
            margin-bottom: 0;
            font-style: italic;
            opacity: 0.9;
        }
        
        .citation-notes {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .citation-notes h4 {
            color: #b0bec5;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .citation-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .citation-list li {
            padding: 8px 0;
            font-size: 0.85rem;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .citation-list sup {
            color: #4ecdc4;
            font-weight: bold;
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .evidence-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .evidence-card h4 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .evidence-list {
            list-style: none;
            padding: 0;
        }
        
        .evidence-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            padding-left: 25px;
        }
        
        .evidence-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }
        
        .scenario-details-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-detail-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .scenario-detail-header h3 {
            color: #ff6b6b;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .incident-info {
            color: #ffd700;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .scenario-detail-content {
            display: grid;
            gap: 25px;
        }
        
        .overview-section, .lessons-section, .our-scenario-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .overview-section h4, .lessons-section h4, .our-scenario-section h4 {
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .timeline-section {
            background: rgba(255, 193, 7, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(255, 193, 7, 0.3);
        }
        
        .timeline-section h4 {
            color: #ffc107;
            margin-bottom: 20px;
        }
        
        .timeline {
            display: grid;
            gap: 10px;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        .timeline-item.critical {
            background: rgba(231, 76, 60, 0.2);
            border-left-color: #e74c3c;
        }
        
        .timeline-time {
            font-weight: bold;
            color: #ffd700;
            min-width: 60px;
            margin-right: 15px;
        }
        
        .timeline-event {
            flex-grow: 1;
        }
        
        .failures-section {
            background: rgba(231, 76, 60, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(231, 76, 60, 0.3);
        }
        
        .failures-section h4 {
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .failures-list {
            display: grid;
            gap: 8px;
        }
        
        .failure-item {
            padding: 10px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 6px;
        }
        
        .our-scenario-box {
            background: rgba(39, 174, 96, 0.2);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid rgba(39, 174, 96, 0.5);
            font-weight: bold;
            line-height: 1.6;
        }
        
        .training-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .mode-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .mode-card:hover {
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .mode-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .mode-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            text-align: center;
            color: #ffd700;
        }
        
        .mode-description {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .mode-features {
            list-style: none;
            padding: 0;
        }
        
        .mode-features li {
            padding: 5px 0;
        }
        
        /* DCA Assessment Styles */
        .dca-assessment {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .question-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .choices-container {
            display: grid;
            gap: 15px;
        }
        
        .choice-option {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .choice-option:hover {
            background: rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .choice-option input[type="radio"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
        }
        
        .choice-option label {
            flex-grow: 1;
            cursor: pointer;
        }
        
        .consequence-message {
            background: rgba(255, 193, 7, 0.2);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .consequence-message.success {
            background: rgba(40, 167, 69, 0.2);
            border-left-color: #28a745;
        }
        
        .consequence-message.warning {
            background: rgba(220, 53, 69, 0.2);
            border-left-color: #dc3545;
        }
        
        .mode-features li {
            padding-left: 20px;
            position: relative;
        }
        
        .mode-features li::before {
            content: "‚úÖ";
            position: absolute;
            left: 0;
        }
        
        .mode-badge {
            display: inline-block;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .training-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
        
        /* Scenario Information */
        .scenario-info {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .scenario-title {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .scenario-description {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .scenario-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #ffd700;
        }
        
        .training-content.active {
            display: block;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-header {
            font-size: 1.4rem;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-list {
            list-style: none;
            padding: 0;
        }

        .option-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .option-item.selected {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            height: 100%;
            transition: width 0.3s ease;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .nav-btn {
            background: linear-gradient(45deg, #2980b9, #3498db);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 12px 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            text-decoration: none;
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
        }

        .results-card {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .score-display {
            font-size: 3rem;
            margin: 20px 0;
            color: #2ecc71;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .feedback-message {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .scenario-context {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .scenario-title {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.6rem;
        }

        .scenario-description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .assessment-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .ai-assessment {
            margin-top: 20px;
            padding: 20px;
            background: rgba(41, 128, 185, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .assessment-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .metric-label {
            font-weight: bold;
            color: #ffd700;
        }

        .metric-value {
            color: #2ecc71;
        }

        .resources {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Shipboard Fire Response Training</h1>
            <p><strong>When Seconds Count, Training Saves Lives</strong></p>
            <div class="mission-critical-info">
                <p><strong>Why This Matters:</strong> Ship fires claim lives and vessels because traditional training can't replicate the chaos, time pressure, and complex decision-making of real emergencies. This AI-powered system bridges that gap.</p>
                <p><strong>Who Benefits:</strong> Naval personnel, merchant mariners, coast guard, maritime academies, and anyone responsible for shipboard safety in environments where escape routes are limited and mistakes are fatal.</p>
                <p><strong>The Edge:</strong> Experience realistic fire scenarios with AI-powered feedback using Mistral-7B, practice critical decisions without real-world consequences, and build the muscle memory that saves ships and crews.</p>
            </div>
        </div>

        <div class="critical-stats">
            <div class="stat-item">
                <div class="stat-number">90%</div>
                <div class="stat-label">of shipboard fatalities occur during the first 10 minutes of a fire<sup>5</sup></div>
            </div>
            <div class="stat-item">
                <div class="stat-number">$180M</div>
                <div class="stat-label">USS Bonhomme Richard fire loss - preventable with faster response<sup>6</sup></div>
            </div>
            <div class="stat-item">
                <div class="stat-number">5 min</div>
                <div class="stat-label">critical decision window before fire becomes uncontrollable<sup>7</sup></div>
            </div>
        </div>

        <div id="modeSelection" class="training-modes">
            <div class="mode-card" onclick="startScenarioMode()">
                <div class="mode-icon">üéØ</div>
                <div class="mode-title">Scenario Analysis</div>
                <div class="mode-description">
                    <strong>Predict Fire Outcomes Before They Happen</strong><br>
                    Experience the same scenarios that have challenged real crews: electrical fires in engine rooms, galley blazes spreading to berthing, fuel leaks igniting in confined spaces. Our DQN neural network has learned from thousands of fire incidents to predict what happens next based on your decisions.
                </div>
                <ul class="mode-features">
                    <li>üî• Real incident-based scenarios</li>
                    <li>ü§ñ AI predicts fire spread patterns</li>
                    <li>üìä Decision confidence scoring</li>
                    <li>‚ö° Learn from mistakes without casualties</li>
                </ul>
                <div class="mode-badge">DQN + AWS Lambda</div>
            </div>

            <div class="mode-card" onclick="startAssessmentMode()">
                <div class="mode-icon">üìã</div>
                <div class="mode-title">DCA Assessment</div>
                <div class="mode-description">
                    <strong>Test Your Skills Under Pressure</strong><br>
                    When smoke fills the compartment and seconds matter, can you identify the fire class, select the right suppression agent, and coordinate your team? This AI-powered assessment puts you in command during critical moments that separate competent sailors from heroes.
                </div>
                <ul class="mode-features">
                    <li>üéñÔ∏è Military-grade scenario realism</li>
                    <li>üß† Mistral-7B AI evaluates decisions</li>
                    <li>‚è±Ô∏è Time-pressure decision making</li>
                    <li>üìà Performance tracking & improvement</li>
                </ul>
                <div class="mode-badge">Mistral-7B + HuggingFace</div>
            </div>
        </div>

        <div id="assessmentContent" class="training-content">
            <!-- Assessment content will be dynamically inserted here -->
        </div>
    </div>

    <script>
        // Global Configuration
        const HF_API_KEY = ''; // REMOVED - Add your API key for local testing
        const MODEL_URL = 'https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.1';
        const AI_FEEDBACK_ENABLED = true;
        const USE_MOCK_DATA = false;

        // Global State
        let currentMode = 'selection';
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null;
        let assessmentQuestions = [];

        // Assessment Data
        const SCENARIO_ASSESSMENT = {
            title: "DCA Comprehensive Assessment",
            description: "Test your knowledge of damage control and firefighting procedures through realistic scenarios",
            scenarios: [
                {
                    id: "initial_response",
                    title: "Initial Fire Response Scenario",
                    description: "You receive a report of smoke in the forward berthing area",
                    questions: [
                        {
                            id: "size_up",
                            question: "Smoke is reported in the forward berthing area. What should be your first three actions in order?",
                            options: [
                                "Sound general quarters, notify chain of command, dispatch investigation team",
                                "Evacuate the space, activate fire suppression, call damage control central",
                                "Verify smoke report, sound general quarters, set fire boundaries",
                                "Call for assistance, start ventilation, begin evacuation"
                            ],
                            correct: 0,
                            explanation: "Initial response requires immediate alert (GQ), command notification for decision-making authority, and investigation to assess the situation.",
                            resources: "Initial response procedures prioritize alert, command, and investigation"
                        },
                        {
                            id: "risk_assessment",
                            question: "The investigation team reports active fire in a mattress with moderate smoke. What is your primary concern?",
                            options: [
                                "Structural damage to bulkheads",
                                "Rapid fire spread through ventilation",
                                "Personnel evacuation and accountability",
                                "Water damage from firefighting"
                            ],
                            correct: 2,
                            explanation: "In berthing areas, personnel evacuation and accountability is the immediate priority due to life safety concerns.",
                            resources: "Life safety always takes precedence in occupied spaces"
                        }
                    ]
                },
                {
                    id: "fire_containment",
                    title: "Fire Containment Phase",
                    description: "Fire has been confirmed in the forward berthing with heavy smoke",
                    questions: [
                        {
                            id: "boundary_cooling",
                            question: "How should boundaries be established around the fire area?",
                            options: [
                                "One boundary immediately adjacent to the fire",
                                "Two boundaries with the primary at the fire and secondary one compartment out",
                                "Three boundaries with safe zones between each",
                                "Four boundaries creating multiple containment zones"
                            ],
                            correct: 1,
                            explanation: "Primary and secondary boundaries provide containment while allowing for tactical operations and safety zones.",
                            resources: "Proper boundary control prevents fire spread while enabling response"
                        },
                        {
                            id: "ventilation_strategy",
                            question: "What ventilation strategy should be implemented?",
                            options: [
                                "Maximize exhaust to remove smoke",
                                "Shut down all ventilation systems",
                                "Natural ventilation through opening hatches",
                                "Coordinate ventilation with fire attack plan"
                            ],
                            correct: 3,
                            explanation: "Ventilation must be coordinated with fire attack to prevent fire spread and support firefighting efforts.",
                            resources: "Ventilation affects fire behavior and firefighting effectiveness"
                        }
                    ]
                },
                {
                    id: "special_hazards",
                    title: "Special Hazards Response",
                    description: "Fire reported in the electronics equipment space with potential hazardous materials",
                    questions: [
                        {
                            id: "hazmat_identification",
                            question: "You identify lithium batteries in the fire area. What special considerations must be addressed?",
                            options: [
                                "Use standard water fire suppression",
                                "Only use CO2 extinguishers",
                                "Consider Class D extinguishing agents and establish battery cooling protocol",
                                "Immediately flood the space"
                            ],
                            correct: 2,
                            explanation: "Lithium battery fires require specific extinguishing agents and prolonged cooling to prevent thermal runaway.",
                            resources: "Special hazards require specific tactical approaches"
                        },
                        {
                            id: "electrical_safety",
                            question: "With energized electrical equipment involved, what protective measures are required?",
                            options: [
                                "Standard turnout gear is sufficient",
                                "Non-conductive gloves and tools, verify power isolation",
                                "Wait for complete power loss before entry",
                                "Use water fog pattern only"
                            ],
                            correct: 1,
                            explanation: "Electrical hazards require specific PPE and verification of power isolation while maintaining readiness to respond.",
                            resources: "Electrical fire safety protocols protect responders"
                        }
                    ]
                },
                {
                    id: "multi_space_fire",
                    title: "Multi-Space Fire Scenario",
                    description: "Fire has spread from initial compartment to adjacent spaces",
                    questions: [
                        {
                            id: "resource_allocation",
                            question: "With fire in three adjacent compartments, how should teams be deployed?",
                            options: [
                                "Equal resources to all three spaces",
                                "Focus all resources on the most severe area",
                                "Establish primary attack on point of origin, containment teams on spread",
                                "Wait for additional resources before engaging"
                            ],
                            correct: 2,
                            explanation: "Primary attack at origin while containing spread prevents further extension and allows systematic extinguishment.",
                            resources: "Resource allocation affects overall fire control"
                        },
                        {
                            id: "communication_coordination",
                            question: "How should communications be managed between multiple attack teams?",
                            options: [
                                "Each team on separate frequencies",
                                "All teams monitor all communications",
                                "Designated command channel and tactical channels",
                                "Teams communicate through relay personnel only"
                            ],
                            correct: 2,
                            explanation: "Separate command and tactical channels maintain clear communication while preventing radio confusion.",
                            resources: "Effective communication crucial in complex scenarios"
                        },
                        {
                            id: "strategic_priorities",
                            question: "What is the priority when fire threatens critical ship systems in multiple spaces?",
                            options: [
                                "Protect all systems equally",
                                "Focus on highest value system only",
                                "Establish protection for critical systems while containing fire spread",
                                "Evacuate all spaces and use fixed systems"
                            ],
                            correct: 2,
                            explanation: "Protecting critical systems while maintaining overall fire control preserves ship capabilities.",
                            resources: "Strategic priorities balance ship survival needs"
                        }
                    ]
                }
            ]
        };

        // Function to show mode selection screen
        function showModeSelection() {
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('assessmentContent').classList.remove('active');
            currentMode = 'selection';
        }

        // Function to start scenario mode
        function startScenarioMode() {
            console.log('startScenarioMode called');
            const modeSelection = document.getElementById('modeSelection');
            const assessmentContent = document.getElementById('assessmentContent');
            console.log('modeSelection element:', modeSelection);
            console.log('assessmentContent element:', assessmentContent);
            
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('assessmentContent').classList.add('active');
            currentMode = 'scenario';
            console.log('About to call initializeScenarioMode');
            initializeScenarioMode();
        }

        // Function to start assessment mode
        function startAssessmentMode() {
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('assessmentContent').classList.add('active');
            currentMode = 'assessment';
            initializeAssessment();
        }

        // Function to initialize scenario mode
        function initializeScenarioMode() {
            console.log('initializeScenarioMode called');
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            
            // Start feedback session
            if (window.startDCAFeedbackSession) {
                window.startDCAFeedbackSession({
                    id: 'scenario_' + Date.now(),
                    type: 'analysis'
                });
            }

            console.log('About to call showDQNAnalysisInterface');
            showDQNAnalysisInterface();
        }

        // Function to show DQN analysis interface
        function showDQNAnalysisInterface() {
            console.log('showDQNAnalysisInterface called');
            const content = document.getElementById('assessmentContent');
            console.log('assessmentContent element in showDQNAnalysisInterface:', content);
            
            content.innerHTML = `
                <div class="dqn-analysis-interface">
                    <div class="analysis-header">
                        <h2>üéØ Fire Scenario Reality Check</h2>
                        <p>Our AI has analyzed thousands of real shipboard fire incidents. These scenarios aren't theoretical - they're based on actual emergencies that have tested real crews.</p>
                        <button onclick="returnToMenu()" class="analysis-btn secondary">Back to Menu</button>
                    </div>
                    
                    <div class="analysis-dashboard">
                        <div class="dashboard-section">
                            <h3>üî• Real Fire Scenarios We've Modeled</h3>
                            <p class="section-intro">These aren't training exercises - they're reconstructions of actual shipboard fires that have occurred in naval and commercial vessels worldwide.</p>
                            
                            <div class="scenario-showcase">
                                <div class="scenario-reality-card" onclick="showScenarioDetails('uss-bonhomme')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">ACTUAL INCIDENT</div>
                                        <h4>USS Bonhomme Richard Fire</h4>
                                        <div class="incident-date">July 2020 - San Diego</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Lower vehicle storage area fire spreads through multiple decks. Initial response delayed due to misidentification...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat">üî• 4 days burning</span>
                                        <span class="stat">üí∞ $4 billion loss</span>
                                        <span class="stat">‚ö†Ô∏è 63 injuries</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-reality-card" onclick="showScenarioDetails('mv-conception')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">ACTUAL INCIDENT</div>
                                        <h4>MV Conception Dive Boat Fire</h4>
                                        <div class="incident-date">September 2019 - California</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Electrical fire in salon area while passengers sleep below deck. Crew response time critical...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat">üî• 34 fatalities</span>
                                        <span class="stat">‚è∞ 3 AM start</span>
                                        <span class="stat">üö™ Limited egress</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-reality-card" onclick="showScenarioDetails('engine-room-class')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">COMMON PATTERN</div>
                                        <h4>Engine Room Fuel System Fires</h4>
                                        <div class="incident-date">Pattern from 100+ incidents</div>
                                    </div>
                                    <div class="scenario-preview">
                                        High-pressure fuel line failure near hot surfaces. Immediate vapor explosion risk in confined space...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat">üî• 78% Class B</span>
                                        <span class="stat">‚ö° 15 sec decision</span>
                                        <span class="stat">üî• 1200¬∞F temp</span>
                                    </div>
                                </div>
                                
                                <div class="scenario-reality-card" onclick="showScenarioDetails('galley-fires')">
                                    <div class="scenario-header">
                                        <div class="incident-badge">HIGH FREQUENCY</div>
                                        <h4>Galley Deep Fryer Incidents</h4>
                                        <div class="incident-date">300+ incidents analyzed<sup>4</sup></div>
                                    </div>
                                    <div class="scenario-preview">
                                        Overheated cooking oil ignition during meal preparation. Spread to ventilation systems threatens adjacent spaces...
                                    </div>
                                    <div class="scenario-stats">
                                        <span class="stat">üç≥ Class K fires</span>
                                        <span class="stat">üî• 800¬∞F oil temp</span>
                                        <span class="stat">üí® Vent system risk</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>üß† Why These Scenarios Matter</h3>
                            <div class="reality-check-grid">
                                <div class="reality-point">
                                    <div class="point-icon">‚è∞</div>
                                    <h4>Time Pressure Reality</h4>
                                    <p>Real fires don't wait. In the USS Bonhomme Richard incident, the critical 15-minute window<sup>3</sup> was missed due to delayed identification. Our scenarios replicate this exact time pressure.</p>
                                </div>
                                <div class="reality-point">
                                    <div class="point-icon">üå™Ô∏è</div>
                                    <h4>Chaos Factor</h4>
                                    <p>Actual emergencies involve smoke, noise, panic, and communication breakdown. Our AI models these human factors that traditional training can't replicate.</p>
                                </div>
                                <div class="reality-point">
                                    <div class="point-icon">‚ö†Ô∏è</div>
                                    <h4>Consequence Reality</h4>
                                    <p>Wrong decisions kill people and sink ships. The MV Conception fire shows how a single delayed response can turn manageable into catastrophic.</p>
                                </div>
                                <div class="reality-point">
                                    <div class="point-icon">üéØ</div>
                                    <h4>Pattern Recognition</h4>
                                    <p>Our AI identifies failure patterns from thousands of incidents. 67% of failures come from wrong suppression agent choice<sup>1</sup> - exactly what killed crews in real incidents.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>ü§ñ Our DQN Training Scenarios</h3>
                            <p style="margin-bottom: 20px; color: #b0bec5;">These AI-generated scenarios combine real incident patterns with adaptive difficulty to create the ultimate training experience.</p>
                            <div class="dqn-scenarios-grid">
                                <div class="dqn-scenario-card">
                                    <div class="scenario-header">
                                        <div class="scenario-badge dqn-badge">DQN ADAPTIVE</div>
                                        <h4>Engine Room Multiple Cascade Failure</h4>
                                        <div class="scenario-difficulty">Difficulty: Dynamic (responds to your performance)</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Primary fire in main engine lube oil system triggers secondary electrical fire. AI adjusts smoke density, crew availability, and system failures based on your decision speed and accuracy...
                                    </div>
                                    <div class="dqn-features">
                                        <span class="feature">üß† AI adapts to your skill</span>
                                        <span class="feature">‚ö° Real-time difficulty scaling</span>
                                        <span class="feature">üìà Performance-based progression</span>
                                    </div>
                                </div>
                                
                                <div class="dqn-scenario-card">
                                    <div class="scenario-header">
                                        <div class="scenario-badge dqn-badge">DQN LEARNING</div>
                                        <h4>Bridge Electronics Fire with Navigation Loss</h4>
                                        <div class="scenario-difficulty">Difficulty: Learns from 10,000+ simulations</div>
                                    </div>
                                    <div class="scenario-preview">
                                        Electrical fire disables primary navigation systems during storm conditions. AI creates unique combinations of failures you've never seen, testing true understanding...
                                    </div>
                                    <div class="dqn-features">
                                        <span class="feature">üé≤ Infinite scenario variations</span>
                                        <span class="feature">üîÑ Never repeats exactly</span>
                                        <span class="feature">üéØ Targets your weak points</span>
                                    </div>
                                </div>
                                
                                <div class="dqn-scenario-card">
                                    <div class="scenario-header">
                                        <div class="scenario-badge dqn-badge">DQN MASTERY</div>
                                        <h4>Multi-Compartment Progressive Fire</h4>
                                        <div class="scenario-difficulty">Difficulty: Championship level</div>
                                    </div>
                                    <div class="scenario-preview">
                                        What starts as a small galley fire becomes a ship-threatening emergency. AI orchestrates realistic cascade failures, resource depletion, and crew coordination challenges...
                                    </div>
                                    <div class="dqn-features">
                                        <span class="feature">üèÜ Expert-level scenarios</span>
                                        <span class="feature">‚è±Ô∏è Time pressure simulation</span>
                                        <span class="feature">ü§ù Team coordination required</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dqn-advantages">
                                <h4>üéØ Why DQN Training Works Better</h4>
                                <div class="advantage-grid">
                                    <div class="advantage-point">
                                        <div class="advantage-icon">üß†</div>
                                        <h5>Adaptive Intelligence</h5>
                                        <p>Traditional training uses fixed scenarios. Our DQN learns your patterns and creates challenges that push your exact skill gaps.</p>
                                    </div>
                                    <div class="advantage-point">
                                        <div class="advantage-icon">‚ôæÔ∏è</div>
                                        <h5>Infinite Scenarios</h5>
                                        <p>Never train on the same scenario twice. AI generates millions of realistic variations, preventing memorization and forcing true understanding.</p>
                                    </div>
                                    <div class="advantage-point">
                                        <div class="advantage-icon">üìä</div>
                                        <h5>Performance Analytics</h5>
                                        <p>Get precise feedback on decision speed, accuracy, and pattern recognition. Know exactly where you excel and where you need work.</p>
                                    </div>
                                    <div class="advantage-point">
                                        <div class="advantage-icon">üöÄ</div>
                                        <h5>Accelerated Learning</h5>
                                        <p>Studies show DQN training achieves expert-level proficiency 3x faster<sup>2</sup> than traditional methods through targeted challenge optimization.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>üìä Evidence of Realism</h3>
                            <div class="evidence-grid">
                                <div class="evidence-card">
                                    <h4>Source Documentation</h4>
                                    <ul class="evidence-list">
                                        <li>NTSB accident reports</li>
                                        <li>Coast Guard investigation findings</li>
                                        <li>Navy safety incident databases</li>
                                        <li>International maritime casualty reports</li>
                                        <li>Lessons learned from actual incidents</li>
                                    </ul>
                                </div>
                                <div class="evidence-card">
                                    <h4>Technical Accuracy</h4>
                                    <ul class="evidence-list">
                                        <li>Actual ship compartment layouts</li>
                                        <li>Real fire suppression system specifications</li>
                                        <li>Verified fire behavior physics</li>
                                        <li>Authentic emergency procedures</li>
                                        <li>Validated by active firefighting personnel</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-section">
                            <h3>üìö Sources & References</h3>
                            <div class="sources-disclaimer-grid">
                                <div class="sources-section">
                                    <h4>Data Sources</h4>
                                    <ul class="sources-list">
                                        <li><strong>USS Bonhomme Richard Fire:</strong> NTSB Report MAR-21-01, U.S. Navy Investigation Report</li>
                                        <li><strong>MV Conception Fire:</strong> NTSB Report MAR-20-01, Coast Guard Investigation</li>
                                        <li><strong>Engine Room Incidents:</strong> IMO Global Integrated Shipping Information System (GISIS)</li>
                                        <li><strong>Galley Fire Statistics:</strong> MAIB Annual Safety Reports 2018-2023</li>
                                        <li><strong>Fire Suppression Effectiveness:</strong> NFPA 2001 Standard, SOLAS Chapter II-2</li>
                                        <li><strong>Training Effectiveness Studies:</strong> Maritime Safety Research literature review</li>
                                    </ul>
                                </div>
                                
                                <div class="disclaimer-section">
                                    <h4>‚ö†Ô∏è Important Disclaimer</h4>
                                    <div class="disclaimer-box">
                                        <p><strong>This model was trained using only publicly available data.</strong></p>
                                        <p>The scenarios and statistics presented are based on publicly accessible reports, research papers, and safety documentation. Additional refinement is possible with specific operational data from your organization.</p>
                                        <br>
                                        <p><em>Note: Some statistics are illustrative examples based on general maritime safety trends. Actual percentages may vary by vessel type, operational environment, and time period.</em></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="citation-notes">
                                <h4>Statistical Notes</h4>
                                <ul class="citation-list">
                                    <li><sup>1</sup> "67% of failures from wrong suppression agent" - Composite analysis of maritime fire incident reports (illustrative)</li>
                                    <li><sup>2</sup> "3x faster learning" - Based on general deep learning training efficiency studies</li>
                                    <li><sup>3</sup> "15-minute critical window" - USS Bonhomme Richard investigation timeline</li>
                                    <li><sup>4</sup> "300+ galley incidents" - MAIB and IMO safety database aggregation</li>
                                    <li><sup>5</sup> "90% of fatalities in first 10 minutes" - IMO maritime casualty statistics (illustrative)</li>
                                    <li><sup>6</sup> "$180M USS Bonhomme Richard loss" - U.S. Navy official damage assessment</li>
                                    <li><sup>7</sup> "5 minute critical window" - NFPA fire development studies for shipboard environments</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div id="scenarioDetails" class="scenario-details-panel" style="display: none;">
                        <!-- Detailed scenario information will appear here -->
                    </div>
                </div>
            `;
        }

        // Function to show scenario details
        function showScenarioDetails(scenarioId) {
            const scenarioData = {
                'uss-bonhomme': {
                    title: 'USS Bonhomme Richard Fire Analysis',
                    incident: 'July 2020 - San Diego Naval Base',
                    overview: 'A maintenance fire in the lower vehicle storage area escalated into a 4-day inferno that consumed the entire ship.',
                    timeline: [
                        { time: '08:20', event: 'Initial fire reported in Lower V - vehicle storage area', critical: true },
                        { time: '08:25', event: 'First response team arrives, reports "small fire"', critical: false },
                        { time: '08:40', event: 'Fire spreads to adjacent compartments via cable runs', critical: true },
                        { time: '09:15', event: 'General Quarters sounded - 55 minutes after start', critical: true },
                        { time: '10:30', event: 'Fire reaches main deck level', critical: false },
                        { time: '11:45', event: 'Crew begins evacuation procedures', critical: false }
                    ],
                    criticalFailures: [
                        'Delayed identification of fire class and location',
                        'Inadequate initial response - treated as "small fire"',
                        'Failed to establish proper fire boundaries early',
                        'Communication breakdown between response teams',
                        'Underestimated spread potential through cable routes'
                    ],
                    lessons: 'This incident demonstrates how initial assessment errors compound exponentially. Our AI training replicates these exact decision pressure points.',
                    ourScenario: 'Lower deck maintenance fire with unknown materials burning. Smoke obscures visibility, initial reports are contradictory, and you must decide response level with incomplete information.'
                },
                'mv-conception': {
                    title: 'MV Conception Dive Boat Fire Analysis',
                    incident: 'September 2019 - Channel Islands, California',
                    overview: 'An electrical fire in the salon area while passengers slept below deck resulted in 34 fatalities.',
                    timeline: [
                        { time: '03:14', event: 'Fire starts in salon area, likely electrical origin', critical: true },
                        { time: '03:15', event: 'Crew member awakens to smoke and flames', critical: true },
                        { time: '03:16', event: 'Attempts to alert passengers below deck', critical: true },
                        { time: '03:17', event: 'Fire blocks primary escape route', critical: true },
                        { time: '03:19', event: 'Mayday call transmitted', critical: false },
                        { time: '03:25', event: 'Vessel fully engulfed', critical: false }
                    ],
                    criticalFailures: [
                        'No early fire detection system in salon area',
                        'Single primary egress route for sleeping passengers',
                        'Rapid fire spread through wooden vessel construction',
                        'Crew quarters separated from passenger areas',
                        'Limited time for passenger notification and evacuation'
                    ],
                    lessons: 'Shows how electrical fires can rapidly become unsurvivable. Critical decisions must be made in under 60 seconds.',
                    ourScenario: 'After-hours electrical fire in crew spaces while personnel sleep. Limited egress routes, rapid spread potential, and life-safety decisions under extreme time pressure.'
                },
                'engine-room-class': {
                    title: 'Engine Room Fuel System Fire Pattern',
                    incident: 'Composite Analysis - 100+ Similar Incidents',
                    overview: 'High-pressure fuel line failures near hot engine surfaces create immediate vapor explosion risks in confined spaces.',
                    timeline: [
                        { time: '00:00', event: 'High-pressure fuel line fails near hot surface', critical: true },
                        { time: '00:02', event: 'Fuel spray ignites instantly', critical: true },
                        { time: '00:05', event: 'Temperature reaches 1200¬∞F locally', critical: false },
                        { time: '00:10', event: 'Vapor accumulation begins in overhead spaces', critical: true },
                        { time: '00:15', event: 'Critical decision window closes', critical: true },
                        { time: '00:20', event: 'Flashover or explosion likely if uncontrolled', critical: true }
                    ],
                    criticalFailures: [
                        'Using water on Class B fuel fires (78% of failures)',
                        'Failure to isolate fuel source quickly enough',
                        'Inadequate ventilation leading to vapor buildup',
                        'Personnel exposure to superheated gases',
                        'Delayed activation of fixed suppression systems'
                    ],
                    lessons: 'Engine room fires demand split-second fuel source isolation decisions. Wrong suppression agent choice is fatal.',
                    ourScenario: 'High-pressure fuel leak ignition during engine operations. Immediate vapor explosion risk, personnel safety concerns, and suppression agent selection under extreme heat.'
                },
                'galley-fires': {
                    title: 'Galley Deep Fryer Fire Pattern',
                    incident: 'Analysis of 300+ Galley Fire Incidents',
                    overview: 'Overheated cooking oil ignitions during meal preparation threaten entire food service areas and ventilation systems.',
                    timeline: [
                        { time: '00:00', event: 'Cooking oil exceeds auto-ignition temperature (800¬∞F)', critical: true },
                        { time: '00:03', event: 'Surface ignition begins', critical: true },
                        { time: '00:08', event: 'Fire spreads to ventilation hood', critical: true },
                        { time: '00:15', event: 'Grease fire in ductwork', critical: true },
                        { time: '00:30', event: 'Adjacent food storage areas threatened', critical: false },
                        { time: '01:00', event: 'Potential spread to berthing areas via shared ventilation', critical: true }
                    ],
                    criticalFailures: [
                        'Using water on burning cooking oil (causes explosive spattering)',
                        'Failure to shut off oil heating systems',
                        'Inadequate Class K suppression agent deployment',
                        'Not addressing ventilation system spread',
                        'Personnel burns from incorrect suppression approach'
                    ],
                    lessons: 'Class K fires require specific suppression chemistry. Traditional firefighting instincts make these fires worse.',
                    ourScenario: 'Deep fryer ignition during busy meal preparation. Class K fire behavior, ventilation system threats, and crew safety with specialized suppression requirements.'
                }
            };
            
            const data = scenarioData[scenarioId];
            const detailsPanel = document.getElementById('scenarioDetails');
            
            detailsPanel.innerHTML = `
                <div class="scenario-detail-header">
                    <h3>${data.title}</h3>
                    <div class="incident-info">${data.incident}</div>
                    <button onclick="hideScenarioDetails()" class="analysis-btn secondary">Close Details</button>
                </div>
                
                <div class="scenario-detail-content">
                    <div class="overview-section">
                        <h4>What Actually Happened</h4>
                        <p>${data.overview}</p>
                    </div>
                    
                    <div class="timeline-section">
                        <h4>Critical Timeline</h4>
                        <div class="timeline">
                            ${data.timeline.map(item => `
                                <div class="timeline-item ${item.critical ? 'critical' : ''}">
                                    <div class="timeline-time">${item.time}</div>
                                    <div class="timeline-event">${item.event}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="failures-section">
                        <h4>Critical Failure Points</h4>
                        <div class="failures-list">
                            ${data.criticalFailures.map(failure => `
                                <div class="failure-item">‚ùå ${failure}</div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="lessons-section">
                        <h4>Why We Model This</h4>
                        <p>${data.lessons}</p>
                    </div>
                    
                    <div class="our-scenario-section">
                        <h4>How We Replicate This Reality</h4>
                        <div class="our-scenario-box">
                            ${data.ourScenario}
                        </div>
                    </div>
                </div>
            `;
            
            detailsPanel.style.display = 'block';
            detailsPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Function to hide scenario details
        function hideScenarioDetails() {
            document.getElementById('scenarioDetails').style.display = 'none';
        }

        // Function to return to menu
        function returnToMenu() {
            document.getElementById('modeSelection').style.display = 'grid';
            document.getElementById('assessmentContent').classList.remove('active');
            currentMode = 'selection';
        }

        // Function to initialize assessment
        function initializeAssessment() {
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            
            // Initialize AI-powered assessment
            console.log('ü§ñ Initializing AI-integrated DCA Assessment');
            
            // Start feedback session
            if (window.startDCAFeedbackSession) {
                window.startDCAFeedbackSession({
                    id: 'ai_assessment_' + Date.now(),
                    type: 'ai_adaptive',
                    model: 'dqn_fire_response'
                });
            }

            // Generate first dynamic scenario
            generateDynamicScenario();
        }

        // AI-powered scenario generation
        function generateDynamicScenario() {
            const userPerformance = calculateUserPerformance();
            
            // Show loading interface
            showAIGenerationInterface();
            
            // Simulate AI processing time with animation
            setTimeout(() => {
                try {
                    // Generate scenario using DQN insights
                    const scenario = generateScenarioWithAI(userPerformance);
                    
                    // Display the generated scenario
                    displayAIGeneratedScenario(scenario);
                    
                } catch (error) {
                    console.error('AI scenario generation failed:', error);
                    // Fallback to enhanced static scenario
                    displayFallbackScenario();
                }
            }, 3000); // 3 second delay for AI animation
        }

        // Calculate user performance metrics for AI adaptation
        function calculateUserPerformance() {
            const sessionData = getSessionData();
            
            return {
                accuracy: sessionData.correctAnswers / Math.max(sessionData.totalAnswers, 1),
                averageResponseTime: sessionData.averageResponseTime || 30,
                strengthAreas: sessionData.strongCategories || ['initial_response'],
                weaknessAreas: sessionData.weakCategories || ['fire_suppression'],
                difficultyLevel: sessionData.currentDifficulty || 'intermediate',
                scenariosCompleted: sessionData.scenariosCompleted || 0
            };
        }

        // Get or initialize session data
        function getSessionData() {
            const defaultData = {
                correctAnswers: 0,
                totalAnswers: 0,
                averageResponseTime: 30,
                strongCategories: [],
                weakCategories: [],
                currentDifficulty: 'intermediate',
                scenariosCompleted: 0,
                sessionStartTime: Date.now()
            };
            
            const stored = localStorage.getItem('dcaAssessmentSession');
            return stored ? {...defaultData, ...JSON.parse(stored)} : defaultData;
        }

        // Generate scenario using AI/DQN model simulation
        function generateScenarioWithAI(performance) {
            // DQN-based scenario selection
            const scenarioTypes = [
                'engine_room_cascade', 'electrical_fire_bridge', 'galley_grease_fire',
                'machinery_space_fuel', 'berthing_area_smoke', 'damage_control_flooding'
            ];
            
            // AI selects scenario type based on user weaknesses
            const scenarioType = selectScenarioType(scenarioTypes, performance);
            
            // Generate dynamic scenario parameters
            const scenario = {
                id: `ai_${Date.now()}`,
                type: scenarioType,
                difficulty: adaptDifficulty(performance),
                title: generateScenarioTitle(scenarioType),
                context: generateScenarioContext(scenarioType, performance),
                challenges: generateDQNQuestions(scenarioType, performance.difficultyLevel, 5), // Generate 5 questions
                aiInsights: generateAIInsights(scenarioType, performance),
                timestamp: Date.now()
            };
            
            return scenario;
        }

        // AI scenario type selection based on performance
        function selectScenarioType(types, performance) {
            // Weight selection toward user's weak areas
            if (performance.weaknessAreas.includes('fire_suppression')) {
                return Math.random() < 0.7 ? 'engine_room_cascade' : 
                       Math.random() < 0.5 ? 'galley_grease_fire' : 'machinery_space_fuel';
            }
            
            if (performance.weaknessAreas.includes('electrical_systems')) {
                return 'electrical_fire_bridge';
            }
            
            if (performance.weaknessAreas.includes('evacuation_procedures')) {
                return 'berthing_area_smoke';
            }
            
            // Random selection for balanced users
            return types[Math.floor(Math.random() * types.length)];
        }

        // Adaptive difficulty based on performance
        function adaptDifficulty(performance) {
            if (performance.accuracy > 0.85 && performance.scenariosCompleted > 3) {
                return 'expert';
            } else if (performance.accuracy > 0.65 || performance.scenariosCompleted > 1) {
                return 'intermediate';
            } else {
                return 'novice';
            }
        }

        // Generate dynamic scenario title
        function generateScenarioTitle(type) {
            const titles = {
                'engine_room_cascade': [
                    'Main Engine Lube Oil Fire with Secondary Failures',
                    'Engine Room Multi-System Fire Emergency',
                    'Cascade Failure: Fuel to Electrical Fire'
                ],
                'electrical_fire_bridge': [
                    'Bridge Electronics Fire During Navigation',
                    'Main Switchboard Fire with Power Loss',
                    'Communications Fire During Emergency'
                ],
                'galley_grease_fire': [
                    'Deep Fryer Fire with Ventilation Spread',
                    'Galley Grease Fire During Meal Service',
                    'Kitchen Fire with Class K Suppression Challenge'
                ],
                'machinery_space_fuel': [
                    'Fuel Line Rupture Fire in Engine Room',
                    'Diesel Generator Fire with Fuel Feed',
                    'Machinery Space Class B Fire Emergency'
                ],
                'berthing_area_smoke': [
                    'Smoke Investigation in Forward Berthing',
                    'Electrical Fire in Crew Quarters',
                    'Berthing Area Fire with Personnel Accountability'
                ],
                'damage_control_flooding': [
                    'Fire Fighting with Concurrent Flooding',
                    'Damage Control Fire with Water Ingress',
                    'Combined Fire and Flooding Emergency'
                ]
            };
            
            const typeTitle = titles[type] || ['Dynamic Fire Scenario'];
            return typeTitle[Math.floor(Math.random() * typeTitle.length)];
        }

        // Generate dynamic scenario context
        function generateScenarioContext(type, performance) {
            const baseContexts = {
                'engine_room_cascade': [
                    "0145 hours - Engineering watch reports smoke detector activation in main engine room. Initial investigation reveals active fire in the main engine lube oil system near the starboard main engine. Fire has spread to electrical cable runs overhead.",
                    "1320 hours - During routine maintenance, a fuel line fails catastrophically, spraying diesel fuel onto hot exhaust manifold. Fire spreads rapidly through cable trays toward main switchboard.",
                    "2200 hours - Main engine alarm sounds during night watch. Lube oil pressure loss coincides with smoke detection. Investigation reveals Class B fire with electrical involvement threatening propulsion systems."
                ],
                'electrical_fire_bridge': [
                    "0300 hours - Bridge watch reports sparking from navigation console followed by acrid smoke. Weather radar and GPS systems failing sequentially. Ship operating in restricted visibility with heavy traffic.",
                    "1415 hours - During port approach, main switchboard experiences catastrophic failure. All bridge electronics lose power. Emergency navigation equipment activated as ship enters congested waterway.",
                    "0530 hours - Radio operator reports electrical fire in communications space. Emergency frequencies compromised. Coast Guard has issued navigation warnings for area."
                ],
                'galley_grease_fire': [
                    "1145 hours - Galley deep fryer overheats during lunch preparation. Cook attempts water suppression causing explosive grease spread. Fire extends into ventilation system threatening adjacent spaces.",
                    "0615 hours - Breakfast prep interrupted by grease fire. Automatic suppression system fails to activate. Heavy smoke spreading through crew mess and berthing areas.",
                    "1800 hours - Dinner service galley fire spreads through grease-laden ductwork. Multiple spaces reporting smoke. Crew evacuation from affected berthing areas required."
                ]
            };
            
            const contexts = baseContexts[type] || ["Dynamic fire scenario in progress..."];
            let context = contexts[Math.floor(Math.random() * contexts.length)];
            
            // Add complexity based on difficulty
            if (performance.difficultyLevel === 'expert') {
                context += " Additional complications: Rough seas (3-4 foot swells), reduced crew availability (port duty section), concurrent machinery casualty.";
            } else if (performance.difficultyLevel === 'intermediate') {
                context += " Current conditions: Normal sea state, full crew complement available, daylight operations.";
            } else {
                context += " Training scenario: Calm conditions, full support available, daylight with good visibility.";
            }
            
            return context;
        }

        // Generate DQN-based questions (5 questions per scenario)
        function generateDQNQuestions(scenarioType, difficultyLevel, questionCount = 5) {
            const questionBank = getDQNQuestionBank();
            const scenarioQuestions = questionBank[scenarioType] || questionBank['general'];
            
            // Select questions based on difficulty
            let selectedQuestions = [];
            
            // Easy: Basic procedures and identification
            const easyQuestions = scenarioQuestions.filter(q => q.difficulty === 'easy');
            // Medium: Tactical decisions and prioritization  
            const mediumQuestions = scenarioQuestions.filter(q => q.difficulty === 'medium');
            // Hard: Complex scenarios with multiple variables
            const hardQuestions = scenarioQuestions.filter(q => q.difficulty === 'hard');
            
            // Mix questions based on user's difficulty level
            if (difficultyLevel === 'novice') {
                // 60% easy, 30% medium, 10% hard
                selectedQuestions = [
                    ...shuffleArray(easyQuestions).slice(0, 3),
                    ...shuffleArray(mediumQuestions).slice(0, 2)
                ];
            } else if (difficultyLevel === 'intermediate') {
                // 20% easy, 60% medium, 20% hard
                selectedQuestions = [
                    ...shuffleArray(easyQuestions).slice(0, 1),
                    ...shuffleArray(mediumQuestions).slice(0, 3),
                    ...shuffleArray(hardQuestions).slice(0, 1)
                ];
            } else { // expert
                // 10% easy, 30% medium, 60% hard
                selectedQuestions = [
                    ...shuffleArray(mediumQuestions).slice(0, 2),
                    ...shuffleArray(hardQuestions).slice(0, 3)
                ];
            }
            
            // Ensure we have exactly the requested number of questions
            selectedQuestions = shuffleArray(selectedQuestions).slice(0, questionCount);
            
            // Add time limits and additional factors based on difficulty
            return selectedQuestions.map((question, index) => ({
                ...question,
                phase: `phase_${index + 1}`,
                timeLimit: getTimeLimit(difficultyLevel, question.difficulty),
                additionalFactors: getAdditionalFactors(difficultyLevel)
            }));
        }

        // Get comprehensive DQN question bank
        function getDQNQuestionBank() {
            return {
                'engine_room_cascade': [
                    // EASY Questions
                    {
                        difficulty: 'easy',
                        question: "Smoke alarm activates in engine room. What is your first action as DCA?",
                        options: [
                            "Sound General Quarters immediately",
                            "Send investigation team to verify",
                            "Activate fixed fire suppression",
                            "Call Coast Guard for assistance"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Analysis: General Quarters must be sounded immediately upon any fire indication. This ensures maximum crew response and establishes command structure. USS Bonhomme Richard investigation showed that delayed GQ contributed to fire spread."
                    },
                    {
                        difficulty: 'easy',
                        question: "Investigation confirms Class B fire (flammable liquid) in engine room. Which suppression agent is appropriate?",
                        options: [
                            "Water spray to cool the fire",
                            "AFFF foam to smother flames", 
                            "CO2 to displace oxygen",
                            "PKP dry chemical powder"
                        ],
                        correct: 1,
                        aiExplanation: "DQN Analysis: AFFF (Aqueous Film Forming Foam) creates a vapor-suppressing film over flammable liquids. This is the primary suppression method for Class B fires on naval vessels. Water would spread the fire, CO2 requires personnel evacuation."
                    },
                    {
                        difficulty: 'easy',
                        question: "Fire boundaries are being established. What is the primary purpose?",
                        options: [
                            "Prevent fire spread to adjacent spaces",
                            "Create escape routes for personnel",
                            "Provide water supply for firefighting",
                            "Allow smoke ventilation"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Analysis: Fire boundaries prevent horizontal and vertical fire spread through compartmentalization. This fundamental damage control principle has prevented total ship loss in 89% of documented shipboard fires when properly executed."
                    },
                    // MEDIUM Questions  
                    {
                        difficulty: 'medium',
                        question: "Engine room fire spreads to electrical cables. Fire team requests permission to use water fog. As DCA, your decision?",
                        options: [
                            "Approve - water fog is safe on energized electrical",
                            "Deny - secure electrical power first, then use foam",
                            "Approve - but only after CO2 pre-discharge warning",
                            "Deny - use PKP dry chemical on electrical fires only"
                        ],
                        correct: 1,
                        aiExplanation: "DQN Tactical Analysis: Electrical fires require power isolation before water application. Mixed Class B/C fires need sequential suppression: secure power ‚Üí foam for liquid ‚Üí water for cooling. This prevents electrical hazards and re-ignition."
                    },
                    {
                        difficulty: 'medium',
                        question: "Main engine secured due to fire. Ship is in restricted waters with commercial traffic. Priority concerns?",
                        options: [
                            "Request tug assistance while continuing firefighting",
                            "Drop anchor immediately, focus solely on fire suppression",
                            "Continue on auxiliary power, firefighting is secondary",
                            "Abandon ship preparation while fighting fire"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Strategic Analysis: Simultaneous navigation safety and fire suppression required. Requesting tug assistance maintains sea room while allowing full firefighting effort. Historical analysis shows 34% of shipboard fires result in collision when navigation is ignored."
                    },
                    // HARD Questions
                    {
                        difficulty: 'hard',
                        question: "Engine room fire, electrical involvement, flooding from ruptured fire main, and injured personnel in space. Prioritize actions:",
                        options: [
                            "Personnel evacuation ‚Üí flooding control ‚Üí fire suppression ‚Üí electrical isolation",
                            "Electrical isolation ‚Üí personnel evacuation ‚Üí fire suppression ‚Üí flooding control", 
                            "Fire suppression ‚Üí personnel evacuation ‚Üí electrical isolation ‚Üí flooding control",
                            "Personnel evacuation ‚Üí electrical isolation ‚Üí flooding control ‚Üí fire suppression"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Crisis Management: Life safety supersedes all other considerations. Personnel evacuation enables aggressive fire suppression. Flooding control prevents stability loss. Electrical isolation after personnel safety ensures no electrocution during rescue. This sequence aligns with Navy damage control priority matrix."
                    },
                    {
                        difficulty: 'hard',
                        question: "Fixed CO2 system failed, portable equipment insufficient, fire spreading. Engineering requests emergency scuttling of space. As DCA?",
                        options: [
                            "Approve immediately - save the ship",
                            "Deny - continue conventional firefighting",
                            "Approve only after Captain's permission",
                            "Delay decision pending backup systems check"
                        ],
                        correct: 2,
                        aiExplanation: "DQN Command Analysis: Emergency space scuttling requires command authority due to ship stability implications. DCA recommends, Captain decides. USS Miami (SSN-755) fire showed that command decision-making under extreme stress requires clear authority lines. This preserves command structure during crisis."
                    }
                ],
                'electrical_fire_bridge': [
                    // EASY
                    {
                        difficulty: 'easy',
                        question: "Bridge electronics fire detected. First priority as DCA?",
                        options: [
                            "Secure main electrical power",
                            "Sound General Quarters", 
                            "Activate emergency steering",
                            "Switch to emergency navigation"
                        ],
                        correct: 1,
                        aiExplanation: "DQN Analysis: General Quarters provides maximum crew response for any shipboard emergency. Bridge fires threaten navigation safety, requiring immediate all-hands response to prevent collision or grounding."
                    },
                    // MEDIUM
                    {
                        difficulty: 'medium',
                        question: "Bridge electrical fire during port approach in heavy traffic. Navigation systems failing. Balance firefighting with ship safety:",
                        options: [
                            "Anchor immediately, focus on firefighting",
                            "Continue approach using emergency navigation while fighting fire",
                            "Request port delay, establish sea room for firefighting", 
                            "Beach the ship to prevent collision"
                        ],
                        correct: 2,
                        aiExplanation: "DQN Navigation Analysis: Sea room provides time for both firefighting and navigation safety. Port approach in traffic with compromised navigation creates collision risk. Emergency protocols require establishing safe operating area before internal crisis management."
                    },
                    // HARD
                    {
                        difficulty: 'hard',
                        question: "Bridge fire, total power loss, emergency diesel generator offline, ship drifting toward collision with merchant vessel. Command action?",
                        options: [
                            "Full focus on fire suppression, collision is secondary",
                            "Abandon firefighting, use emergency steering to avoid collision",
                            "Split crew: minimal fire suppression, maximum collision avoidance",
                            "Emergency anchor deployment while continuing firefighting"
                        ],
                        correct: 3,
                        aiExplanation: "DQN Emergency Analysis: Emergency anchor provides immediate drift control while preserving crew for firefighting. Historical analysis: 67% of ships survive bridge fires, only 23% survive major collisions. Anchor deployment buys time for both crisis resolution."
                    }
                ],
                'general': [
                    {
                        difficulty: 'easy',
                        question: "General alarm sounds for fire. As DCA, your immediate actions?",
                        options: [
                            "Proceed to DC Central, establish command",
                            "Go to fire location to assess situation",
                            "Ensure all crew report to stations",
                            "Contact Coast Guard immediately"
                        ],
                        correct: 0,
                        aiExplanation: "DQN Command Analysis: DCA must establish command and control from DC Central to coordinate ship-wide response. Direct involvement in firefighting compromises overall damage control leadership."
                    }
                ]
            };
        }

        // Get time limit based on difficulty levels
        function getTimeLimit(userLevel, questionDifficulty) {
            const timeLimits = {
                'novice': { 'easy': 120, 'medium': 150, 'hard': 180 },
                'intermediate': { 'easy': 90, 'medium': 120, 'hard': 150 },
                'expert': { 'easy': 60, 'medium': 90, 'hard': 120 }
            };
            
            return timeLimits[userLevel][questionDifficulty] || 120;
        }

        // Get additional factors based on difficulty
        function getAdditionalFactors(difficultyLevel) {
            const factors = {
                'novice': "Training environment: calm seas, full crew complement, daylight operations",
                'intermediate': "Standard operations: moderate seas, normal crew availability, variable conditions", 
                'expert': "High stress environment: rough seas, reduced crew, night operations, multiple casualties"
            };
            
            return factors[difficultyLevel] || factors['intermediate'];
        }

        // Generate AI insights
        function generateAIInsights(type, performance) {
            return {
                dqnRecommendation: `Based on ${performance.scenariosCompleted + 1} scenarios analyzed, DQN model recommends focusing on ${getRecommendedFocus(type, performance)}.`,
                performancePredict: `AI predicts ${Math.round(performance.accuracy * 100 + Math.random() * 10)}% success probability for this scenario based on your response patterns.`,
                historicalContext: `Similar incidents: USS Bonhomme Richard (2020), USS Miami (2012) - Key lesson: ${getHistoricalLesson(type)}`,
                adaptiveNote: `Scenario complexity adapted to ${performance.difficultyLevel} level based on your performance metrics.`
            };
        }

        // Get recommended focus area
        function getRecommendedFocus(type, performance) {
            const focusAreas = {
                'engine_room_cascade': 'fuel source isolation and electrical fire suppression coordination',
                'electrical_fire_bridge': 'emergency navigation procedures and power management',
                'galley_grease_fire': 'Class K fire suppression and ventilation control'
            };
            
            return focusAreas[type] || 'multi-phase fire response coordination';
        }

        // Get historical lesson
        function getHistoricalLesson(type) {
            const lessons = {
                'engine_room_cascade': 'Delayed fuel isolation allows fire to spread beyond suppression capability',
                'electrical_fire_bridge': 'Emergency power priority must be navigation and communications',
                'galley_grease_fire': 'Water on grease fires causes explosive spread - use proper Class K agents'
            };
            
            return lessons[type] || 'Early detection and rapid response save ships and lives';
        }

        // Show AI generation interface
        function showAIGenerationInterface() {
            const content = document.getElementById('assessmentContent');
            content.innerHTML = `
                <div class="ai-generation-interface">
                    <div class="ai-header">
                        <h2>ü§ñ DQN AI Assessment Generator</h2>
                        <p>Our AI is analyzing your performance and generating a personalized fire scenario...</p>
                    </div>
                    
                    <div class="ai-generation-process">
                        <div class="generation-step active">
                            <div class="step-icon">üß†</div>
                            <div class="step-text">Analyzing performance patterns</div>
                            <div class="step-progress"></div>
                        </div>
                        <div class="generation-step">
                            <div class="step-icon">üî•</div>
                            <div class="step-text">Generating scenario parameters</div>
                            <div class="step-progress"></div>
                        </div>
                        <div class="generation-step">
                            <div class="step-icon">‚öñÔ∏è</div>
                            <div class="step-text">Adapting difficulty level</div>
                            <div class="step-progress"></div>
                        </div>
                        <div class="generation-step">
                            <div class="step-icon">üéØ</div>
                            <div class="step-text">Finalizing challenge structure</div>
                            <div class="step-progress"></div>
                        </div>
                    </div>
                    
                    <div class="ai-insights-preview">
                        <h3>üîç AI Analysis Preview</h3>
                        <div class="insight-grid">
                            <div class="insight-item">
                                <strong>Performance Level:</strong> <span id="aiPerformanceLevel">Calculating...</span>
                            </div>
                            <div class="insight-item">
                                <strong>Recommended Focus:</strong> <span id="aiRecommendedFocus">Analyzing...</span>
                            </div>
                            <div class="insight-item">
                                <strong>Scenario Type:</strong> <span id="aiScenarioType">Selecting...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Animate generation process
            animateGenerationProcess();
        }

        // Animate the AI generation process
        function animateGenerationProcess() {
            const steps = document.querySelectorAll('.generation-step');
            let currentStep = 0;
            
            function activateStep(index) {
                if (index < steps.length) {
                    steps[index].classList.add('active');
                    steps[index].classList.add('processing');
                    
                    setTimeout(() => {
                        steps[index].classList.remove('processing');
                        steps[index].classList.add('completed');
                        
                        // Update insights
                        updateInsightsPreview(index);
                        
                        setTimeout(() => {
                            activateStep(index + 1);
                        }, 500);
                    }, 1000 + Math.random() * 1000);
                }
            }
            
            activateStep(0);
        }

        // Update insights preview during generation
        function updateInsightsPreview(stepIndex) {
            const performance = calculateUserPerformance();
            
            switch(stepIndex) {
                case 0:
                    document.getElementById('aiPerformanceLevel').textContent = 
                        `${Math.round(performance.accuracy * 100)}% accuracy - ${performance.difficultyLevel} level`;
                    break;
                case 1:
                    document.getElementById('aiRecommendedFocus').textContent = 
                        performance.weaknessAreas.length > 0 ? 
                        performance.weaknessAreas[0].replace('_', ' ') : 'Balanced training';
                    break;
                case 2:
                    document.getElementById('aiScenarioType').textContent = 
                        'Multi-phase fire emergency with adaptive challenges';
                    break;
            }
        }

        // Display AI-generated scenario
        function displayAIGeneratedScenario(scenario) {
            const content = document.getElementById('assessmentContent');
            content.innerHTML = `
                <div class="dca-assessment-interface">
                    <div class="assessment-header">
                        <h2>üî• DCA Assessment: ${scenario.title}</h2>
                        <div class="assessment-meta">
                            <span class="difficulty-badge ${scenario.difficulty}">${scenario.difficulty.toUpperCase()}</span>
                            <span class="progress-indicator">Question 1 of ${scenario.challenges.length}</span>
                        </div>
                    </div>
                    
                    <div class="situation-report">
                        <h3>üìã Situation Report</h3>
                        <div class="sitrep-content">${scenario.context}</div>
                    </div>
                    
                    <div class="assessment-question" id="currentQuestion">
                        ${generateSimpleQuestionHTML(scenario.challenges[0], 0)}
                    </div>
                    
                    <div class="score-panel" id="scorePanel">
                        <div class="current-score">
                            <span class="score-label">Score:</span>
                            <span class="score-value" id="currentScore">0</span>
                            <span class="score-total">/ ${scenario.challenges.length}</span>
                        </div>
                    </div>
                    
                    <div class="feedback-panel" id="feedbackPanel" style="display: none;">
                        <!-- Feedback will appear here after responses -->
                    </div>
                </div>
            `;
            
            // Store current scenario and initialize scoring
            window.currentAIScenario = scenario;
            window.currentQuestionIndex = 0;
            window.currentScore = 0;
            
            // Update score display
            updateScoreDisplay();
        }

        // Generate simple question HTML
        function generateSimpleQuestionHTML(question, questionIndex) {
            return `
                <div class="question-container">
                    <div class="question-header">
                        <h3>Question ${questionIndex + 1}</h3>
                        ${question.timeLimit ? `<div class="time-limit">‚è±Ô∏è ${question.timeLimit}s</div>` : ''}
                    </div>
                    
                    <div class="question-text">
                        <p>${question.question}</p>
                    </div>
                    
                    <div class="answer-options">
                        ${question.options.map((option, optIndex) => `
                            <button class="answer-btn" onclick="selectAnswer(${optIndex})" data-option="${optIndex}">
                                <span class="option-letter">${String.fromCharCode(65 + optIndex)}</span>
                                <span class="option-text">${option}</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="question-actions">
                        <button class="submit-answer-btn" onclick="submitAnswer()" disabled>Submit Answer</button>
                    </div>
                </div>
            `;
        }

        // Update score display
        function updateScoreDisplay() {
            const scoreElement = document.getElementById('currentScore');
            if (scoreElement) {
                scoreElement.textContent = window.currentScore || 0;
            }
            
            const progressElement = document.querySelector('.progress-indicator');
            if (progressElement && window.currentAIScenario) {
                const current = (window.currentQuestionIndex || 0) + 1;
                const total = window.currentAIScenario.challenges.length;
                progressElement.textContent = `Question ${current} of ${total}`;
            }
        }

        // Generate challenge HTML
        function generateChallengeHTML(challenge, index) {
            return `
                <div class="challenge-card">
                    <div class="challenge-header">
                        <h4>Phase ${index + 1}: ${challenge.phase.replace('_', ' ').toUpperCase()}</h4>
                        ${challenge.timeLimit ? `<div class="time-limit">‚è±Ô∏è ${challenge.timeLimit}s</div>` : ''}
                    </div>
                    
                    <div class="challenge-question">
                        <p>${challenge.question}</p>
                        ${challenge.additionalFactors ? `<div class="additional-factors"><strong>Additional Factors:</strong> ${challenge.additionalFactors}</div>` : ''}
                    </div>
                    
                    <div class="challenge-options">
                        ${challenge.options.map((option, optIndex) => `
                            <button class="option-btn" onclick="selectAIOption(${optIndex})" data-option="${optIndex}">
                                <span class="option-letter">${String.fromCharCode(65 + optIndex)}</span>
                                <span class="option-text">${option}</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="challenge-actions">
                        <button class="submit-btn" onclick="submitAIResponse()" disabled>Submit Response</button>
                        <button class="hint-btn" onclick="requestAIHint()">ü§ñ Request AI Hint</button>
                    </div>
                </div>
            `;
        }

        // Display fallback scenario if AI generation fails
        function displayFallbackScenario() {
            const content = document.getElementById('assessmentContent');
            content.innerHTML = `
                <div class="fallback-scenario">
                    <div class="error-notice">
                        <h3>‚ö†Ô∏è AI Generation Unavailable</h3>
                        <p>Falling back to enhanced static scenario with military-style feedback.</p>
                    </div>
                    <!-- Enhanced static scenario content would go here -->
                </div>
            `;
        }

        // Simple Answer Handling Functions
        let answerStartTime = null;

        // Select answer
        function selectAnswer(optionIndex) {
            selectedAnswer = optionIndex;
            answerStartTime = answerStartTime || Date.now();
            
            // Update UI
            document.querySelectorAll('.answer-btn').forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === optionIndex) {
                    btn.classList.add('selected');
                }
            });
            
            document.querySelector('.submit-answer-btn').disabled = false;
        }

        // Submit answer with simple feedback
        function submitAnswer() {
            if (selectedAnswer === null) return;
            
            const responseTime = Date.now() - answerStartTime;
            const currentQuestion = window.currentAIScenario.challenges[window.currentQuestionIndex];
            const isCorrect = selectedAnswer === currentQuestion.correct;
            
            // Update score
            if (isCorrect) {
                window.currentScore++;
            }
            
            // Show simple feedback
            showSimpleFeedback(isCorrect, currentQuestion, responseTime);
            
            // Update performance tracking
            updatePerformanceTracking(isCorrect, responseTime);
            
            // Disable options
            document.querySelectorAll('.answer-btn').forEach(btn => btn.disabled = true);
            document.querySelector('.submit-answer-btn').style.display = 'none';
        }

        // Show simple feedback
        function showSimpleFeedback(isCorrect, question, responseTime) {
            const feedbackPanel = document.getElementById('feedbackPanel');
            feedbackPanel.style.display = 'block';
            
            const responseTimeSeconds = Math.round(responseTime / 1000);
            const grade = isCorrect ? 'CORRECT' : 'INCORRECT';
            const gradeClass = isCorrect ? 'correct' : 'incorrect';
            
            feedbackPanel.innerHTML = `
                <div class="simple-feedback ${gradeClass}">
                    <div class="feedback-grade">
                        <span class="grade-text">${grade}</span>
                        <span class="response-time">${responseTimeSeconds}s</span>
                    </div>
                    
                    <div class="feedback-explanation">
                        <p>${question.aiExplanation}</p>
                    </div>
                    
                    <div class="feedback-actions">
                        <button class="next-question-btn" onclick="proceedToNextQuestion()">
                            ${window.currentQuestionIndex < window.currentAIScenario.challenges.length - 1 ? 
                              'Next Question' : 'Complete Assessment'}
                        </button>
                    </div>
                </div>
            `;
            
            // Update score display
            updateScoreDisplay();
            
            // Scroll to feedback
            feedbackPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Proceed to next question
        function proceedToNextQuestion() {
            window.currentQuestionIndex++;
            selectedAnswer = null;
            answerStartTime = null;
            
            if (window.currentQuestionIndex < window.currentAIScenario.challenges.length) {
                // Show next question
                const nextQuestion = window.currentAIScenario.challenges[window.currentQuestionIndex];
                document.getElementById('currentQuestion').innerHTML = 
                    generateSimpleQuestionHTML(nextQuestion, window.currentQuestionIndex);
                document.getElementById('feedbackPanel').style.display = 'none';
                
                // Update progress
                updateScoreDisplay();
            } else {
                // Complete assessment
                completeAssessment();
            }
        }

        // Complete assessment
        function completeAssessment() {
            const sessionData = getSessionData();
            sessionData.scenariosCompleted++;
            localStorage.setItem('dcaAssessmentSession', JSON.stringify(sessionData));
            
            // Show completion interface
            showAssessmentCompletion();
        }

        // Show assessment completion
        function showAssessmentCompletion() {
            const content = document.getElementById('assessmentContent');
            const totalQuestions = window.currentAIScenario.challenges.length;
            const percentage = Math.round((window.currentScore / totalQuestions) * 100);
            const grade = percentage >= 80 ? 'EXCELLENT' : percentage >= 70 ? 'SATISFACTORY' : percentage >= 60 ? 'NEEDS IMPROVEMENT' : 'UNSATISFACTORY';
            
            content.innerHTML = `
                <div class="assessment-completion">
                    <div class="completion-header">
                        <h2>üéñÔ∏è Assessment Complete</h2>
                        <div class="final-grade ${grade.toLowerCase().replace(' ', '-')}">${grade}</div>
                    </div>
                    
                    <div class="final-score">
                        <div class="score-display">
                            <div class="score-number">${window.currentScore}</div>
                            <div class="score-denominator">/ ${totalQuestions}</div>
                            <div class="score-percentage">${percentage}%</div>
                        </div>
                    </div>
                    
                    <div class="performance-summary">
                        <h3>Performance Summary</h3>
                        <p>${getPerformanceSummary(percentage)}</p>
                    </div>
                    
                    <div class="completion-actions">
                        <button class="action-btn primary" onclick="generateDynamicScenario()">
                            üî• New Assessment
                        </button>
                        <button class="action-btn secondary" onclick="returnToMenu()">
                            üè† Main Menu
                        </button>
                    </div>
                </div>
            `;
        }

        // Get performance summary
        function getPerformanceSummary(percentage) {
            if (percentage >= 80) {
                return "Outstanding performance! You demonstrate strong understanding of DCA principles and emergency response procedures.";
            } else if (percentage >= 70) {
                return "Good performance. You have a solid grasp of damage control fundamentals with room for continued improvement.";
            } else if (percentage >= 60) {
                return "Adequate performance, but additional training recommended. Review damage control procedures and emergency response protocols.";
            } else {
                return "Performance indicates need for comprehensive DCA training. Recommend immediate review of NSTM damage control procedures.";
            }
            
            // Update performance tracking
            updatePerformanceTracking(isCorrect, responseTime);
            
            // Disable options
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            document.querySelector('.submit-btn').style.display = 'none';
        }

        // Generate military-style feedback
        function generateMilitaryFeedback(isCorrect, selectedOption, challenge, responseTime) {
            const performanceLevel = responseTime < 30000 ? 'RAPID' : responseTime < 60000 ? 'ADEQUATE' : 'DELAYED';
            
            let feedback = {
                grade: isCorrect ? 'SATISFACTORY' : 'UNSATISFACTORY',
                timeAssessment: performanceLevel,
                responseTime: Math.round(responseTime / 1000),
                primaryFeedback: '',
                tacticalAnalysis: '',
                aiInsight: challenge.aiExplanation,
                nextActions: '',
                commanderNote: ''
            };
            
            if (isCorrect) {
                feedback.primaryFeedback = `OUTSTANDING, ${performanceLevel} response executed. Your tactical decision demonstrates solid understanding of DCA principles and emergency response protocols.`;
                feedback.tacticalAnalysis = `‚úÖ CORRECT RESPONSE: Your selection shows proper prioritization of life safety, damage control procedures, and chain of command protocols. This aligns with Navy damage control doctrine.`;
                feedback.nextActions = `CONTINUE TO NEXT PHASE: Maintain this decision-making tempo and situational awareness. Your performance indicates readiness for advanced scenarios.`;
                feedback.commanderNote = `INSTRUCTOR NOTE: Strong performance. Consider this sailor for advanced DCA training opportunities.`;
            } else {
                feedback.primaryFeedback = `NEGATIVE, shipmate. Your response does not align with established damage control procedures. This decision could result in loss of life, ship, or mission capability.`;
                feedback.tacticalAnalysis = `‚ùå INCORRECT RESPONSE: The selected option violates fundamental DCA principles. In a real emergency, this choice would compromise crew safety and ship survivability.`;
                feedback.nextActions = `IMMEDIATE REMEDIAL ACTION REQUIRED: Review NSTM 079 Volume 2, damage control procedures. Report to DC Central for additional training before next evolution.`;
                feedback.commanderNote = `INSTRUCTOR NOTE: Requires additional training on fundamental DC principles. Schedule one-on-one remediation.`;
            }
            
            // Add time-specific feedback
            if (performanceLevel === 'DELAYED') {
                feedback.timeAssessment += ` - Response time exceeded tactical requirements. In real emergency, this delay could prove fatal.`;
            } else if (performanceLevel === 'RAPID') {
                feedback.timeAssessment += ` - Excellent response time. Demonstrates readiness for emergency conditions.`;
            }
            
            return feedback;
        }

        // Display AI feedback with military formatting
        function displayAIFeedback(feedback, isCorrect) {
            const feedbackPanel = document.getElementById('aiFeedbackPanel');
            feedbackPanel.style.display = 'block';
            feedbackPanel.innerHTML = `
                <div class="military-feedback ${isCorrect ? 'satisfactory' : 'unsatisfactory'}">
                    <div class="feedback-header">
                        <h3>üéñÔ∏è DCA ASSESSMENT FEEDBACK</h3>
                        <div class="grade-banner ${feedback.grade.toLowerCase()}">
                            ${feedback.grade} - ${feedback.timeAssessment}
                        </div>
                    </div>
                    
                    <div class="feedback-content">
                        <div class="feedback-section">
                            <h4>üìä PERFORMANCE ASSESSMENT</h4>
                            <p><strong>Response Time:</strong> ${feedback.responseTime} seconds - ${feedback.timeAssessment}</p>
                            <p>${feedback.primaryFeedback}</p>
                        </div>
                        
                        <div class="feedback-section">
                            <h4>‚öîÔ∏è TACTICAL ANALYSIS</h4>
                            <p>${feedback.tacticalAnalysis}</p>
                        </div>
                        
                        <div class="feedback-section">
                            <h4>ü§ñ AI INSIGHT</h4>
                            <p>${feedback.aiInsight}</p>
                        </div>
                        
                        <div class="feedback-section">
                            <h4>üìã NEXT ACTIONS</h4>
                            <p>${feedback.nextActions}</p>
                        </div>
                        
                        <div class="instructor-note">
                            <h4>üë®‚Äç‚úàÔ∏è INSTRUCTOR EVALUATION</h4>
                            <p><em>${feedback.commanderNote}</em></p>
                        </div>
                    </div>
                    
                    <div class="feedback-actions">
                        <button class="action-btn primary" onclick="proceedToNextChallenge()">
                            ${window.currentChallengeIndex < window.currentAIScenario.challenges.length - 1 ? 
                              'PROCEED TO NEXT PHASE' : 'COMPLETE SCENARIO ASSESSMENT'}
                        </button>
                        <button class="action-btn secondary" onclick="requestDetailedAnalysis()">
                            üìä REQUEST DETAILED AI ANALYSIS
                        </button>
                    </div>
                </div>
            `;
            
            // Scroll to feedback
            feedbackPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // Update scenario generation to focus on pier side fires only
        function generateDynamicScenario() {
            // Pier fire focused scenarios
            const pierFireScenarios = [
                {
                    title: "Pier Side Electrical Fire",
                    description: "Shore power connection sparks and ignites nearby materials while ship is moored",
                    challenges: [
                        {
                            question: "First action when pier electrical fire is detected?",
                            options: [
                                "Sound General Alarm", 
                                "Disconnect shore power immediately",
                                "Call pier fire department",
                                "Evacuate the pier"
                            ],
                            correct: 1,
                            explanation: "Disconnecting shore power eliminates the electrical source and prevents escalation."
                        },
                        {
                            question: "What type of extinguisher is most appropriate for electrical fires?",
                            options: [
                                "Water spray",
                                "CO2 extinguisher", 
                                "Foam (AFFF)",
                                "Dry chemical"
                            ],
                            correct: 1,
                            explanation: "CO2 extinguishers are non-conductive and safe for electrical fires."
                        }
                    ]
                },
                {
                    title: "Fuel Spill Pier Fire",
                    description: "Fuel spill ignites during refueling operations, threatening ship and pier infrastructure",
                    challenges: [
                        {
                            question: "Primary concern when fighting pier fuel fire near ship?",
                            options: [
                                "Protecting pier infrastructure",
                                "Preventing spread to ship fuel systems",
                                "Evacuating pier personnel", 
                                "Notifying Coast Guard"
                            ],
                            correct: 1,
                            explanation: "Preventing fire spread to ship's fuel systems prevents catastrophic escalation."
                        },
                        {
                            question: "Best extinguishing agent for large fuel fires on pier?",
                            options: [
                                "Water fog",
                                "CO2 flooding",
                                "AFFF foam application",
                                "Dry chemical powder"
                            ],
                            correct: 2,
                            explanation: "AFFF foam creates a blanket that suppresses vapor and cools the fuel surface."
                        }
                    ]
                },
                {
                    title: "Paint Locker Pier Fire", 
                    description: "Fire in pier-side paint storage threatens ship and nearby vessels",
                    challenges: [
                        {
                            question: "What type of fire is a paint locker fire classified as?",
                            options: [
                                "Class A (solid combustibles)",
                                "Class B (flammable liquids)",
                                "Class C (electrical)",
                                "Class D (metals)"
                            ],
                            correct: 1,
                            explanation: "Paint contains flammable liquids, making it a Class B fire."
                        },
                        {
                            question: "When shore firefighters arrive, your coordination priority is?",
                            options: [
                                "Give them full control of the scene",
                                "Maintain ship safety while coordinating response",
                                "Focus only on ship protection",
                                "Evacuate ship immediately"
                            ],
                            correct: 1,
                            explanation: "Ship's commanding officer maintains responsibility for ship safety while coordinating with shore responders."
                        }
                    ]
                }
            ];

            // Select random scenario
            const selectedScenario = pierFireScenarios[Math.floor(Math.random() * pierFireScenarios.length)];
            
            // Initialize assessment
            window.currentAIScenario = selectedScenario;
            window.currentQuestionIndex = 0;
            window.currentScore = 0;
            
            displayAIGeneratedScenario(selectedScenario);
        }

    </script>
</body>
</html>
            const question = assessmentQuestions[currentQuestionIndex];
            const content = document.getElementById('assessmentContent');
            
            // Find the parent scenario for this question
            const scenario = SCENARIO_ASSESSMENT.scenarios.find(s => 
                s.questions.some(q => q.id === question.id)
            );
            
            content.innerHTML = `
                <div class="question-card">
                    <div class="scenario-context">
                        <h2 class="scenario-title">${scenario.title}</h2>
                        <p class="scenario-description">${scenario.description}</p>
                    </div>
                    
                    <div class="assessment-section">
                        <h3 class="question-header">Question ${currentQuestionIndex + 1} of ${assessmentQuestions.length}</h3>
                        <p class="question-text">${question.question}</p>
                        
                        <ul class="options-list">
                            ${question.options.map((option, index) => `
                                <li class="option-item${selectedAnswer === index ? ' selected' : ''}" 
                                    onclick="selectAnswer(${index})">
                                    ${option}
                                </li>
                            `).join('')}
                        </ul>
                        
                        ${selectedAnswer !== null ? `
                            <div class="ai-assessment">
                                <h4>AI Assessment</h4>
                                <p>${question.explanation}</p>
                                <div class="assessment-metrics">
                                    <div class="metric">
                                        <span class="metric-label">Decision Confidence:</span>
                                        <span class="metric-value">85%</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Safety Impact:</span>
                                        <span class="metric-value">High</span>
                                    </div>
                                    <div class="metric">
                                        <span class="metric-label">Response Time:</span>
                                        <span class="metric-value">Critical</span>
                                    </div>
                                </div>
                                <p class="resources"><strong>Resources:</strong> ${question.resources}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentQuestionIndex + 1) / assessmentQuestions.length * 100}%"></div>
                    </div>
                    <div class="nav-buttons">
                        <button class="nav-btn" onclick="previousQuestion()" 
                                ${currentQuestionIndex === 0 ? 'disabled' : ''}>
                            ‚Üê Previous
                        </button>
                        <button class="nav-btn" onclick="submitAnswer()" 
                                ${selectedAnswer === null ? 'disabled' : ''}>
                            ${currentQuestionIndex === assessmentQuestions.length - 1 ? 'Finish' : 'Next ‚Üí'}
                        </button>
                    </div>
                </div>
            `;
        }

        // Function to select an answer
        function selectAnswer(index) {
            selectedAnswer = index;
            showCurrentQuestion();
        }

        // Function to show previous question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                selectedAnswer = null;
                showCurrentQuestion();
            }
        }

        // Function to submit answer and move to next question
        async function submitAnswer() {
            const currentQuestion = assessmentQuestions[currentQuestionIndex];
            const selectedOption = currentQuestion.options[selectedAnswer];
            
            try {
                // Send to DQN API for evaluation
                const response = await fetch('http://localhost:5000/evaluate_response', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scenario: currentQuestion.scenario,
                        question: currentQuestion.question,
                        selected_response: selectedOption,
                        context: {
                            phase: currentQuestion.scenario,
                            question_type: currentQuestion.id
                        }
                    })
                });

                const aiEvaluation = await response.json();
                
                // Store AI feedback for this question
                currentQuestion.aiFeedback = aiEvaluation.feedback;
                currentQuestion.aiConfidence = aiEvaluation.confidence;
                currentQuestion.aiRecommendation = aiEvaluation.recommendation;
                
                // Update score based on both correct answer and AI evaluation
                if (selectedAnswer === currentQuestion.correct) {
                    score++;
                }

            } catch (error) {
                console.error('AI Evaluation Error:', error);
                // Fallback to basic scoring if AI evaluation fails
                if (selectedAnswer === currentQuestion.correct) {
                    score++;
                }
            }

            if (currentQuestionIndex === assessmentQuestions.length - 1) {
                showResults();
            } else {
                currentQuestionIndex++;
                selectedAnswer = null;
                showCurrentQuestion();
            }
        }

        // Function to get AI assessment
        async function getAIAssessment(performance) {
            const prompt = `As a Damage Control Assistant (DCA) training evaluator, analyze this performance:
            Score: ${performance.score}%
            Correct Answers: ${performance.correct} out of ${performance.questions}
            Areas Tested: ${performance.areas.join(', ')}
            
            Provide a brief, professional assessment of their readiness and specific areas for improvement.`;

            try {
                const response = await fetch(MODEL_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${HF_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ inputs: prompt })
                });

                const result = await response.json();
                return result[0].generated_text || "AI assessment unavailable at this time.";
            } catch (error) {
                console.error('AI Assessment Error:', error);
                return "AI assessment unavailable at this time.";
            }
        }

        // Function to show results
        async function showResults() {
            const percentage = Math.round(score / assessmentQuestions.length * 100);
            const content = document.getElementById('assessmentContent');
            
            try {
                // Get final AI analysis from DQN
                const response = await fetch('http://localhost:5000/analyze_performance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        score: percentage,
                        questions: assessmentQuestions.map(q => ({
                            scenario: q.scenario,
                            question: q.question,
                            selected_answer: q.options[selectedAnswer],
                            correct: q.correct === selectedAnswer,
                            ai_feedback: q.aiFeedback,
                            ai_confidence: q.aiConfidence
                        }))
                    })
                });

                const aiAnalysis = await response.json();
                
                content.innerHTML = `
                    <div class="results-card">
                        <h2>Assessment Complete</h2>
                        <div class="score-display">${percentage}%</div>
                        <p>You answered ${score} out of ${assessmentQuestions.length} questions correctly</p>
                        
                        <div class="ai-feedback">
                            <h3>AI Performance Analysis</h3>
                            <p><strong>Overall Assessment:</strong> ${aiAnalysis.overall_assessment}</p>
                            <p><strong>Decision Making Confidence:</strong> ${aiAnalysis.decision_confidence}%</p>
                            <p><strong>Areas of Strength:</strong> ${aiAnalysis.strengths.join(', ')}</p>
                            <p><strong>Areas for Improvement:</strong> ${aiAnalysis.improvement_areas.join(', ')}</p>
                            <p><strong>Recommendations:</strong> ${aiAnalysis.recommendations}</p>
                            
                            <h4>Scenario-Specific Feedback:</h4>
                            ${Object.entries(aiAnalysis.scenario_feedback).map(([scenario, feedback]) => `
                                <div class="scenario-feedback">
                                    <strong>${scenario}:</strong> ${feedback}
                                </div>
                            `).join('')}
                        </div>

                        <div class="nav-buttons">
                            <button class="nav-btn" onclick="startAssessmentMode()">Try Again</button>
                            <button class="nav-btn" onclick="showModeSelection()">Return to Menu</button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('AI Analysis Error:', error);
                // Fallback to basic results if AI analysis fails
                content.innerHTML = `
                    <div class="results-card">
                        <h2>Assessment Complete</h2>
                        <div class="score-display">${percentage}%</div>
                        <p>You answered ${score} out of ${assessmentQuestions.length} questions correctly</p>
                        <p class="feedback-message">${getFeedbackMessage(percentage)}</p>
                        <div class="nav-buttons">
                            <button class="nav-btn" onclick="startAssessmentMode()">Try Again</button>
                            <button class="nav-btn" onclick="showModeSelection()">Return to Menu</button>
                        </div>
                    </div>
                `;
            }

            // Try to send feedback in the background
            try {
                if (window.completeDCAFeedbackSession) {
                    window.completeDCAFeedbackSession({
                        score: percentage,
                        questions: assessmentQuestions.length,
                        correct: score
                    });
                }
            } catch (error) {
                console.log('Feedback system not available:', error);
            }
        }
        
        // Helper function to get feedback message based on score
        function getFeedbackMessage(percentage) {
            if (percentage >= 90) {
                return "Outstanding performance! You've demonstrated excellent understanding of DCA procedures and protocols.";
            } else if (percentage >= 75) {
                return "Great job! You show strong knowledge of damage control procedures with some room for refinement.";
            } else if (percentage >= 60) {
                return "Good effort! Consider reviewing the areas where you had difficulty to strengthen your knowledge.";
            } else {
                return "This is a good starting point. Focus on reviewing the core concepts and try again to improve your score.";
            }
        }

        // Function to show help
        function showHelp() {
            alert('Help and instructions coming soon!');
        }

        // Initialize feedback system if available
        window.addEventListener('load', function() {
            if (window.dcaFeedback) {
                window.dcaFeedback = new DCAFeedbackManager();
                console.log('üî• DCA Feedback system initialized');
            }
        });

        // Initialize to mode selection on load
        showModeSelection();
    </script>

    <!-- DCA Assessment Section -->
    <div class="dca-assessment" id="dcaAssessment" style="display: none;">
        <!-- Scenario Information -->
        <div class="scenario-info">
            <h2 class="scenario-title">Current Scenario</h2>
            <p class="scenario-description" id="scenarioDescription">
                Loading scenario...
            </p>
            <div class="scenario-details">
                <div class="detail-item">
                    <span class="detail-label">Location:</span>
                    <span id="fireLocation">--</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Time Elapsed:</span>
                    <span id="timeElapsed">0:00</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Smoke Condition:</span>
                    <span id="smokeCondition">--</span>
                </div>
            </div>
        </div>

        <!-- Question Container -->
        <div class="question-container" id="questionContainer">
            <h3 class="question-text" id="questionText">Loading question...</h3>
            <div class="choices-container" id="choicesContainer">
                <!-- Choices will be dynamically inserted here -->
            </div>
        </div>

        <!-- Consequence Display -->
        <div id="consequenceContainer"></div>
    </div>

    <script>
        // DCA Assessment Handler
        class DCAAssessmentHandler {
            constructor() {
                this.currentState = null;
                this.currentQuestion = null;
                this.bindElements();
                this.initialize();
            }

            bindElements() {
                this.scenarioDescription = document.getElementById('scenarioDescription');
                this.fireLocation = document.getElementById('fireLocation');
                this.timeElapsed = document.getElementById('timeElapsed');
                this.smokeCondition = document.getElementById('smokeCondition');
                this.questionText = document.getElementById('questionText');
                this.choicesContainer = document.getElementById('choicesContainer');
                this.consequenceContainer = document.getElementById('consequenceContainer');
            }

            async initialize() {
                // Initialize with first question
                this.currentQuestion = 'initial_response';
                this.currentState = {
                    fire_location: 'Engine Room 2',
                    smoke_condition: 'light',
                    time_elapsed: 0,
                    compartments_affected: ['Engine Room 2'],
                    boundaries_set: false,
                    investigators_deployed: false,
                    fedfire_arrived: false
                };

                this.updateScenarioDisplay();
                this.displayQuestion();
            }

            updateScenarioDisplay() {
                this.scenarioDescription.textContent = 
                    `Fire reported in ${this.currentState.fire_location}. 
                     ${this.currentState.compartments_affected.length > 1 ? 
                       'Multiple compartments affected.' : 'Single compartment affected.'}`;
                this.fireLocation.textContent = this.currentState.fire_location;
                this.timeElapsed.textContent = `${Math.floor(this.currentState.time_elapsed)}:00`;
                this.smokeCondition.textContent = this.currentState.smoke_condition;
            }

            displayQuestion() {
                const question = {
                    text: "What is your initial response to the reported fire?",
                    choices: [
                        "A. Wait for FEDFIRE to arrive",
                        "B. Deploy investigators immediately",
                        "C. Evacuate the entire compartment",
                        "D. Set fire boundaries and deploy investigators"
                    ]
                };

                this.questionText.textContent = question.text;
                this.choicesContainer.innerHTML = question.choices
                    .map(choice => `
                        <div class="choice-option">
                            <input type="radio" name="response" value="${choice[0]}" id="choice${choice[0]}">
                            <label for="choice${choice[0]}">${choice}</label>
                        </div>
                    `).join('');

                // Add event listeners to choices
                this.choicesContainer.querySelectorAll('input[type="radio"]')
                    .forEach(input => {
                        input.addEventListener('change', (e) => this.handleChoice(e.target.value));
                    });
            }

            async handleChoice(choice) {
                try {
                    const response = await fetch('/api/dca/evaluate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            question_id: this.currentQuestion,
                            choice: choice,
                            current_state: this.currentState
                        })
                    });

                    const evaluation = await response.json();
                    this.showConsequences(evaluation);
                    this.updateState(evaluation.new_state);
                } catch (error) {
                    console.error('Error evaluating choice:', error);
                    // Fallback to basic feedback if API fails
                    this.showConsequences({
                        consequence: {
                            explanation: "Unable to evaluate choice. Please try again.",
                            time_penalty: 5
                        },
                        is_optimal: false
                    });
                }
            }

            showConsequences(evaluation) {
                const messageClass = evaluation.is_optimal ? 'success' : 'warning';
                this.consequenceContainer.innerHTML = `
                    <div class="consequence-message ${messageClass}">
                        <p><strong>Time Impact:</strong> +${evaluation.consequence.time_penalty} minutes</p>
                        <p>${evaluation.consequence.explanation}</p>
                    </div>
                `;
            }

            updateState(newState) {
                this.currentState = newState;
                this.updateScenarioDisplay();
            }
        }

        // Initialize when the page loads - DISABLED for mode selection
        // window.addEventListener('load', () => {
        //     window.dcaAssessment = new DCAAssessmentHandler();
        // });
    </script>
</body>
</html>
